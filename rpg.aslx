<!--Saved by Quest 5.6.6108.15891-->
<asl version="550">
  <include ref="English.aslx" />
  <include ref="Core.aslx" />
  <include ref="../lib/ShopLib.aslx" />
  <include ref="../lib/ClothingLib.aslx" />
  <include ref="../lib/ConvLib.aslx" />
  <include ref="../Lib/InvPane2.aslx" />
  <include ref="CombatLib.aslx" />
  <include ref="EnviroLib.xml" />
  <include ref="PrintLib.xml" />
  <include ref="Interface.xml" />
  <game name="The Sun Queen">
    <gameid>dd0d2bd4-ded9-4008-8710-f701c52e949f</gameid>
    <version>1.0</version>
    <firstpublished>2015</firstpublished>
    <autodescription type="boolean">false</autodescription>
    <enablehyperlinks type="boolean">false</enablehyperlinks>
    <subtitle> . . . Because Ice Queens are so 2013.</subtitle>
    <author>The Pixie</author>
    <appendobjectdescription type="boolean">false</appendobjectdescription>
    <attr name="feature_limitinventory" type="boolean">false</attr>
    <attr name="feature_asktell" type="boolean">false</attr>
    <autodisplayverbs type="boolean">false</autodisplayverbs>
    <nighttime type="boolean">false</nighttime>
    <category>RPG</category>
    <defaultforeground>OldLace</defaultforeground>
    <defaultbackground>OldLace</defaultbackground>
    <defaultwebfont>Bubblegum Sans</defaultwebfont>
    <defaultfontsize type="int">14</defaultfontsize>
    <defaultgrey>tan</defaultgrey>
    <defaultblack>Maroon</defaultblack>
    <defaultlinkforeground>Orange</defaultlinkforeground>
    <description><![CDATA[The Sun Queen has captured the Citadel, and now Prince Mandrin languishes in her dungeons. Can you fulfil the ancient prophecy and put the rightful ruler on the throne?<br/><br/>You will find several spells that you can learn along the way, but this is not a combat-based game. You have no weapons or armour, so attacking monsters is a bad idea. Try to find alternative solutions.<br/><br/>Please note that to complete the adventure you have to head back to Mandrin, your home town, down the road south of the town. You will get a warning asking you to confirm that you want to end the quest.]]></description>
    <difficulty>Medium</difficulty>
    <cruelty>Tough</cruelty>
    <statusattributes type="stringdictionary" />
    <showtitle type="boolean">false</showtitle>
    <attr name="command_successful" type="boolean">false</attr>
    <showpanes />
    <showlocation type="boolean">false</showlocation>
    <gamestart><![CDATA[
      <style type="text/css">
        #dialog_window_1 {
          color: tan;
          font-family: Bubblegum Sans;
          font-size: 14pt;
        }
        .scrolling {
          color: maroon;
          background-color: #d0d0d0;
          cursor: pointer;
        }
      </style>
      <div id="dialog_window_1" class="dialog_window" title="Who are you?">
         Name: <input type="text" id="name_input" value="Skybird"/><br/><br/>
         Born in <span id="para0" class="scrolling" onclick="scrollPara(this)"></span>, you grew up <span id="para1" class="scrolling" onclick="scrollPara(this)"></span>.
         You were a <span id="para2" class="scrolling" onclick="scrollPara(this)"></span> <span id="para3" class="scrolling" onclick="scrollPara(this)"></span>,
         always <span id="para4" class="scrolling" onclick="scrollPara(this)"></span>.
         <br/>
         <br/>
         At the age of seven, you caught the eye of <span id="wizardname" style="color:maroon;background-color:#d0d0d0;cursor:pointer;" onclick="scrollWizard();">Master Shalazin</span>,
         a <span id="wizardwitch">wizard</span>
         who specialises in <span id="para5" class="scrolling" onclick="scrollPara(this)"></span>.
         Perhaps <span id="wizardhe">he</span> recognised potential in you, or just a pair of hands willing to work for next to nothing; may be just liked your
         <span id="para6" class="scrolling" onclick="scrollPara(this)"></span> hair and <span id="para7" class="scrolling" onclick="scrollPara(this)"></span> eyes.
         Either way, you slowly learnt the basics of magic, and have recently learnt how to turn yourself <span id="para8" class="scrolling" onclick="scrollPara(this)"></span>.
         Perhaps more importantly, you have also learnt how to turn yourself back.
      </div>
      <script>
          para0Opts = [
            "a tiny village",
            "a provential town",
            "the slums",
            "the merchant's quarter"
          ];
          
          para1Opts = [
            "loving the outdoors",
            "appreciating the finer things in life",
            "always hungry",
            "isolated from children of your own age"
          ];
          
          para2Opts = [
            "introspective",
            "precocious",
            "attractive",
            "curious"
          ];
          
          para3Opts = [
            "boy",
            "girl"
          ];
          
          para4Opts = [
            "getting into trouble",
            "with your nose in a book",
            "stealing things",
            "getting into fights",
            "arguing with the local priest"
          ];

          para5Opts = [
            "potion brewing",
            "crystal magic",
            "shadow magic",
            "nature magic"
          ];

          para6Opts = [
            "raven black",
            "dark brown",
            "brunette",
            "dark blonde",
            "blonde",
            "platinum blonde",
            "ginger",
            "electric blue",
            "shocking pink",
          ];

          para7Opts = [
            "brown",
            "green",
            "hazel",
            "blue",
            "aquamarine"
          ];

          para8Opts = [
            "blue",
            "green",
            "orange",
          ];



          paraOpts = [];
          
          paraPositions = [];
          
          function getRandomInt(min, max) {
             return Math.floor(Math.random() * (max - min + 1)) + min;
          }

          wizardMale = true;
          
          function scrollWizard() {
            wizardMale = !wizardMale;
            $('#wizardname').html(wizardMale ? 'Master Shalazin' :  'Mistress Shalazin');
            $('#wizardwitch').html(wizardMale ? 'wizard' :  'witch');
            $('#wizardhe').html(wizardMale ? 'he' :  'she');
          }
          
          function scrollPara(element) {
            paraNumber = parseInt(element.id.replace('para', ''));
            para = $('#para' + paraNumber);
            if (typeof paraPositions[paraNumber] != 'number') {
              list = eval('para' + paraNumber + 'Opts');
              paraOpts[paraNumber] = list;
              paraPositions[paraNumber] = getRandomInt(0, list.length - 1);
            }
            paraPositions[paraNumber]++;
            if (paraPositions[paraNumber] >= paraOpts[paraNumber].length) {
              paraPositions[paraNumber] = 0;
            }
            para.html(paraOpts[paraNumber][paraPositions[paraNumber]]);
          }    

          function setValues() {
                that.dialog("close");
                answer = $('#name_input').val();
                list = $('.scrolling');
                list.each(function() {
                  paraNumber = parseInt(this.id.replace('para', ''));
                  para = $('#para' + paraNumber);
                  answer += "|" + para.html();
                });
                answer += "|" + wizardMale;
                ASLEvent("HandleDialogue", answer);
          }
       
          $(document).ready(function () {
                $('.scrolling').each(function() {
                  scrollPara(this);
                });
                that = $("#dialog_window_1");
                $('#dialog_window_1').dialog({
                   height: 400,
                   width: 640,
                   buttons: {
                      "Done": function() { setValues();}
                  }
                });
                $("button[title='Close']")[0].style.display = 'none';
          });
       </script>
                               ]]></gamestart>
    <start type="script">
      Title (game.gamename, 28)
      Title (game.subtitle, 20)
      CombatInitialise
      foreach (object, AllObjects()) {
        if (HasScript(object, "colourmylistalias")) {
          do (object, "colourmylistalias")
        }
      }
      request (Hide, "Command")
      JS.eval ("$('#status').css('display', 'block')")
      game.startup = true
      JS.addText (game.gamestart)
    </start>
    <roomenter type="script">
      EnviroFlavour
    </roomenter>
  </game>
  <command name="lookat">
    <pattern>look at #object#; x #object#; examine #object#; exam #object#; ex #object#</pattern>
    <script>
      if (GetBoolean(object, "hidechildren")) {
        object.hidechildren = false
      }
      if (TypeOf(object, "look") = "script") {
        do (object, "look")
      }
      else {
        lookdesc = ""
        if (HasString(object, "look")) {
          lookdesc = object.look
        }
        if (LengthOf(lookdesc) = 0) {
          lookdesc = Template("DefaultObjectDescription")
        }
        if (GetBoolean(object, "switchedon")) {
          if (HasString(object, "switchedondesc")) {
            lookdesc = lookdesc + " " + object.switchedondesc
          }
        }
        else {
          if (HasString(object, "switchedoffdesc")) {
            lookdesc = lookdesc + " " + object.switchedoffdesc
          }
        }
        isDark = CheckDarkness()
        if (isDark and not GetBoolean(object, "lightsource")) {
          lookdesc = DynamicTemplate("LookAtDarkness", object)
        }
        P (lookdesc)
      }
      ListObjectContents (object)
    </script>
  </command>
  <object name="environment">
    <inherit name="editor_object" />
    <listen>You can't heard much at all.</listen>
    <smell>You sniff the air, but cannot smell anything.</smell>
    <zone />
    <alias>Environment</alias>
    <flavour type="stringlist" />
    <look>This should never be seen!</look>
    <object name="e_building">
      <inherit name="editor_object" />
      <listen type="string"></listen>
      <smell type="string"></smell>
      <scenery />
      <enviro type="object">e_inside</enviro>
      <object name="wall">
        <inherit name="editor_object" />
        <look>The walls are not important.</look>
        <scenery />
        <alias>wall</alias>
      </object>
      <object name="ceiling">
        <inherit name="editor_object" />
        <look>You stare at the ceiling for a while.</look>
        <scenery />
        <alt type="stringlist">
          <value>roof</value>
        </alt>
        <alias>ceiling</alias>
      </object>
    </object>
    <object name="e_cave">
      <inherit name="editor_object" />
      <listen>From far away, you can hear the burbling of an underground stream.</listen>
      <smell>This place smells of damp...</smell>
      <scenery />
      <magpie>The magpie follows you, jumping from rock to rock.</magpie>
      <enviro type="object">e_inside</enviro>
      <object name="cave_wall">
        <inherit name="editor_object" />
        <alias>wall</alias>
        <look>The cave walls are cold and damp.</look>
        <alt type="stringlist">
          <value>side</value>
          <value>ceiling</value>
        </alt>
        <scenery />
      </object>
    </object>
    <object name="e_forest">
      <inherit name="editor_object" />
      <smell>You can smell pine cones and bracken.</smell>
      <listen>In the trees, birds are sing, as the wind gently rustles through the leaves.</listen>
      <scenery />
      <flavour type="stringlist">
        <value>You can hear a woodpecker busily pecking at a tree.</value>
        <value>Grasshoppers chirup all around you.</value>
        <value>Butterflies chase each other over the flowers.</value>
        <value>A bumble bee hovers from flower to flower.</value>
        <value>Birds are singing in the trees.</value>
        <value>A white butterfly considers for a moment settling on your shoulder, before thinking better of it, and flying away.</value>
        <value>A rabbit sees you, and darts away.</value>
        <value>From not far away, you can hear birds tweeting.</value>
        <value>A large spider, perhas as big as your hand, looks at you for a moment, before  scuttling into the undergrowth.</value>
        <value>Something, possibly a ferret, streaks across the path in front of you, and is gone as quickly as it arrived.</value>
      </flavour>
      <flavournames type="stringlist">
        <value>woodpecker</value>
        <value>grasshopper|grasshoppers</value>
        <value>butterfly|butterflies</value>
        <value>bumble bee|bee</value>
        <value>bird|birds</value>
        <value>white butterfly|butterfly</value>
        <value>rabbit</value>
        <value>bird|birds</value>
        <value>spider</value>
        <value>ferret</value>
      </flavournames>
      <flavourdescs type="stringlist">
        <value>You look up at where the hammering is coming from and after a few moments spot the woodpecking, high in an oak tree.</value>
        <value>You start stalking a grasshopper, but as soon as you do, it stops chirping. You try to find another, and now that one has stopped. Aftetr five more tries, you give it up as a bad idea.</value>
        <value>The butterflies are bright blue.</value>
        <value>It is just a bumble bee.</value>
        <value>The birds seem to be too high up for you to see them.</value>
        <value>You cannot see where the butterfly has gone.</value>
        <value>The rabbit is no longer here.</value>
        <value>There are perhaps six larks up in a larch, singing merrily.</value>
        <value>You decide you would rather not see the spider again.</value>
        <value>The ferret, if that is what it was, is long gone.</value>
      </flavourdescs>
      <magpie>The magpie jumps onto a branch, and looks at you quizzically.</magpie>
      <onlywhennotcursed />
      <enviro type="object">e_outside</enviro>
      <attr name="enviro_script" type="script">
      </attr>
      <object name="tree">
        <inherit name="editor_object" />
        <look>You look carefully at the tree.  A tall thing with leaves. One of many in the forest.</look>
        <scenery />
        <alias>tree</alias>
        <alt type="stringlist">
          <value>trees</value>
        </alt>
      </object>
    </object>
    <object name="e_inside">
      <inherit name="editor_object" />
      <listen>It's pretty quiet in here.</listen>
      <look type="string"></look>
      <scenery />
      <enviro type="object">environment</enviro>
    </object>
    <object name="e_outside">
      <inherit name="editor_object" />
      <listen>It's pretty quiet out here.</listen>
      <scenery />
      <enviro type="object">environment</enviro>
      <object name="sky">
        <inherit name="editor_object" />
        <scenery />
        <alias>sky</alias>
        <look type="script">
          if (player.worldcursed) {
            Print ("The sky is orange and deeply threatening.")
          }
          else {
            Print ("The sky is blue, with little fluffy clouds.")
          }
        </look>
      </object>
    </object>
    <object name="e_forest_river">
      <inherit name="editor_object" />
      <listen>You can hear the river.</listen>
      <scenery />
      <flavour type="stringlist">
        <value>A fish, perhaps a salmon, leaps from the river, and with a splash disappears again.</value>
        <value>A water rat swims past, the current helping to take it downstream.</value>
        <value>A large branch, caught in the current of the river, goes by.</value>
        <value>Dragonflies flit about.</value>
      </flavour>
      <flavournames type="stringlist">
        <value>fish|salmon</value>
        <value>rat|water rat</value>
        <value>branch|large branch</value>
        <value>dragonfly|dragonflies</value>
      </flavournames>
      <flavourdescs type="stringlist">
        <value>You watch the water for a few moments, but the fish does not jump again.</value>
        <value>You stand and watch the water rat as it swims about, unaware that you are there.</value>
        <value>For a moment, you watch the branch as it disappears from view.</value>
        <value>The dragonflies are large, almost as big as your hand, and brightly-coloured.</value>
      </flavourdescs>
      <magpie>The magpie swoops low over the river, perhaps looking for a tasty insect, before perching on a branch.</magpie>
      <onlywhennotcursed />
      <enviro type="object">e_forest</enviro>
      <attr name="enviro_script" type="script">
      </attr>
      <object name="water">
        <inherit name="editor_object" />
        <look>The river is fast flowing, and somewhat brown. You can see branches and other debris being swept along.</look>
        <scenery />
        <attr name="filling_liquid">water</attr>
        <alt type="stringlist">
          <value>river</value>
          <value>water</value>
        </alt>
        <alias>water</alias>
      </object>
    </object>
    <object name="e_forest_road">
      <inherit name="editor_object" />
      <scenery />
      <flavour type="stringlist">
        <value>A flock of geese fly overhead.</value>
        <value>You hear an owl hooting.</value>
        <value>A rat stares at you from the side of the road, then loses interest, and disappears from view.</value>
      </flavour>
      <flavournames type="stringlist">
        <value>goose|geese</value>
        <value>owl</value>
        <value>rat</value>
      </flavournames>
      <flavourdescs type="stringlist">
        <value>There must be about forty geese, in a ragged 'V' formation.</value>
        <value>You spot the owl some way off. It is staring at you.</value>
        <value>You can no longer see the rat.</value>
      </flavourdescs>
      <magpie>The magpie perches on a low branch by your head.</magpie>
      <onlywhennotcursed />
      <enviro type="object">e_forest</enviro>
      <attr name="enviro_script" type="script">
      </attr>
      <object name="road">
        <inherit name="editor_object" />
        <scenery />
        <look>The road was built of flat stones many centuries ago, but has been poorly maintained. Many sones are missing, or sunken in the mire, and nowadays the road is uneven and rutted, and muddy too after recent rains.</look>
        <alias>road</alias>
      </object>
    </object>
    <object name="e_necropolis">
      <inherit name="editor_object" />
      <scenery />
      <magpie>The magpie settles on a convenient stone peech.</magpie>
      <evenwhencursed />
      <enviro type="object">e_inside</enviro>
      <object name="ossuary_jar">
        <inherit name="editor_object" />
        <alias>Ossuary jar</alias>
        <scenery />
        <look type="script">
          Print ("The ossuary jars are all much alike. About six inches wides, and twice that in height, and made of pottery, they are glazed in bright colours, though much faded now.")
          if (player.status = "Lore") {
            Print ("Though the tradition has now ended, it used to be the custom to bury the dead in temporary tombs, and then recover the bones a year later. These jars would then be the final resting place of those bones.")
          }
        </look>
      </object>
      <object name="stone_shelf">
        <inherit name="editor_object" />
        <alias>Stone shelf</alias>
        <scenery />
        <look>The shelves are single blocks of stone, about an inch thick, supported at each end.</look>
      </object>
      <object name="ceiling1">
        <inherit name="editor_object" />
        <look>The ceiling is vaulted stone.</look>
        <scenery />
        <alias>ceiling</alias>
        <alt type="stringlist">
          <value>roof</value>
        </alt>
      </object>
      <object name="wall1">
        <inherit name="editor_object" />
        <look>The walls are cut stone, worn and darkened with age.</look>
        <scenery />
        <alias>wall</alias>
      </object>
    </object>
    <object name="e_courtyard">
      <inherit name="editor_object" />
      <scenery />
      <enviro type="object">e_outside</enviro>
      <object name="courtyard">
        <inherit name="editor_object" />
        <alias>courtyard</alias>
        <scenery />
        <look>The courtyard is covered with stone flags, many look worn.</look>
      </object>
    </object>
    <object name="e_citadel">
      <inherit name="editor_object" />
      <scenery />
      <enviro type="object">e_building</enviro>
    </object>
    <object name="e_marsh">
      <inherit name="editor_object" />
      <smell>There is a sulphurous smell of decay.</smell>
      <scenery />
      <flavour type="stringlist">
        <value>An egret that had been carefully studying the water suddenly takes to the wing.</value>
        <value>You hear a frog croaking nearby.</value>
      </flavour>
      <magpie>The magpe follows, circling for a moment before alighting on a relatively dry patch of ground.</magpie>
      <onlywhennotcursed />
      <enviro type="object">e_forest_river</enviro>
      <attr name="enviro_script" type="script">
      </attr>
    </object>
    <object name="e_sewer">
      <inherit name="editor_object" />
      <smell>It's a sewer. It smells like a sewer.</smell>
      <scenery />
      <enviro type="object">e_inside</enviro>
      <attr name="enviro_script" type="script">
        player.sewer = true
      </attr>
      <object name="water1">
        <inherit name="editor_object" />
        <alias>water</alias>
        <look>The water is brown and has "things" floating in it.</look>
        <scenery />
      </object>
      <object name="wall2">
        <inherit name="editor_object" />
        <alias>wall</alias>
        <look>The walls of the sewer curve to form a pipe. They are built of stone, and stained a variety of unpleasant colours. Mould is a common feature.</look>
        <scenery />
      </object>
      <object name="mould">
        <inherit name="editor_object" />
        <alias>mould</alias>
        <alt type="stringlist">
          <value>mold</value>
        </alt>
        <look>The mould is a yellowy-green colour, and grows in patchs all over the walls.</look>
        <scenery />
      </object>
    </object>
    <object name="e_mountain">
      <inherit name="editor_object" />
      <scenery />
      <flavour type="stringlist">
        <value>Way to the south, you see wyverns cicling on a thermal.</value>
        <value>The wind howls across the mountains.</value>
      </flavour>
      <flavournames type="stringlist">
        <value>wyvern|wyverns</value>
        <value></value>
      </flavournames>
      <flavourdescs type="stringlist">
        <value>From here they look tiny, but the piebald wyverns must be the size of cattle..</value>
        <value></value>
      </flavourdescs>
      <onlywhennotcursed />
      <enviro type="object">e_outside</enviro>
      <attr name="enviro_script" type="script">
      </attr>
    </object>
    <object name="e_town">
      <inherit name="editor_object" />
      <scenery />
      <magpie>The magpie hops along the road behind you.</magpie>
      <enviro type="object">e_outside</enviro>
    </object>
    <object name="enviro_object">
      <inherit name="editor_object" />
      <alias>Generic_object</alias>
      <scenery />
      <displayverbs type="stringlist">
        <value>Look at</value>
      </displayverbs>
      <look>You should never see this!</look>
    </object>
    <object name="e_inner_citadel">
      <inherit name="editor_object" />
      <scenery />
      <enviro type="object">e_citadel</enviro>
    </object>
  </object>
  <object name="start">
    <inherit name="editor_room" />
    <alias> The Market in Tandren</alias>
    <enviro type="object">environment</enviro>
    <description type="script">
    </description>
    <object name="player">
      <inherit name="editor_object" />
      <inherit name="editor_player" />
      <female type="boolean">false</female>
      <gold type="int">9</gold>
      <hero type="int">0</hero>
      <worldcursed type="boolean">false</worldcursed>
      <levelstatus type="int">1</levelstatus>
      <sewer type="boolean">false</sewer>
      <attr name="gate_password" type="string"></attr>
      <ending>none</ending>
      <pov_alt type="stringlist">
        <value>myself</value>
        <value>self</value>
        <value>me</value>
      </pov_alt>
      <changedarmour type="script">
        UpdateStatus
      </changedarmour>
      <changedgold type="script">
        UpdateStatus
      </changedgold>
      <changedstatus type="script">
        UpdateStatus
      </changedstatus>
      <attr name="pov_look" type="script">
        P ("You stop and look at yourself.")
      </attr>
    </object>
  </object>
  <object name="town">
    <inherit name="editor_room" />
    <alias>Town Locations</alias>
    <zone />
    <object name="market_square">
      <inherit name="editor_room" />
      <alias>Market square</alias>
      <enviro type="object">e_town</enviro>
      <description type="script"><![CDATA[
        Print ("A dusty square of dirt, surrounded by several meagre buildings, including a shop to the east. The only buildings taller than a single storey are the tavern, <i>The Drunken Pig</i>, to the south, and a narrow tower to the west. A road of sorts heads north, towards a blood red citadel some leagues away. The only facilities the market square itself boasts is a horse trough; there is no sign of a market today.")
        if (stone_of_returning.parent = this and stone_of_returning.visible) {
          Print ("Over near the horse trough is a flattish stone, pretty much exactly where you materialised after casting <i>Returning</i>.")
        }
      ]]></description>
      <exit alias="north" to="road_near_town">
        <inherit name="northdirection" />
      </exit>
      <exit alias="east" to="town_shop">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="south" to="tavern">
        <inherit name="southdirection" />
      </exit>
      <exit alias="west" to="sage_tower">
        <inherit name="westdirection" />
      </exit>
      <object name="magpie_town_square">
        <inherit name="editor_object" />
        <inherit name="startingtopic" />
        <alias>Ask about the market</alias>
        <visible type="boolean">false</visible>
        <talk type="script">
          Print ("'Do they ever have a market here?' you wonder.")
          Print ("'Sure. Bunch of yokels haggling over a sack of beans or a spade. Once a week. You looking for a bargain in the seed line?'")
        </talk>
      </object>
      <object name="horse_trough">
        <inherit name="editor_object" />
        <alias>Horse trough</alias>
        <scenery />
        <sewer type="boolean">false</sewer>
        <look type="script">
          if (this.sewer) {
            Print ("The horse trough is made of stone, and about as long as you are tall. It is full of bad-smelling water.")
          }
          else {
            Print ("The horse trough is made of stone, and about as long as you are tall. It is full of water.")
          }
          if (player.status = "Lore") {
            Print ("Curiously, the trough actually pre-dates the town, though this may not be its original location. It is an example of late Liome Era stonework, as the faded bas-relief images clearly show.")
          }
        </look>
      </object>
      <exit alias="southwest" to="town_street">
        <inherit name="southwestdirection" />
      </exit>
      <object name="stone_of_returning">
        <inherit name="editor_object" />
        <scenery />
        <visible type="boolean">false</visible>
        <alias>Stone of returning</alias>
        <look>The Stone of Returning looks pretty ordinary, a pale grey, flat stone.</look>
        <take />
        <throw type="script">
          if (HasAttribute(player.parent, "stonesthrow")) {
            do (player.parent, "stonesthrow")
          }
          else {
            Print ("You throw the stone in a random direction, for no good reason.")
            this.parent = player.parent
          }
        </throw>
        <ontake type="script">
          do (magpie_returning, "show")
        </ontake>
      </object>
    </object>
    <object name="tavern">
      <inherit name="editor_room" />
      <alias>The Drunken Pig</alias>
      <enviro type="object">e_building</enviro>
      <description type="script">
        s = "The Drunken Pig is a small tavern in a small town. At this time of day, it is almost empty, but at night you can imagine it gets full very easily."
        if (innkeeper.parent = this) {
          s = s + " The innkeeper stands behind the bar, polishing a glass as he awaits an order."
        }
        if (villager.parent = this) {
          if (villager.revealed) {
            s = s + " A single customer stands near the bar, the old hag."
          }
          else {
            s = s + " A single customer stands near the bar, a rather pretty woman."
          }
        }
        Print (s + " The main exit is to the north out to the market square, but a side exit leads west.")
      </description>
      <beforeenter type="script">
      </beforeenter>
      <enter type="script"><![CDATA[
        if (player.status = "KoboldGlamour" and innkeeper.parent = this) {
          Print ("'We don't serve your kind in here,' says the innkeeper to you.")
          Print ("'What..?' Of course - you look like a kobold! You step outside, cancel the spell, and then walk back into the tavern, now looking like a human.")
          CancelSpell
        }
        if (innkeeper.parent = this and player.sewer) {
          Print ("'By the gods, what <i>is</i> that smell?'")
          if (villager.parent = this) {
            Print ("The villager sniffs the air. 'It's him,' she says, pointing an accusatory finger at you.")
          }
        }
      ]]></enter>
      <magpie type="script">
        Print ("The magpie flies into taven too, and perches on a beam.")
        if (not GetBoolean(this, "magpieflag")) {
          Print ("'Get that filthy bird out of here,' says the innkeeper.")
          Print ("'Don't look at me,' you say. 'Stupid thing follows me round everywhere.' You wave your arms at it, and get it to fly to another beam.")
          Print ("'If it craps in here...' mutters the innkeeper.")
        }
      </magpie>
      <exit alias="north" to="market_square">
        <inherit name="northdirection" />
      </exit>
      <object name="innkeeper">
        <inherit name="editor_object" />
        <inherit name="namedmale" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <alias>Innkeeper</alias>
        <alt type="stringlist">
          <value>innkeeper</value>
        </alt>
        <attackdesc>% swings a fist at you</attackdesc>
        <attackasgroup />
        <level type="int">1</level>
        <damagedicenumber type="int">2</damagedicenumber>
        <hitpoints type="int">14</hitpoints>
        <notindescription />
        <image>inn_keeper</image>
        <desc>The innkeeper seems a jolly sort - probably part of the job description.</desc>
        <lookwhendead>The inn keeper does not seem so jolly now he is dead.</lookwhendead>
        <picture>inn_keeper.png</picture>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <greet type="script">
          Print ("'Good day,' you say to the innkeeper.")
          if (player.female) {
            Print ("'Good day to you, miss,' he says with a wink.")
          }
          else {
            Print ("'Good day to you, sir.'")
          }
        </greet>
        <object name="innkeeper_town">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>About this town</alias>
          <nowshow type="stringlist">
            <value>innkeeper_sage</value>
          </nowshow>
          <talk type="script">
            Print ("'Nice town,' you lie to the innkeeper.")
            Print ("'Its not big, is Applebrook, but it's a bonny place.'")
          </talk>
        </object>
        <object name="innkeeper_sun_queen">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>About the Sun Queen</alias>
          <nowshow type="stringlist">
            <value>villager_prince_mandrin</value>
            <value>innkeeper_prince_mandrin</value>
          </nowshow>
          <talk type="script">
            if (innkeeper.alias = "Innkeeper") {
              Print ("'What do you know about the Sun Queen?', you ask the innkeeper.")
            }
            else {
              Print ("'What do you know about the Sun Queen?' you ask Donk.")
            }
            Print ("He shrugs. 'Not much, but I know she's trouble. Prince Mandrin took an army to defeat her, and she used her magicks to wash it away before they even arrived at the citadel. A terrible thing.'")
          </talk>
        </object>
        <object name="innkeeper_sage">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>About the sage</alias>
          <talk type="script">
            Print ("'I hear the town has a sage.'")
            Print ("'Sure does. Get quite a few travellers coming to Applebrook to talk to him. Very well respected, is Leroulk, in these parts.'")
            sage.alias = "Leroulk"
          </talk>
        </object>
        <object name="innkeeper_name">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>What is your name</alias>
          <talk type="script">
            Print ("'I'm " + player.alias + ",' you say to the innkeeper.")
            if (player.female) {
              Print ("'That's a pretty name,' he says, staring at your chest. 'I'm Donk.'")
            }
            else {
              Print ("'Good to meet you. I'm Donk.'")
            }
            innkeeper.alias = "Donk"
          </talk>
        </object>
        <object name="innkeeper_prince_mandrin">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>About Prince Mandrin</alias>
          <talk type="script">
            Print ("'Who's Prince Mandrin?'")
            Print ("'Don't know much do you? Prince Mandrin is the rightful ruler of this country; he stands against the Sun Queen.' Something about the way he says \"Prince Mandrin\" makes you suspicious that this is not as clearcutr as it might be.")
            if (player.female) {
              do (innkeeper_prince_mandrin_again, "show")
            }
          </talk>
        </object>
        <object name="innkeeper_prince_mandrin2">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Prince Mandrin again</alias>
          <nowshow type="stringlist">
            <value>sage_bad_prince</value>
          </nowshow>
          <talk type="script">
            Print ("'So about Prince Mandrin...' You smile sweetly at the innkeeper.")
            Print ("He leans closer, so he can whisper, or perhaps to look down your cleavage. 'Don't tell anmyone I said this, but, well, there are some who say the Prince is not abovge a bit of doom magick too. Some say he's no better than she is. In fact, I've even heard it said they are... brother and sister.' He gives you a significant look. 'Fruit of the same womb,' he says darkly.")
          </talk>
        </object>
        <object name="innkeeper_hooker">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>That villagers is a hooker and a hag</alias>
          <talk type="script">
            Print ("'That villagers is a hooker and a hag,' you say to the innkeeper.")
            Print ("'What of it?'")
            Print ("'Er, nothing?'")
          </talk>
        </object>
        <object name="innkeeper_feculi">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Do you know a Feculi?</alias>
          <talk type="script">
            Print ("'Do you know a woman called \"Feculi\",' you ask the innkeeper.'")
            if (villager.revealed) {
              Print ("'That her there,' and he points to the old woman.")
            }
            else {
              Print ("'That her there,' and he points to the young woman.")
            }
          </talk>
        </object>
        <object name="innkeeper_buy_wine">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Buy a glass of wine (2 g)</alias>
          <nowshow type="stringlist">
            <value>innkeeper_buy_more_wine</value>
          </nowshow>
          <talk type="script"><![CDATA[
            if (player.gold > 1) {
              Print ("'I'd like a glass of wine, please,' you ask the innkeeper.")
              Print ("'Sure.' He uncorks a bottle, and measures out a generous glass. 'Two gold please. sir.' You pay the gold, and try the wine. It is not bad.")
              if (player.status = "Lore") {
                Print ("This is a Dubelan wine, a red, probably from two years ago, when the good summer gave a good grape crop. It has travelled well.")
              }
              player.gold = player.gold - 2
            }
            else {
              Print ("You think how much you would like a glass of wine right now - it only you could afford it.")
            }
          ]]></talk>
        </object>
        <object name="innkeeper_buy_more_wine">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Buy another glass of wine (2 g)</alias>
          <nowshow type="stringlist" />
          <hideafter type="boolean">false</hideafter>
          <talk type="script"><![CDATA[
            if (player.gold > 1) {
              Print ("'Another glass of that excellent wine, please,' you ask the innkeeper. He pours the wine, and takes your gold.")
              player.gold = player.gold - 2
            }
            else {
              Print ("You think how much you would like a glass of wine right now - it only you could afford it.")
            }
          ]]></talk>
        </object>
        <object name="innkeeper_buy_beer">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Buy a tankard of ale (1 g)</alias>
          <nowshow type="stringlist">
            <value>innkeeper_buy_more_beer</value>
          </nowshow>
          <talk type="script"><![CDATA[
            if (player.gold > 0) {
              Print ("'A pint of your finest ale, please,' you ask the innkeeper.")
              Print ("'There's just the one.' He draws a pint of frothy beer into a tankard. 'One gold please. sir.' You pay the gold, and try the beer. Not good.")
              if (player.status = "Lore") {
                Print ("The ale has an earthy taste, suggesting it comes from a brewery in Tandren, a couple of days away. While there are many fine ales from Tandren, this is not one of them.")
              }
              player.gold = player.gold - 1
            }
            else {
              Print ("You think how much you would like a pint of ale right now - it only you could afford it.")
            }
          ]]></talk>
        </object>
        <object name="innkeeper_buy_more_beer">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Buy another tankard of beer (1 g)</alias>
          <nowshow type="stringlist" />
          <hideafter type="boolean">false</hideafter>
          <talk type="script"><![CDATA[
            if (player.gold > 0) {
              Print ("'Another pint of ale, please,' you ask the innkeeper. He pours the beer, and takes your gold.")
              player.gold = player.gold - 1
            }
            else {
              Print ("You think how much you would like a pint of ale right now - it only you could afford it.")
            }
          ]]></talk>
        </object>
        <object name="innkeeper_sage_monster">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>The sage is a puppet</alias>
          <talk type="script">
            Print ("'I've thought long and hard about this,' you lie, 'but you have a right to know. The man you call the sage is just a puppet; a mannekin controlled by a tentacled demon creature.'")
            Print ("'We know.'")
            Print ("'What?'")
            Print ("'We know. We all know in the village. He's never hurt anyone, and people come from miles around to talk to the sage. I know this inn'd soon close without the custom he brings.'")
            do (villager_sage_monster, "hide")
          </talk>
        </object>
        <object name="innkeeper_tandren">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>I was in Tandren...</alias>
          <talk type="script">
            Print ("'I was in Tandren, then, I don't know, someone attacked my I think, and I woke up here.'")
            Print ("'You got enemies wanted to get rid of you then?'")
            Print ("'I didn't think so, but I suppose I must've. How far away is Tandren from here?'")
            Print ("'Three days walk.'")
            Print ("'I must've been unconscious a fair time...'")
          </talk>
        </object>
      </object>
      <object name="villager">
        <inherit name="editor_object" />
        <inherit name="namedfemale" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <drinks type="int">0</drinks>
        <alias>Villager</alias>
        <revealed type="boolean">false</revealed>
        <alt type="stringlist">
          <value>villager</value>
        </alt>
        <attackdesc>% tries to kick you</attackdesc>
        <attackasgroup />
        <notindescription />
        <revealeddesc>The villager is an ugly old hag.</revealeddesc>
        <desc>The villager is a pretty woman in her early twenties. She is sipping a glass of wine.</desc>
        <image>female_villager</image>
        <picture>female_villager.png</picture>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <greet type="script">
          if (player.female) {
            Print ("'Good day,' you say to the villager.")
            Print ("'Good day to you.'")
          }
          else {
            Print ("'Good day,' you say to the pretty villager with a wink.")
            Print ("She curtsies, as she looks you up and down, then smiles. 'Good day to you, sir.'")
          }
        </greet>
        <truesight type="script">
          if (not this.revealed) {
            this.revealed = true
            Print ("The villager's face becomes hazy, and then she looks rather different. About a century older for one thing.")
            player.truesight_worked = true
            exit_narrow_cave.visible = true
          }
        </truesight>
        <object name="villager_town">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>About the town</alias>
          <nowshow type="stringlist">
            <value>villager_sage</value>
            <value>innkeeper_sage</value>
          </nowshow>
          <talk type="script"><![CDATA[
            Print ("'I take it you live in the town? Can you tell me about it?' you say to the villager")
            Print ("'I've lived in Applebrook all my life, so I have. Ain't nowhere like it, and that's a fact.'")
            Print ("'It seems quite... small.'")
            Print ("'Oh, no! We have a shop <i>and</i> a tavern. And a sage too!'")
          ]]></talk>
        </object>
        <object name="villager_sun_queen">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>About the Sun Queen</alias>
          <talk type="script">
            if (villager.alias = "Villager") {
              Print ("'What do you know about the Sun Queen?' you ask the villager.")
            }
            else {
              Print ("'What do you know about the Sun Queen?', you ask Feculi.")
            }
            Print ("'They say she's very beautiful - and very evil. Isn't that always the way? The most beautiful women are evil.'")
            if (not player.female) {
              Print ("'I don't know, you're quite the looker yourself!'")
              Print ("'Oh, you,' she gushes. Then in a whisper, 'I can be quite naughty myself sometimes...'")
              do (villager_naughty, "show")
            }
          </talk>
        </object>
        <object name="villager_sage">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>About the sage</alias>
          <talk type="script"><![CDATA[
            Print ("'You say the town has a sage? Where might I find him?'")
            Print ("'He lives in the tower in the market place. You can't miss the tower, it is <i>three</i> stories high. A wonder, so it.'")
            Print ("'What's this sage like?'")
            Print ("'Very wise, so he is. Stays in his tower mostly, just thinking. That's how you know he's wise. And reading. He has books in that tower. So they say, anyway.'")
          ]]></talk>
        </object>
        <object name="villager_have_drink">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Buy her a drink</alias>
          <hideafter type="boolean">false</hideafter>
          <talk type="script"><![CDATA[
            if (player.gold < 4) {
              Print ("You think about buying the girl a drink, but do not have enough cash on you at the moment.")
            }
            else if (villager.drinks = 0) {
              Print ("'Can I get you a drink?'")
              Print ("'Oh, I don't usually...' You wonder why she is in a tavern then '... buy just this once, that would be kind of you. A whiskey would be nice. Make it a double.'")
              Print ("You buy her a double whiskey, for 4 gold, and she knocks it back in one.")
              player.gold = player.gold - 4
              villager.drinks = 1
            }
            else {
              Print ("'Can I get you another drink?'")
              Print ("'Absolutely!' You buy her another double whiskey and again she knocks it back in one.")
              player.gold = player.gold - 4
              villager.drinks = villager.drinks + 1
            }
          ]]></talk>
        </object>
        <object name="villager_name">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>What is your name</alias>
          <talk type="script">
            Print ("'What's your name,' you ask the villager.")
            Print ("'Feculi,' she says.")
            if (player.female) {
              Print ("'I'm " + player.alias + ".'")
            }
            else {
              Print ("'That's a pretty name. I'm called " + player.alias + ".'")
            }
            villager.alias = "Feculi"
          </talk>
        </object>
        <object name="villager_naughty">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <nowshow type="stringlist">
            <value>village_fifty_gold</value>
          </nowshow>
          <alias>Naughty?</alias>
          <talk type="script">
            Print ("'So you were saying about being naughty...'")
            Print ("'For fifty gold, I'll be as basd as you like.'")
          </talk>
        </object>
        <object name="villager_fifty_gold">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <hideafter type="boolean">false</hideafter>
          <alias>Here is fifty gold</alias>
          <nowshow type="stringlist">
            <value>villager_fun</value>
          </nowshow>
          <talk type="script"><![CDATA[
            if (player.gold < 50) {
              Print ("It would be interesting to see just how bad she could be, you muse, but sadly you do not have 50 gold at the moment.")
            }
            else {
              player.gold = player.gold - 50
              do (this, "hide")
              Print ("'It just so happens I have 50 gold here...'")
              Print ("'That'll do nicely, sir.' She takes the gold from you, and leads you to an upstairs room. She is certainly good at being bad, and it is a couple of hours later that you stagger back downstairs...")
            }
          ]]></talk>
        </object>
        <object name="villager_prince_mandrin">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>About Prince Mandrin</alias>
          <talk type="script">
            Print ("'Who's Prince Mandrin?'")
            Print ("'He's the king! Well, he will be one day. Unless the Sun Queen stops.'")
          </talk>
        </object>
        <object name="villager_old_hag">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>You are a hag!</alias>
          <nowshow type="stringlist">
            <value>villager_hooker</value>
            <value>innkeeper_hooker</value>
          </nowshow>
          <talk type="script">
            Print ("'You're a hag!' you accuse the not-so-attractive villager.")
            Print ("'Well that's very rude.'")
            Print ("'But you are an actual hag.'")
            Print ("'What? Oh bother! Yes, I am a hag. So what of it?'")
            Print ("'Aren't hags evil? Why do you pretend to be a pretty woman?'")
            Print ("'A lot of people say hags are evil, but I'm not. And that is why I pretend to be a pretty woman. Guys don't pay to sleep with hags, so I cast a glamour on myself.'")
          </talk>
        </object>
        <object name="villager_hooker">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>You are a hooker?</alias>
          <talk type="script">
            Print ("'You're a hooker?'")
            Print ("'Yes! So please keep quiet about the whole hag thing.'")
            Print ("'But...'")
            Print ("'Look I sleep with guys for money. They're happy, I'm happy. Why spoil it for anyone?'")
          </talk>
        </object>
        <object name="villager_feculi">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Do you know a Feculi?</alias>
          <talk type="script">
            if (villager.revealed) {
              Print ("'Do you know someone called \"Feculi\", you ask the old hag.")
              Print ("'That's me.'")
              Print ("'You have a sister, Raculi? She would like you to go visit her.'")
              Print ("'What? Do you know where she lives? The other side of the forst, and half way up a mountain! Oh, I suppose I better. Tomorrow, perhaps.'")
            }
            else {
              Print ("'Do you know someone called \"Feculi\", you ask the young woman.")
              Print ("'Oh, that's me,' she says brightly")
              Print ("'You have a... sister, Raculi? She looks rather old than you. She would like you to go visit her.'")
              Print ("'Of course I will. She's not really my sister, she's just a bit funny in the head, now she's getting on a bit.'")
            }
            do (innkeeper_feculi, "hide")
          </talk>
        </object>
        <object name="villager_feculi2">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>I have a message from Raculi</alias>
          <talk type="script">
            if (villager.revealed) {
              Print ("'I met you sister, Raculi,", you tell the old hag.")
              Print("'What of it?'")
              Print ("'She said she would like you to go visit her.'")
              Print("'What? Do you know where she lives? The other side of the forst, and half way up a mountain! Oh, I suppose I better. Tomorrow, perhaps.'")
            }
            else {
              Print("'I met someone who said she was your sister. Raculi?", you tell the young woman.")
              Print ("'Oh, she's getting mixed up again,' she says brightly. 'Her sister was called Feculi too; I'm Feculi's granddaughter.'")
              Print ("'Ah, right. Anyway, she would like you to go visit her.'")
              Print ("'Of course I will.'")
            }
          </talk>
        </object>
        <object name="villager_fun">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <talk type="script">
            Print ("'That was... great. Well worh 50 gold.'")
            Print ("'Thanks, that's so sweet.'")
          </talk>
        </object>
        <object name="villager_sage_monster">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>The sage is a puppet</alias>
          <talk type="script">
            Print ("'I've thought long and hard about this,' you lie, 'but you have a right to know. The man you call the sage is just a puppet; a mannekin controlled by a tentacled demon creature.'")
            Print ("'We know.'")
            Print ("'What?'")
            Print ("'We know. We all know in the village. He's never hurt anyone, and people come from miles around to talk to the sage. I know this inn'd soon close without the custom he brings.'")
            do (innkeeper_sage_monster, "hide")
          </talk>
        </object>
      </object>
      <exit alias="west" to="town_street">
        <inherit name="westdirection" />
      </exit>
    </object>
    <object name="town_shop">
      <inherit name="editor_room" />
      <alias>The General Store</alias>
      <description>A small shop, poorly stocked as you would expect in the current economic environment. A curious little man stands behind the counter, optistically imaginatively you might buy something. Given he only sells weapon and armour, stuff you are clueless about, he is going to be disappointed.</description>
      <enviro type="object">e_building</enviro>
      <enter type="script">
        if (shopkeeper.parent = this and player.sewer) {
          Print ("The shop keeper sniffs the air and gives you a strange look.")
        }
      </enter>
      <firstenter type="script"><![CDATA[
        msg (" ")
        msg ("To make a purchase, either type <i>BUY</i>\" to see a menu of goods available, or type <i>BUY &gt;item></i> if you know exactly what you want.")
      ]]></firstenter>
      <exit alias="west" to="market_square">
        <inherit name="westdirection" />
      </exit>
      <object name="shopkeeper">
        <inherit name="editor_object" />
        <inherit name="namedmale" />
        <inherit name="monster" />
        <alias>Shopkeeper</alias>
        <attackdesc>% swings a broad sword at you</attackdesc>
        <level type="int">1</level>
        <hitpoints type="int">16</hitpoints>
        <attackbonus type="int">1</attackbonus>
        <damagedicenumber type="int">2</damagedicenumber>
        <damagedicesides type="int">8</damagedicesides>
        <image>townsman</image>
        <desc>The merchant is perhaps in his forties, and has a full beard.</desc>
        <picture>townsman.png</picture>
        <notindescription />
      </object>
    </object>
    <object name="sage_tower">
      <inherit name="editor_room" />
      <alias>Sage's tower</alias>
      <revealed type="boolean">false</revealed>
      <enviro type="object">e_building</enviro>
      <firstenter type="script">
        Print ("'Ah, you here at last,' says the sage.")
        Print ("'You knew I was coming?'")
        s = "'I knew someone was coming. You are here to fulfil the ancient prophecy. I'm a sage, you know; it is my job to know about these things."
        if (this.alias = "Sage") {
          s = " My name is Leroulk."
          this.alias = "Leroulk"
        }
        s = s + "' He pauses, then; 'A great evil has befallen our land. The Sun Queen has captured the Citadel, and sits on its throne, whilst the rightful ruler lies in her dungeon.'"
        Print (s)
      </firstenter>
      <beforeenter type="script">
        if (player.levelstatus = 3 and gem.parent = player) {
          CancelSpell
          player.maxpoints = 25
          player.levelstatus = 4
          LevelUp
        }
        sage.attacked = false
      </beforeenter>
      <enter type="script">
        if (player.status = "KoboldGlamour" and sage.parent = this) {
          Print ("'Please don't...' begs the sage, then; 'Wait, it's you. A good disguise, you even fooled me for a moment there.'")
        }
        sage_have_gem.display = (gem.parent = player)
      </enter>
      <description type="script">
        s = "The ground floor of the tower seems to be where the sage actually lives;"
        if (this.revealed) {
          s = s + " a hole in the ceiling shows there are upper levels, but there is no obvious way to climb up."
        }
        else {
          s = s + " there is no obvious way to the high storeys."
        }
        if (sage.parent = this) {
          s = s + " The room is dominated by a table, at which the sage is sat, a large book in front of him."
        }
        else if (not sage.attacked and no sage.nomore) {
          sage.parent = this
          s = s + " The room is dominated by a table, at which the sage is once more sat, a large book in front of him."
        }
        else {
          s = s + " The room is dominated by a table, at which the sage was sat earlier, a large book lies open."
        }
        s = s + "To one side is a narrow bed. The rest of the room is dedicated to clutter - mostly books."
        Print (s)
      </description>
      <truesight type="script">
        player.truesight_worked = true
        if (sage.parent = this) {
          Print ("A part of the ceiling in the centre of the room goes kind of hazy, then clears and you can see there is really a hole there. Rather more alarming is that about a dozen string fall from the hole to the sage, many attached to his head, but some to his elbows and hands.")
        }
        else {
          Print ("A part of the ceiling in the centre of the room goes kind of hazy, then clears and you can see there is really a hole there. Presumably the sage went through there.")
        }
        this.revealed = true
        sage_tower_hole.visible = true
        sage_tower_monster.visible = true
        sage_tower_string.visible = true
        do (sage_you_are_puppet, "show")
      </truesight>
      <stonesthrow type="script">
        if (this.revealed) {
          Print ("You throw the Stone of Returning up through the hole in the ceiling, into the room above.")
          stone_of_returning.parent = sage_tower_upper
        }
        else {
          Print ("You throw the Stone of Returning to the ground.")
          stone_of_returning.parent = this
        }
      </stonesthrow>
      <object name="sage">
        <inherit name="editor_object" />
        <inherit name="namedmale" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <alias>Sage</alias>
        <attackdesc>% swings his fist at you</attackdesc>
        <scenery type="boolean">false</scenery>
        <notindescription />
        <nomore type="boolean">false</nomore>
        <image>sage</image>
        <desc>An elderly man, with a long white beard, the sage is sat at a desk, a book in front of him.</desc>
        <picture>sage.png</picture>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <greet type="script">
        </greet>
        <attack type="script">
          Print ("You move to attack the sage, but before you can strike him, he rises up, passing straight through the ceiling!")
          sage.parent = nowhere
          sage.attacked = true
        </attack>
        <object name="sage_why_me">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Why tell me?</alias>
          <nowshow type="stringlist">
            <value>sage_sun_queen</value>
            <value>sage_citadel</value>
            <value>sage_any_help</value>
            <value>sage_army_wiped_out</value>
            <value>villager_sun_queen</value>
            <value>innkeeper_sun_queen</value>
            <value>sage_prophecy</value>
          </nowshow>
          <talk type="script">
            Print ("'Interesting, but what has that to do with me?'")
            s = "'The Prince attacked with an army, and they were wiped out before they even got to the gates. But where an army failed perhaps one man"
            if (player.female) {
              s = s + " - or woman -"
            }
            s = s + " might succeed.'"
            Print (s)
            Print ("'Might?'")
            Print ("'A mere figure of speech. The prophecy says you will be victorious!'")
            do (sage_offer_help, "hide")
            player.hero = player.hero - 5
          </talk>
        </object>
        <object name="sage_offer_help">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>You need my help!</alias>
          <nowshow type="stringlist">
            <value>sage_sun_queen</value>
            <value>sage_citadel</value>
            <value>sage_any_help</value>
            <value>sage_army_wiped_out</value>
            <value>villager_sun_queen</value>
            <value>innkeeper_sun_queen</value>
            <value>sage_prophecy</value>
          </nowshow>
          <talk type="script">
            Print ("'Sounds like you need my help.'")
            s = "'Indeed we do. The Prince attacked with an army, and they were wipied out before they even got to the gates. But where an army failed perhaps one man"
            if (player.female) {
              s = s + " - or woman -"
            }
            s = s + " might succeed. And the prophecy is clear!'"
            Print (s)
            Print ("'I'll give it my best shot!'")
            player.hero = player.hero + 5
            do (sage_why_me, "hide")
          </talk>
        </object>
        <object name="sage_sun_queen">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>About the Sun Queen</alias>
          <talk type="script">
            Print ("'Who is this Sun Queen?'")
            Print ("'She is a powerful witch, an expert in fire magic. Do not think to confront her until you are sure you are ready. She leads an army of foul creatures - goblins and worse - who even now occupy the Citadel.'")
          </talk>
        </object>
        <object name="sage_citadel">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>About the Citadel</alias>
          <nowshow type="stringlist">
            <value>sage_get_inside</value>
          </nowshow>
          <talk type="script">
            Print ("'What is the Citadel?'")
            Print ("'An ancient fortress, once the capital of the Kingom of Letros. Centuries ago, Letros became part of Per-Haligolia, but the Citadel was still an important city. Now it is the Sun Queen's stronghold.'")
          </talk>
        </object>
        <object name="sage_any_help">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Can you give me anything?</alias>
          <nowshow type="stringlist">
            <value>sage_moonstone</value>
            <value>sage_weapon</value>
          </nowshow>
          <talk type="script">
            Print ("'Can you give me anything to help me?'")
            Print ("'I have little that will be of use. Here is a map of the land, and a plan of the Citadel.' He hads you two pieces of paper. 'A couple of spells, too, though they have little offensive utility, I'm afraid.'")
            spell_lore.parent = player
            spell_cancel.parent = player
            map.parent = player
            plan.parent = player
          </talk>
        </object>
        <object name="sage_army_wiped_out">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>What happened to the army?</alias>
          <talk type="script">
            Print ("'So what happened to the army?'")
            Print ("'The Sun Queen conquored up a great storm in the mountains, and the torrents of water smashed the bridge whilst the army was on it. A few survived, including the Prince himself, but they were no match for the Sun Queen's kobold army.'")
          </talk>
        </object>
        <object name="sage_bad_prince">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Some say the Prince is bad...</alias>
          <talk type="script">
            Print ("'Some say the prince is bad...'")
            Print ("'People will always complain about those in charge, and I will concede he does seem to have some... issues. But he is the Prince, son of the King, who was in turn the son of the previous King.'")
          </talk>
        </object>
        <object name="sage_get_inside">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>How to get inside Citadel?</alias>
          <talk type="script">
            Print ("'How do I get inside the Citadel? I am guessing it is well-guarded.'")
            Print ("'There is a secret entrance that the Sun Queen is unaware of. It lies to the west of the gates, a crack in the rock upon which the Citadel stands.'")
          </talk>
        </object>
        <object name="sage_moonstone">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>What is the Moonstone of Rhapsody?</alias>
          <talk type="script">
            Print ("'What exactly is this moonstone?'")
            Print ("'It is a large blue gem. It is antithical to the Sun Queen's magic; the cold of the moon is opposed to the heat of the sun. If you bring it to me I will be able to craft a weapon capable of defeating her.'")
            Print ("'And where exactly will I find it?'")
            Print ("'It lies in the great gallery of the Necropolis. Find the chapel in the second courtyard; the way down is from there.'")
            Print ("'Necropolis? As in city of dead?'")
            Print ("'I'm sure a few corpses will not bother a might hero like yourself.'")
          </talk>
        </object>
        <object name="sage_weapon">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>So about this weapon..?</alias>
          <talk type="script">
            Print ("'So this weapon...'")
          </talk>
        </object>
        <object name="spell_unlock">
          <inherit name="editor_object" />
          <inherit name="nonattackspell" />
          <alias>Unlock</alias>
          <desc>This spell will unlock any door or chest in the Citadel, as long as you have the Moonstone of Rhapsody.</desc>
          <spelleffect type="script">
            if (gem.parent = player) {
              flag = False
              foreach (ex, ScopeExits ()) {
                if (GetBoolean (ex, "locked") and (Instr(ex.name, "guard") = 0)) {
                  ex.locked = False
                  flag = True
                  msg ("...The door " + ex.alias + " magically unlocks!")
                }
              }
              if (not flag) {
                msg ("...There were no doors locked")
              }
            }
            else {
              Print ("... Nothing much happens, as you do not have the Moonstone on you.")
            }
          </spelleffect>
        </object>
        <object name="spell_returning">
          <inherit name="editor_object" />
          <inherit name="nonattackspell" />
          <description>You feel as though you are being turned inside out, suddenly you are elsewhere...</description>
          <level type="int">2</level>
          <alias>Returning</alias>
          <desc>When you cast this spell you will immediately teleport to the market square in Applebrook.</desc>
          <spelleffect type="script">
            if (stone_of_returning.parent = player) {
              player.hits = player.hitpoints / 2 + 1
              Print ("For a disturbing - and agonising - moment you realise where you are is inside your own pocket! Then reality takes notice, and with a \"pop\", you revert back, almost as good as before...")
            }
            else {
              MoveObject (player, stone_of_returning.parent)
              do (sage_returning, "show")
              do (magpie_teleport, "show")
            }
          </spelleffect>
        </object>
        <object name="sage_have_gem">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>I have the moonstone!</alias>
          <talk type="script"><![CDATA[
            Print ("'I have the Moonstone!' you say to the sage.")
            Print ("'Excellent!' He takes the moonstone from you, taking a few minutes to examine it. 'Yes, this is it. Some 700 years ago, King Hurert enchanted the Citadel to prevent entry to anyone but himself. He was a curious ruler - not to say positively deranged, and ended up becoming a lich. The enchantment was subverted, and others were eventually able to unlock doors. However, this stone was the key he created, and the lingering effects of the enchantment mean that you can use it in conjunction with an <i>Unlock</i> spell to open any door in the Citadel. You will find it invaluable when rescuing the Prince.'")
            Print ("He thinks for a moment. 'I will give you a <i>Returning</i> spell too. It will bring you back to the Market Square here in Applebrook. Unfortunately, it is not powerful enough to bring two of you, so you cannot use it on the Prince. But I'm sure you'll work something out. You've done well so far.'")
            Print ("'Will it work on the magpie?'")
            Print ("'Oh yes!'")
            Print ("'Pity...'")
            spell_returning.parent = player
            spell_unlock.parent = player
          ]]></talk>
        </object>
        <object name="moonstone_amulet">
          <inherit name="editor_object" />
          <inherit name="magic_item" />
          <alias>Moonstone amulet</alias>
          <look>This somewhat gaudy tricket holds the moonstone that you recovered from the necropolis. It will protect you from fire magic.</look>
          <worn>amulet</worn>
          <price type="int">1250</price>
          <puttingon type="script">
            list add (player.immunities, "fire")
          </puttingon>
          <takingoff type="script">
            list remove (player.immunities, "fire")
          </takingoff>
        </object>
        <object name="sage_prophecy">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>About the prophecy...</alias>
          <talk type="script">
            Print ("'So about this prophecy...'")
            s = "'Ah, yes. It was made centuries ago by the great seer Ismalodos. I shall recite for you.' He puts his finger on a great tome that is already open. 'Here it is:"
            s = s + " \"Lo, a mighty hero shall appear in the land, shadowed by a great bird of black and white; " + player.haircolour + " of hair and " + player.eyecolour + " of eye, "
            if (player.female) {
              s = s + "s"
            }
            s = s + "he will defeat the fiery usurper and put the true ruler on the throne.\"'"
            Print (s)
            Print ("The description does seem to fit, but... 'That stupid magpie's not mine.'")
            Print ("'Does it shadow you?'")
            Print ("'Well, yes...'")
          </talk>
        </object>
        <object name="spell_lore">
          <inherit name="editor_object" />
          <inherit name="lastingspell" />
          <alias>Lore</alias>
          <status>Lore</status>
          <description>Somehow you feel more knowledgeable.</description>
          <desc>While this spell is active, you will learn more about places and objects when you look at them.</desc>
        </object>
        <object name="dagger">
          <inherit name="editor_object" />
          <inherit name="weapon" />
          <alias>Dagger</alias>
          <price type="int">10</price>
        </object>
        <object name="sage_you_are_puppet">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>You are a puppet</alias>
          <nowshow type="stringlist">
            <value>innkeeper_sage_monster</value>
            <value>villager_sage_monster</value>
            <value>goat_sage_monster</value>
          </nowshow>
          <talk type="script">
            Print ("'You're a puppet,' you accuse the sage.")
            Print ("'Are we not all, to some degree, at the mercy of fate?'")
            Print ("'Sure, but you're an actual puppet, controlled by strings from the room above.'")
            Print ("The sage pauses. 'It's... true.' He looks up at the ceiling, and you wonder why his controller still maintains the charade. Habit perhaps. 'I suppose I should explain. I'm a Reth'blaa - ad by I, I mean my controller in the room above. You would call me a demon. My kind do have a rather poor reputation in this realm, and I'm afraid it is well deserved. I resolved to be better. It was difficult; no one would trust me, not even enough to approach me. So I devised this set up. I live quietly in my tower, and no one suspects I am even here. The townsfolk bring me food, and people come seeking my advice. It's a quiet life, but I enjoy it. Please don't tell anyone in the village.'")
          </talk>
        </object>
        <object name="sage_password">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Do you know the password for the Citadel?</alias>
          <talk type="script">
            player.gate_password = "Dangly Giblets"
            Print ("'Do you know the password for the Citadel?' you ask the sage. He is supposed to know stuff, you reason.")
            Print ("'No, but I might be able to find out.' The sage goes motionless, so still you are not even sure he is breathing. Tghen, just when you are wondering if he will ever move again, he starts talking again. 'Yes, the password is; \"" + player.gate_password + "\".'")
          </talk>
        </object>
        <object name="sage_red_sky">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Why is the sky red?</alias>
          <talk type="script">
            Print ("'Why is the sky red?'")
            Print ("'The Sun Queen has cursed the land. While the sky is the colour of blood, all manner of foul beasts will roam the land.'")
          </talk>
        </object>
        <object name="sage_returning">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias><![CDATA[How does the <i>Returning</i> spell work?]]></alias>
          <talk type="script"><![CDATA[
            Print ("'How does the <i>Returning</i> spell work?'")
            Print ("'It's keyed to a stone that I had placed in the market square. When you cast the spell, you go to the stone.'")
            Print ("'Interesting... And what does it looklike?'")
            Print ("'It's just a flattish stone, about the size of your hand.'")
            stone_of_returning.visible = true
          ]]></talk>
        </object>
      </object>
      <exit alias="east" to="market_square">
        <inherit name="eastdirection" />
      </exit>
      <object name="magpie_upstairs">
        <inherit name="editor_object" />
        <inherit name="startingtopic" />
        <alias>Can you get upstairs?</alias>
        <scenery />
        <nowshow type="stringlist">
          <value>sage_you_are_puppet</value>
        </nowshow>
        <talk type="script"><![CDATA[
          Print ("'Could you take a look up stairs?'")
          if (sage.dead) {
            Print ("'Sure!'")
          }
          else {
            Print ("'While the old geezer's not looking? Sure!'")
          }
          if (sage.tower.revealed) {
            s = "The magpie did not have the benefit of the <i>Truesight</i> spell, so"
          }
          else {
            s = "The magpie"
          }
          Print (s + " swooped around the room, looking for the way up, then flew out the small window. It came back in a few minutes, landing on a book. 'You're not going to believe this... There's a monster up there. Green, great tentacles, ugly as shit.'")
          Print ("'Is it trapped up there?'")
          Print ("'Oh, no! It's controlling the sage! Like a puppet on strings!'")
          if (sage.tower.revealed) {
            Print ("'That's what I was guessing.'")
            Print ("'You were <i>guessing</i> it tentavled monster's controlling him?'")
          }
          else {
            Print ("'That's impossible... I think.'")
            Print ("'I saw the strings. They go right through the ceiling. Get him to stand and move around. He'll not be able to.'")
          }
        ]]></talk>
      </object>
      <object name="sage_tower_hole">
        <inherit name="editor_object" />
        <visible type="boolean">false</visible>
        <scenery />
        <alias>Hole in the ceiling</alias>
        <look>The square hole in the ceiling is neatly cut and finished, and is perhaps just big enough to squeeze through - if there was a way up.</look>
        <displayverbs type="stringlist">
          <value>Look at</value>
        </displayverbs>
      </object>
      <object name="sage_tower_monster_from_below">
        <inherit name="editor_object" />
        <visible type="boolean">false</visible>
        <scenery />
        <alias>Tentacled monster</alias>
        <look>It is hard to make out much at all of the monster in the room above, but it looks big and green, and it definitely has tentacles. You cannot see any eyes, but you somehow feel it is watching you.</look>
        <displayverbs type="stringlist">
          <value>Look at</value>
        </displayverbs>
      </object>
      <object name="sage_tower_string">
        <inherit name="editor_object" />
        <visible type="boolean">false</visible>
        <scenery />
        <alias>Strings</alias>
        <look>The strings attached to the sage are pale brown and smooth. You count fourteen altogether, all taut, moving as the sage moves.</look>
        <displayverbs type="stringlist">
          <value>Look at</value>
        </displayverbs>
        <alt type="stringlist">
          <value>string</value>
        </alt>
      </object>
      <object name="tome">
        <inherit name="editor_object" />
        <scenery />
        <look type="script"><![CDATA[
          Print ("The tome on the table is huge! It is bound in brown leather, and looks very old. It is opened to a page about three quarters of the way through. You lift up the book.")
          if (sage.parent = this.parent) {
            Print ("'Do you mind,' objects the sage.")
            Print ("'I just want to see what it's called.'")
            Print ("'This is <i>The Eternal Word of Ismalodos, Seer to the Court of Gildesh</i>. You want to knowe the author too?' You nod. 'it was written by Ismalodos, Seer to the Court of Gildesh.'")
          }
          else {
            Print ("The front proclaims that this is <i>The Eternal Word of Ismalodos, Seer to the Court of Gildesh</i>, supposedly written by the seer hmself.")
          }
        ]]></look>
        <read type="script">
          s = s + "You read the prophecy on the opened page of the tome. \"Lo, a mighty hero shall appear in the land, shadowed by a great bird of black and white; " + player.haircolour + " of hair and " + player.eyecolour + " of eye, "
          if (player.female) {
            s = s + "s"
          }
          s = s + "he will defeat the fiery usurper and put the true ruler on the throne.\""
          Print (s)
        </read>
        <take type="script">
          s = "You consider taking the great tome, but it is going to be a pain in the neck lugging that thing around, and you change your mind. You are, afterall, a "
          if (player.female) {
            s = s + "wo"
          }
          s = s + "man of action, afterall, not a scholar!"
          Print (s)
        </take>
      </object>
      <object name="sage_bed">
        <inherit name="editor_object" />
        <alias>Bed</alias>
        <scenery />
        <look>The sage's bed is a crude affair that looks curiously unused.</look>
      </object>
      <object name="sage_books">
        <inherit name="editor_object" />
        <inherit name="plural" />
        <displayverbs type="stringlist">
          <value>Look at</value>
        </displayverbs>
        <flag type="boolean">false</flag>
        <alias>Books</alias>
        <alt type="stringlist">
          <value>book</value>
        </alt>
        <scenery />
        <look type="script">
          if (this.flag) {
            Print ("You look again at all those fake books...")
          }
          else {
            s = "You look at the numerous books the sage owners. The subjects range from histories and memoirs to alchemy and astrology."
            if (sage.parent = this.parent) {
              s = s + " 'Please do not touch my books,' objects the sage, as you try to pick up a discourse on sanitation. It does not move. Ignoring the sage's complaints, you try another book, and another. You realise these are not real books; they are just wood, carved and painted to resemble books."
            }
            else {
              s = s + " You try to pick up a discourse on sanitation. It does not move. You try another book, and another. You realise these are not real books; they are just wood, carved and painted to resemble books."
            }
            Print (s)
            this.flag = true
          }
        </look>
      </object>
    </object>
    <object name="road_approaching_town">
      <inherit name="editor_room" />
      <alias>Road, Approaching Town</alias>
      <description>You are stood on a road; a properly laid road, though not in a good state of repair. To the north is a town, or perhaps village would be a better word. A few dozen houses, a tavern and a tower. To the south, the road continues for some miles before disappearing in the hills.</description>
      <enviro type="object">e_forest_road</enviro>
      <beforefirstenter type="script">
        Print ("The market in Tandren is always a lively place, and today is no different. You wander amongst the brightly coloured stalls where traders are plying their wares, looking at trinkets and curios, with no particular plan. Of course, Grand {if player.shalazin_female:Mistress}{if not player.shalazin_female:Master} Shalazin wants fairy dust and salamder ears, but there will be time for that later.")
        Print ("'You want something special?' says a voice at your shoulder. You turn, a man in dark robes is there. 'I have some special items I think you will like. Not for all eyes...' Intrigued, you follow him to a secluded alley...")
        Print ("A sudden pain at the back of your head, darkness, confusion...")
        wait {
          do (spell_cancel, "learnspell")
          do (player.startspell, "learnspell")
          magpie.parent = this
          msg (" ")
          msg (" ")
          msg (" ")
          Print ("'Arg..' you say. 'What...' You look around. This is not the market in Tandren; it is not Tandren at all. 'Where...' Head hurting, you get to your feet, and look around.")
        }
      </beforefirstenter>
      <enter type="script">
      </enter>
      <firstenter type="script">
        Print ("A magpie is stood by the side of the road, looking at you.")
        magpie.following = true
      </firstenter>
      <exit alias="south" to="road_south_of_town">
        <inherit name="southdirection" />
      </exit>
      <exit alias="north" to="town_street">
        <inherit name="northdirection" />
      </exit>
    </object>
    <object name="road_south_of_town">
      <inherit name="editor_room" />
      <alias>Road, South of the Town</alias>
      <description>The farmland has given way to forest. The road continues to the south, and looks like it does for many more miles. You could head south, return to Tandren, and abandon your chance of finding out what happened altogether, or head back north, towards the town.</description>
      <enviro type="object">e_forest_road</enviro>
      <exit alias="north" to="road_approaching_town">
        <inherit name="northdirection" />
      </exit>
      <exit alias="south" to="start">
        <inherit name="southdirection" />
        <runscript />
        <script type="script">
          ask ("Are you sure you want to abandon your quest (and end the game)?") {
            if (result) {
              Print ("You head south, determined to get back to Tandren as soon as possible, and leave whatever dangers behind you.")
              EndTheGame (1)
            }
            else {
              Print ("The road continues on to the south, but you realise your journey is the other way!")
            }
          }
        </script>
      </exit>
    </object>
    <object name="town_street">
      <inherit name="editor_room" />
      <description><![CDATA[A narrow street between the houses, this connects the road to the south with the market square to the northeast. To the east is a tavern, <i>The Drunken Pig</i>. Besides that, the buildings are modest, single-story affairs.]]></description>
      <alias>Street</alias>
      <enviro type="object">e_town</enviro>
      <beforefirstenter type="script">
      </beforefirstenter>
      <exit alias="east" to="tavern">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="northeast" to="market_square">
        <inherit name="northeastdirection" />
      </exit>
      <exit alias="south" to="road_approaching_town">
        <inherit name="southdirection" />
      </exit>
    </object>
    <object name="sage_tower_upper">
      <inherit name="editor_room" />
      <alias>Sage tower, upper floor</alias>
      <enviro type="object">e_building</enviro>
      <description type="script">
        if (not sage_tower_monster.dead) {
          Print ("The upper floor of the sage's tower is circular, and dominated by a huge tentacled monstrosity.")
        }
        else {
          Print ("The upper floor of the sage's tower is circular, and dominated by the corpse of the huge tentacled monstrosity.")
        }
      </description>
      <exit alias="down" to="sage_tower">
        <inherit name="downdirection" />
        <runscript />
        <script type="script">
          Print ("You drop down through the hole, lightly landing on the table, and then step down to the floor.")
          player.parent = this.to
        </script>
      </exit>
      <object name="sage_tower_monster">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <visible />
        <scenery type="boolean">false</scenery>
        <alias>Tentacled monster</alias>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
          <value>Attack</value>
        </displayverbs>
        <attackdesc>% swipes a tentacle at you</attackdesc>
        <level type="int">5</level>
        <hitpoints type="int">40</hitpoints>
        <attackbonus type="int">2</attackbonus>
        <damagedicenumber type="int">2</damagedicenumber>
        <damagedicesides type="int">6</damagedicesides>
        <nonweapon />
        <notindescription />
        <image>tentacled</image>
        <desc>All you can see of the creature are green and slimy tentacles writhing.</desc>
        <picture>tentacled.png</picture>
        <greet type="script">
          Print ("'So you invade my home uninvited,' says the tentacles creature.  It is not clear where the sound comes from, but he has the same voice as the sage.")
        </greet>
        <deathscript type="script">
          do (sun_queen_sage_defeated, "show")
        </deathscript>
        <object name="stm_side_with_queen">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>I have sided with the Sun Queen.</alias>
          <nowshow type="stringlist">
            <value>stm_heritary_no_reason</value>
            <value>stm_better_ruler</value>
          </nowshow>
          <exchange><![CDATA['I have sided with the Sun Queen.'<br/>'As you were destined to.'<br/>'What? You said the prophecy was that I would defeat her. Did you prophesise that I would break the prophecy?'<br/>'The prophecy was vague. But tell me, why have you betrayed the Prince?']]></exchange>
          <talk type="script">
            if (HasString(player, "offered")) {
              do (stm_better_offer, "show")
            }
            if (player.female) {
              do (stm_is_female, "show")
            }
          </talk>
        </object>
        <object name="stm_heritary_no_reason">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <nowshow type="stringlist">
            <value>stm_queen_wants_you_dead</value>
          </nowshow>
          <exchange><![CDATA['The Prince's claim to the throne is merely an accident of birth. Being born to the king is no guarantee of a good ruler, and in battle the Prince has proved himself inept, while the Sun Queen has been victorious.'<br/>'I confess I find the idea of a heritary ruler difficult to fathom myself, but it seems to be the way it is usually done among your people.'<br/>'That doesn't make it right.'<br/>'Oh, I agree. So now what?']]></exchange>
          <talk type="script">
            do (stm_heritary_no_reason, "hide")
            do (stm_better_ruler, "hide")
            do (stm_better_offer, "hide")
            do (stm_is_female, "hide")
          </talk>
        </object>
        <object name="stm_better_ruler">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <nowshow type="stringlist">
            <value>stm_queen_wants_you_dead</value>
          </nowshow>
          <exchange><![CDATA['The Sun Queen will make a better ruler. She made be ruthless in battle, but she does have some concern for education and poverty. the Prince had none.'<br/>'But the Prince is the rightful ruler according to the customs of your species.'<br/>'That doesn't make him the prefered ruler though.'<br/>'Oh, I agree. So now what?']]></exchange>
          <talk type="script">
            do (stm_heritary_no_reason, "hide")
            do (stm_better_ruler, "hide")
            do (stm_better_offer, "hide")
            do (stm_is_female, "hide")
          </talk>
        </object>
        <object name="stm_better_offer">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <nowshow type="stringlist">
            <value>stm_queen_wants_you_dead</value>
          </nowshow>
          <talk type="script">
            Print ("'The Sun Queen made me an offer. She will make me a " + player.offered + ".'")
            Print ("'Your honour is so easily bought?'")
            Print ("'What allegiance do I owe to the Prince? I'm not one of his soldiers.'")
            Print ("'I suppose not. So now what?'")
            do (stm_heritary_no_reason, "hide")
            do (stm_better_ruler, "hide")
            do (stm_better_offer, "hide")
            do (stm_is_female, "hide")
          </talk>
        </object>
        <object name="stm_queen_wants_you_dead">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>The Queen wants you dead</alias>
          <nowshow type="stringlist">
            <value>stm_a_deal</value>
          </nowshow>
          <exchange><![CDATA['The Queen has demanded that I kill you.'<br/>'How unfortunate. But wait... Is it me or the sage she wants dead?'<br/>'The sage specifically.'<br/>'Then I have a proposal. Would it be acceptable if you summoned a foul demon to do your work? That would be me, by the way. I will utterly destroy the sage for you, and then take up residency in his tower.'<br/>'So... You'll just stay here? Will the villagers like that?'<br/>It'll take some persuading, but hopefully I can convince them I am still useful to them. They seem quite pragmatic. Do we have a deal?']]></exchange>
          <talk type="script">
          </talk>
        </object>
        <object name="stm_a_deal">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Yes, we have a deal</alias>
          <nowshow type="stringlist">
            <value>sun_queen_sage_defeated_lie</value>
          </nowshow>
          <talk type="script">
            Print ("'Yes, we have a deal!'")
            Print ("'Great, so neither of us has to die. I suggest you return to the Queen and tell her the sage is no more.'")
            sage.nomore = true
          </talk>
        </object>
        <object name="stm_is_female">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Better the land is ruled by a woman</alias>
          <nowshow type="stringlist">
            <value>stm_queen_wants_you_dead</value>
          </nowshow>
          <talk type="script"><![CDATA[
            Print ("'The land is better served by having a strong woman in charge, not a man concerned only with war and his own interests.'")
            Print ("'Right on sister!'")
            Print ("'Wait, what? <i>You're</i> a woman?'")
            Print ("'I'm a female, and I feel my sisters' struggle for equality. In my realm, I would be forced to spawn young all my life, so I came here instead, to escape the phallocentric tyrany... So now what?'")
            do (stm_heritary_no_reason, "hide")
            do (stm_better_ruler, "hide")
            do (stm_better_offer, "hide")
            do (stm_is_female, "hide")
          ]]></talk>
        </object>
      </object>
    </object>
  </object>
  <object name="forest_and_marsh_south">
    <inherit name="editor_room" />
    <alias>Southern Forest and Marsh Locations</alias>
    <zone />
    <object name="road_near_town">
      <inherit name="editor_room" />
      <alias>Road, Near Town</alias>
      <enviro type="object">e_forest_road</enviro>
      <description type="script">
        s = "On the outskirts of the small town, you can see mountains to the east. To the north, the road enters a forest, and beyond the forest, you can still see the very top of the citadel."
        if (goat.parent = this) {
          Print (s + " A goat stands in the field to the west.")
        }
        else {
          Print (s)
        }
      </description>
      <exit alias="south" to="market_square">
        <inherit name="southdirection" />
      </exit>
      <exit alias="north" to="road_edge_forest">
        <inherit name="northdirection" />
      </exit>
      <object name="goat">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <alias>Goat</alias>
        <animal />
        <attackdesc>% charges at you</attackdesc>
        <hitpoints type="int">16</hitpoints>
        <damagedicesides type="int">10</damagedicesides>
        <notindescription />
        <image>goat.png</image>
        <loredesc>The goat is a Kaldra Brown, a hardy breed, known to eat anything, though this one is decidely scrawny. It eyes you suspiciously.</loredesc>
        <lookwhendead>The goat is brown, and decidely scrawny. It eyes you suspiciously.</lookwhendead>
        <desc>The goat is brown, and decidely scrawny. It eyes you suspiciously.</desc>
        <picture>goat.png</picture>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <greet type="script">
          Print ("'Hello,' you say to the goat.")
          Print ("'Well what d'you know? A talking person!'")
        </greet>
        <object name="goat_sage">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Do you know the sage?</alias>
          <talk type="script">
            Print ("'Do you know the sage?' you ask the goat.")
            Print ("'Oh, yes. He's always socialising with goats. What do you think, dumbass?'")
          </talk>
        </object>
        <object name="goat_army">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <nowshow type="stringlist">
            <value>goat_doom</value>
          </nowshow>
          <alias>Did you see the army last week?</alias>
          <talk type="script">
            Print ("'Did you seen an army come past a few days ago?'")
            Print ("'Hundreds of people, walking to their doom? yeah, what of them?'")
            Print ("'Well, anything... you can tell me about them?'")
            Print ("'Sure. They were people, there were hundreds of them, and they were walking to their doom.'")
          </talk>
        </object>
        <object name="goat_doom">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>How did you know they were doomed?</alias>
          <talk type="script">
            Print ("'How did you know they were walking to their doom?'")
            Print ("'Pheremones.' For a momemt you wonder how a goat would know such a word, before remembering it is magic. 'I could smell the fear on them. They knew they were walking to their doom.'")
          </talk>
        </object>
        <object name="goat_red_sky">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>About the red sky</alias>
          <talk type="script">
            Print ("'What about this red sky, then?'")
            Print ("The goat looks upwards for a moment. 'Yes, I like it. Blue was so last year. And they grey - how depressing. This is altogether more jolly.' He thinks for a monment. 'I hate it. Far too jolly.'")
          </talk>
        </object>
        <object name="goat_troll_bridge">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Crossed any troll bridges recently?</alias>
          <talk type="script">
            Print ("'So crossed any bridges with trolls under them recently,' you ask the goat.")
            Print ("'What? You think that's all goats do? Cross bridges infested with trolls?'")
          </talk>
        </object>
        <object name="goat_sage_monster">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>The sage is a puppet</alias>
          <talk type="script">
            Print ("'I've thought long and hard about this,' you lie, 'but you have a right to know. The man you call the sage is just a puppet; a mannequin controlled by a tentacled demon creature.'")
            Print ("'We know.'")
            Print ("'What?'")
            Print ("'We know. We all know in the village. He's never hurt anyone, and people come from miles around to talk to the sage. I know this inn'd soon close without the custom he brings.'")
            do (innkeeper_sage_monster, "hide")
          </talk>
        </object>
      </object>
    </object>
    <object name="road_edge_forest">
      <inherit name="editor_room" />
      <alias>Road, Edge of Forest</alias>
      <description>The road enters the forest here, heading somewhat northeast. You can see elm, yew and oak trees; a rough track also heads west into the forest.</description>
      <enviro type="object">e_forest_road</enviro>
      <exit alias="south" to="road_near_town">
        <inherit name="southdirection" />
      </exit>
      <exit alias="northeast" to="road_milepost">
        <inherit name="northeastdirection" />
      </exit>
      <exit alias="west" to="forest_mushroom_circle">
        <inherit name="westdirection" />
      </exit>
    </object>
    <object name="road_milepost">
      <inherit name="editor_room" />
      <alias>Road, By Milepost</alias>
      <description>The road continues through the forest. A milepost is stood at the sideof the road.</description>
      <enviro type="object">e_forest_road</enviro>
      <exit alias="southwest" to="road_edge_forest">
        <inherit name="southwestdirection" />
      </exit>
      <exit alias="north" to="road_bridge_south">
        <inherit name="northdirection" />
      </exit>
      <object name="milepost1">
        <inherit name="editor_object" />
        <scenery />
        <alias>milepost</alias>
        <look type="script">
          Print ("The milepost looks very old, but you can just make out that it is one league to the town and two to the citadel.")
          if (player.status = "Lore") {
            Print ("This is the main road from Tandren to the Citadel, built about 200 years ago - though presumably there was already some kind of track - not long after Letros became part of Per-Haligolia.")
          }
        </look>
      </object>
      <exit alias="east" to="forest_dead_sheep">
        <inherit name="eastdirection" />
      </exit>
    </object>
    <object name="road_bridge_south">
      <inherit name="editor_room" />
      <description>At one time, the road crossed a river here. Recent rains have swollen the river dramatically, and a torrent flows down from the mountains - so bad, it has washed the bridge away.</description>
      <alias>Road, South end of Bridge</alias>
      <enviro type="object">e_forest_road</enviro>
      <exit alias="south" to="road_milepost">
        <inherit name="southdirection" />
      </exit>
      <exit alias="west" to="forest_south_river">
        <inherit name="westdirection" />
      </exit>
      <object name="bridge_south">
        <inherit name="editor_object" />
        <scenery />
        <look>The bridge was made of wood. It looks like there was a central pier, and when that washed away the rest if the bridge quickly followed.</look>
        <alias>bridge</alias>
      </object>
      <exit alias="northeast" to="forest_flooded">
        <inherit name="northeastdirection" />
      </exit>
      <object name="magpie_river">
        <inherit name="editor_object" />
        <inherit name="startingtopic" />
        <alias>Can you fly across the river?</alias>
        <talk type="script">
          Print ("'Could you fly across the river?'")
          Print ("The magpie stares at you for a moment, then; 'Why?'")
          Print ("'To see what's on the other side.'")
          Print ("'The other end of busted bridge,' says the magpie pointedly not looking at the bridge.")
          Print ("'Anything else?'")
          Print ("The masgpie sighs, and taskes to the wing, flapping into the air then swooping down over the river, to rest on a post on the far side for a moment, before returning.")
          Print ("'Well?'")
          Print ("'The other end of busted bridge. And a road leading to it. I was shocked.'")
        </talk>
      </object>
    </object>
    <object name="forest_south_river">
      <inherit name="editor_room" />
      <description>This track through the forest is almost in river here. Your feet swelch through the mud.</description>
      <alias>Forest, South of River</alias>
      <enviro type="object">e_forest_river</enviro>
      <exit alias="east" to="road_bridge_south">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="southwest" to="forest_pile_bones">
        <inherit name="southwestdirection" />
      </exit>
    </object>
    <object name="forest_pile_bones">
      <inherit name="editor_room" />
      <alias>Forest, Pile of Bones</alias>
      <description>A small clearing in the forest.  There is a neat pile of bones here. A track heads west, but quickly disappears under the swollen waters of the river. Tracks also go northeast and south.</description>
      <enviro type="object">e_forest</enviro>
      <exit alias="northeast" to="forest_south_river">
        <inherit name="northeastdirection" />
      </exit>
      <exit alias="south" to="forest_mushroom_circle">
        <inherit name="southdirection" />
      </exit>
      <object name="pile_of_bones_forest">
        <inherit name="editor_object" />
        <scenery />
        <alias>pile of bones</alias>
        <alt type="stringlist">
          <value>bone</value>
        </alt>
        <look type="script">
          if (player.status = "Lore") {
            Print ("The bones are human, and probably female with the width of the pelvis. Teeth marks suggest someone got eaten here, by a wolf in all likelihood, several years ago.")
          }
          else {
            Print ("You are not sure, but you think the bones may well be human. Teeth marks suggest someone got eaten here.")
          }
        </look>
      </object>
    </object>
    <object name="forest_mushroom_circle">
      <inherit name="editor_room" />
      <alias>Forest, Mustroom Circle</alias>
      <description>There is a delightful mushroom here, where the forest starts to give way to marsh. A track of sorts leads across the boggy ground to the north west, and rather better tracks head north and east. </description>
      <enviro type="object">e_forest</enviro>
      <exit alias="north" to="forest_pile_bones">
        <inherit name="northdirection" />
      </exit>
      <exit alias="east" to="road_edge_forest">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="northwest" to="marsh_south">
        <inherit name="northwestdirection" />
      </exit>
      <object name="mushroom_circle">
        <inherit name="editor_object" />
        <alias>mushroom circle</alias>
        <scenery />
        <alt type="stringlist">
          <value>mushrooms</value>
        </alt>
        <look type="script">
          if (player.status = "Lore") {
            Print ("About a dozen mushrooms, varying in from about thumb-sized to head-sized, in a neat circle, as forms when a single specimen spawns a number of young at a distance from itself and then dies. The mushrooms are like fleshy umbrellas, green on top, grey underneath, and are definitely not edible.")
          }
          else {
            Print ("About a dozen mushrooms, varying in from about thumb-sized to head-sized, in a neat circle. The mushrooms are like fleshy umbrellas, green on top, grey underneath.")
          }
        </look>
      </object>
    </object>
    <object name="marsh_south">
      <inherit name="editor_room" />
      <alias>Marsh, South</alias>
      <enviro type="object">e_marsh</enviro>
      <description type="script">
        Print ("The river forms a delta as it reachs the sea, splitting up in to hundred of channels. The track you are following hopefully picks a route through the marsh that you can follow despite the height of the river.")
        if (mudman.parent = this) {
          if (mudman.dead) {
            Print ("A pile of mud is all that remains of the mudman.")
          }
          else {
            Print ("A creature, approximately humanoid, and seemingly made of mud stands here preventing you going north.")
          }
        }
      </description>
      <exit alias="southeast" to="forest_mushroom_circle">
        <inherit name="southeastdirection" />
      </exit>
      <exit name="exit_guarded_by_mudman" alias="north" to="marsh_north">
        <inherit name="northdirection" />
        <locked />
        <lockmessage>That way is blocked by the mudman.</lockmessage>
      </exit>
      <object name="mudman">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <alias>Mudman</alias>
        <guarding />
        <level type="int">2</level>
        <damagedicenumber type="int">2</damagedicenumber>
        <damagebonus type="int">1</damagebonus>
        <notindescription />
        <desc>Composed of primordial mud, the mudman is a horrific caricature of a man. Dark holes for eyes, a gaping mawl, and no neck or nose. It looks tough to fight, but it is guarding the way north.</desc>
        <image>mudman</image>
        <picture>mudman.png</picture>
      </object>
    </object>
    <object name="forest_high_bridge_south">
      <inherit name="editor_room" />
      <alias>Forest, South Side of Chasm</alias>
      <logfallen type="boolean">false</logfallen>
      <enviro type="object">e_forest</enviro>
      <description type="script">
        s = "You are stood on the edge of a wide chasm, carved deep by the river, someway below you."
        if (this.logfallen) {
          s = s + " No way are you getting across there!"
        }
        else {
          s = s + " As chance would have, a log has fallen across the chasm, and spans the gap. It would be precarious, but you could probably use it to get across."
        }
        s = s + " A track emerges from the forest to the southwest, heading into the mountains to the east."
        Print (s)
      </description>
      <stonesthrow type="script">
        Print ("You throw the Stone of Returning acrioss the gorge.")
        stone_of_returning.parent = forest_high_bridge_north
      </stonesthrow>
      <object name="river2">
        <inherit name="editor_object" />
        <scenery />
        <alias>river</alias>
        <look>The river here is very fast flowing; all the rainwater from the mountains forced through a narrow channel.</look>
      </object>
      <object name="chasm2">
        <inherit name="editor_object" />
        <alias>chasm</alias>
        <scenery />
        <look>The chasm is wide and deep, with a river at the bottom. Falling in it would probably be fatal.</look>
      </object>
      <object name="log_bridge2">
        <inherit name="editor_object" />
        <alias>log bridge</alias>
        <scenery />
        <look>The log is not an ideal way to cross the ravine, but looks possible with care. You can see signs someone has tried to secure the end to stop it moving. It does not look like it fell here naturally - there is no stump - but it would be no mean feat getting the log in place.</look>
      </object>
      <exit alias="southwest" to="forest_steep_track_south">
        <inherit name="southwestdirection" />
      </exit>
      <exit name="exit_log_bridge_going_north" alias="north" to="forest_high_bridge_north">
        <inherit name="northdirection" />
        <runscript />
        <script type="script">
          if (GetBoolean(player, "hasaccessacrossriver")) {
            Print ("You gingerly edge along the log, trying not to look at the great drop beneath you. You get about half way and hear a cracking sound - the log is starting to break under you wait. You move a bit faster, as the log starts to sag alarmingly.")
            Print ("You are almost there as you feel the log give way. A desparate leap, and you are scrambling up the edge of the gorge, to stand on the side, even as the remains of the log crash on to the rocks and water below.")
            exit_log_bridge_going_north.parent = dead
            exit_log_bridge_going_south.parent = dead
            forest_high_bridge_south.logfallen = true
          }
          else {
            Print ("You gingerly edge along the log, trying not to look at the great drop beneath you. The log creaks ominously beneath you, but you reach the other side safely.")
          }
          player.parent = this.to
        </script>
      </exit>
      <exit alias="east" to="forest_waterfall">
        <inherit name="eastdirection" />
      </exit>
    </object>
    <object name="forest_dead_sheep">
      <inherit name="editor_room" />
      <description>The track wided as it curves from west to northeast, rising as it does so. A sheep carcass lies beside it.</description>
      <alias>Forest, Dead Sheep</alias>
      <enviro type="object">e_forest</enviro>
      <exit alias="west" to="road_milepost">
        <inherit name="westdirection" />
      </exit>
      <object name="dead_sheep">
        <inherit name="editor_object" />
        <scenery />
        <alias>dead sheep</alias>
        <alt type="stringlist">
          <value>carcass</value>
          <value>corpse</value>
        </alt>
        <look type="script">
          if (player.status = "Lore") {
            Print ("The sheep has been dead two to three weeks. It looks to have had its throat cut, but there is no sign of its being used for meat; was it the victim of a cultic sacrifice?")
          }
          else {
            Print ("The sheep has been dead a while, you guess, and it is providing quite a feast for the maggots.")
          }
        </look>
      </object>
      <exit alias="northeast" to="forest_shrine">
        <inherit name="northeastdirection" />
      </exit>
    </object>
    <object name="forest_shrine">
      <inherit name="editor_room" />
      <alias>Forest, Shrine</alias>
      <description>A clearing, with a small shrine set in the centre. The forest slopes here, rising to the northeast. You can see tracks heading wesy, southwest, east and north.</description>
      <enviro type="object">e_forest</enviro>
      <enter type="script">
        if (player.status = "KoboldGlamour" and druid.parent = this) {
          Print ("'Die, despoiler of forests,' cries the druid, raising her staff.")
          Print ("'Wait, wait...' you stammar, as you remember you look like a kobold. 'I'm not really a kobold. Look!' You quickly cancel the spell.")
          if (player.sewer) {
            Print ("She sniffs you cautiously; 'You don't smell like a kobold - in fact you smell considerably worse than they do.'")
          }
          else {
            Print ("She sniffs you cautiously; 'You do smell human.'")
          }
          CancelSpell
        }
      </enter>
      <exit alias="southwest" to="forest_dead_sheep">
        <inherit name="southwestdirection" />
      </exit>
      <exit alias="west" to="forest_camp_site">
        <inherit name="westdirection" />
      </exit>
      <exit alias="north" to="forest_steep_track_south">
        <inherit name="northdirection" />
      </exit>
      <object name="shrine_nature">
        <inherit name="editor_object" />
        <scenery />
        <look type="script">
          if (player.status = "Lore") {
            Print ("The shrine is carved from a rocky outcrop. It is typical of those of the nature goddess known as Tera in this area. The flowers left in offering suggest she is still worshiped here.")
          }
          else {
            Print ("The shrine is carved from a rocky outcrop. You do not recognise the god, but the flowers left in offering suggest she is still worshiped in this area.")
          }
        </look>
      </object>
      <object name="druid">
        <inherit name="editor_object" />
        <inherit name="female" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <alias>Druid</alias>
        <convinced type="boolean">false</convinced>
        <attackasgroup />
        <level type="int">8</level>
        <hitpoints type="int">32</hitpoints>
        <defence type="int">4</defence>
        <attackbonus type="int">4</attackbonus>
        <damagedicenumber type="int">4</damagedicenumber>
        <movetype>Free</movetype>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <attackdesc>% swings her Earthmight staff at you</attackdesc>
        <damagedicesides type="int">4</damagedicesides>
        <notindescription />
        <image>female_druid</image>
        <desc>The druid is a wild-looking woman perhaps in her thirties, though her hair is pure white. She is holding a staff with totems affixed.</desc>
        <picture>female_druid.png</picture>
        <greet type="script">
          Print ("'Good day, you are a druid, are you not?'")
          Print ("What of it?'")
        </greet>
        <object name="druid_shrine">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <nowshow type="stringlist">
            <value>druid_tera</value>
            <value>druid_tree_huggers_suck</value>
          </nowshow>
          <alias>About the shrine</alias>
          <talk type="script">
            Print ("'Whose shrine is this?'")
            Print ("'She goes by many names, but I call her Tera, the Lady of the Forest. This shrine has stood here for nine centuries, longer than the acursed citadel, and it'll still be here when the Citadel falls.' She spits on the ground to add emphasis to her words.")
          </talk>
        </object>
        <object name="druid_spells">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <nowshow type="stringlist">
            <value>druid_spell_to_defeat</value>
          </nowshow>
          <alias>Can you teach me some spells?</alias>
          <talk type="script">
            Print ("'You're a kind of spell caster, right?'")
            Print ("'What of it? Have you a boil that needs vanishing?'")
            Print ("'No, no! I am a caster too, though only just beginning. Do you have any spells you could teach me?'")
            Print ("'You think spells are such triffles as should be given away?'")
          </talk>
        </object>
        <object name="druid_spell_to_defeat">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Help me defeat the Sun Queen</alias>
          <talk type="script"><![CDATA[
            Print ("'Spells are to be valued greatly, but so is liberty. I seek to defeat the Sun Queen, who has taken the Citadel and made it her stronghold.'")
            Print ("'I am aware of what she has done. Is she so different from the Prince, who held the Citadel before her? Both seek the security of thick stone walls, both will fall eventually. Better that the Citadel should be in the hands of a woman. But I will give you a couple of minor spells. Do you have some parchment?'")
            Print ("She takes some parchment from you, and sits cross-legged on the ground. As you watch, two spells slowly appear on the paper. After some minutes, she stands. 'Here. The <i>Animal Tongues</i> spell will allow you to commune with animals; it will make you realise that they are important too. The <i>Truesight</i> spell will allow you to see the world as it really is. Neither will allow you to defeat the Sun Queen, but might help you learn more about the world.'")
            Print ("'Er, thanks. I think.'")
            spell_tongues.parent = player
            spell_truesight.parent = player
          ]]></talk>
        </object>
        <object name="druid_tera">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Tell me about Tera</alias>
          <talk type="script">
            Print ("'Tell me more about this Lady of the forest.'")
            Print ("'She is the spirit of nature. Not a goddess who guards the forest, but the very forest itself. She lives in all the trees and all the creatures - and in us if we let her.'")
            Print ("'How would I do that?'")
          </talk>
        </object>
        <object name="spell_tongues">
          <inherit name="editor_object" />
          <inherit name="lastingspell" />
          <alias>Animal Tongues</alias>
          <status>Tongues</status>
          <description type="string"></description>
          <desc>While this spell is active, you will be able to talk to animals - though they will not necessarily want to talk to you.</desc>
        </object>
        <object name="spell_truesight">
          <inherit name="editor_object" />
          <inherit name="nonattackspell" />
          <status>Truesight</status>
          <description type="string"></description>
          <alias>Truesight</alias>
          <desc>When you cast this spell, all illusions in your vicinity will be dispelled.</desc>
          <spelleffect type="script">
            player.truesight_worked = false
            if (HasScript(player.parent, "truesight")) {
              do (player.parent, "truesight")
            }
            foreach (o, GetAllChildObjects (player.parent)) {
              if (HasScript(o, "truesight")) {
                do (o, "truesight")
              }
            }
            if (not player.truesight_worked) {
              Print ("It would seem there are no illusions here.")
            }
          </spelleffect>
        </object>
        <object name="druid_tree_huggers_suck">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Stupid tree huggers suck</alias>
          <talk type="script">
            Print ("'You're a tree hugger?' you say to the druid. 'Hippies suck big time.'")
            Print ("'If you have no regard for nature you are no better than the goblins and kobolds under the Sun Queen's control.'")
            do (druid_spells, "hide")
            do (druid_spell_to_defeat, "hide")
            do (druid_tera, "hide")
          </talk>
        </object>
        <object name="druid_staff">
          <inherit name="editor_object" />
          <inherit name="weapon" />
          <damagedicenumber type="int">4</damagedicenumber>
          <twohanded />
          <price type="int">120</price>
          <alias>Druid Staff</alias>
          <desc>This shaped, wooden staff is imbued with Earthmight, and will do a lot of damage, especially against unarmoured foes.</desc>
        </object>
      </object>
      <object name="fox">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <inherit name="male" />
        <inherit name="talkingchar" />
        <attr name="feature_usegive" type="boolean">false</attr>
        <attackasgroup />
        <alias>Fox</alias>
        <animal />
        <level type="int">5</level>
        <hitpoints type="int">16</hitpoints>
        <defence type="int">4</defence>
        <armour type="int">1</armour>
        <attackbonus type="int">3</attackbonus>
        <nonweapon />
        <movetype>Free</movetype>
        <attackdesc>% bites at you</attackdesc>
        <notindescription />
        <desc>The fox, presumably the druid's familiar, looks at you sternly from behind the druid.</desc>
        <image>fox</image>
        <picture>fox.png</picture>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <object name="fox_be_fox">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>What is it like being a fox?</alias>
          <nowshow type="stringlist">
            <value>fox_sun_queen</value>
            <value>fox_citadel</value>
            <value>fox_druid</value>
          </nowshow>
          <talk type="script">
            Print ("'So, er, what's it like, being a fox?' It is rather stange, talking to an animal. Your voice sounds perfectly normal.")
            Print ("'Pretty cool, man,' says the fox.")
          </talk>
        </object>
        <object name="fox_sun_queen">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>What do you know about the Sun Queen?</alias>
          <nowshow type="stringlist" />
          <talk type="script">
            Print ("'What do you think of the Sun Queen?' you ask the fox.")
            Print ("'She is like one bad trip all on her own. You wanna keep away from that chick.'")
          </talk>
        </object>
        <object name="fox_citadel">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Do you know how to get into the Citadel?</alias>
          <nowshow type="stringlist" />
          <talk type="script">
            Print ("'You know a way into the Citadel?'")
            Print ("'You are way to big for way I know, man,' says the fox.")
          </talk>
        </object>
        <object name="fox_druid">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>What do you think of the druid?</alias>
          <nowshow type="stringlist" />
          <talk type="script"><![CDATA[
            Print ("'What do you think of the druid?'")
            Print ("The fox looks at her. 'She's cool, man. Except when she's in fox form. Then she's <i>hot</i>, if you know what I mean!' You look at the druid again.")
            Print ("'Yes, I can understand him too,' she says to you, with a wry smile. 'And no, I'm not giving you that spell.'")
            if (not player.female) {
              Print ("You feel there is a joke here about a \"foxy lady\", but before you can say it, the moment has passed. Have to remember that for the next time you meet a good-looking girl who often turns into a fox.")
            }
          ]]></talk>
        </object>
      </object>
    </object>
    <object name="forest_camp_site">
      <inherit name="editor_room" />
      <alias>Forest, Camp Site</alias>
      <description>A clearing that loks to have been used as a campsite, to judge by three patches of scorched ground. Tracks lead north and east.</description>
      <enviro type="object">e_forest</enviro>
      <object name="scorch_marks_forest">
        <inherit name="editor_object" />
        <alias>scorch marks</alias>
        <alt type="stringlist">
          <value>scorched ground</value>
          <value>fire</value>
          <value>campfire</value>
        </alt>
        <look>It looks like people have been cooking here, you would guess on several occasions. The scorched patches are neat circles, surrounded by stones.</look>
      </object>
      <exit alias="east" to="forest_shrine">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="north" to="forest_flooded">
        <inherit name="northdirection" />
      </exit>
    </object>
    <object name="forest_flooded">
      <inherit name="editor_room" />
      <alias>Forest, flooded</alias>
      <description>The river has flooded it banks here, and to the north, the tree roots are all under water. The tracks going southwest and south are only slightly better, though the track east rises steeply and so is rather better.</description>
      <enviro type="object">e_forest</enviro>
      <exit alias="south" to="forest_camp_site">
        <inherit name="southdirection" />
      </exit>
      <exit alias="southwest" to="road_bridge_south">
        <inherit name="southwestdirection" />
      </exit>
      <exit alias="east" to="forest_steep_track_south">
        <inherit name="eastdirection" />
      </exit>
    </object>
    <object name="forest_steep_track_south">
      <inherit name="editor_room" />
      <alias>Forest, Steep Track</alias>
      <description>The forest rises steeply to the north east here. A steep track heads that way after crossing a stream on a narrow bridge. Tracks west and south slope downwards.</description>
      <enviro type="object">e_forest</enviro>
      <exit alias="west" to="forest_flooded">
        <inherit name="westdirection" />
      </exit>
      <exit alias="south" to="forest_shrine">
        <inherit name="southdirection" />
      </exit>
      <exit alias="northeast" to="forest_high_bridge_south">
        <inherit name="northeastdirection" />
      </exit>
      <object name="stream5">
        <inherit name="editor_object" />
        <look>The stream is not deep, and unlike the river looks to be no higher than usual.</look>
        <scenery />
        <alias>stream</alias>
      </object>
    </object>
    <object name="ancient_oak">
      <inherit name="editor_object" />
      <alias>ancient oak</alias>
      <scenery />
      <look>You are not sure how you know this tree is particularly old, but you are sure it is. It seems to have an aura of, well, majesty, as though it is lord of the forest.</look>
    </object>
    <object name="forest_waterfall">
      <inherit name="editor_room" />
      <alias>Forest, waterfall</alias>
      <description>This is the edge of the forest. To the north, the ground drops away into a narrow gorge, to the east a cliff face rises. A waterfall tumbles down into the gorge. Tracks lead west and south.</description>
      <smell>The air smells fresh.</smell>
      <listen>You can hear the water cascading over the rocks.</listen>
      <enviro type="object">e_forest</enviro>
      <exit alias="west" to="forest_high_bridge_south">
        <inherit name="westdirection" />
      </exit>
    </object>
  </object>
  <object name="forest_and_marsh_north">
    <inherit name="editor_room" />
    <alias>Northern Forest and Marsh Locations</alias>
    <zone />
    <object name="road_bridge_north">
      <inherit name="editor_room" />
      <description>This is the main road from the town to the citadel. It runs pretty straight north from here, and you can just se the blood red citadel. The route south... is not so good. The bridge has been washed away. A forest tack heads west.</description>
      <alias>Road, North end of Bridge</alias>
      <enviro type="object">e_forest_road</enviro>
      <exit alias="west" to="forest_shack">
        <inherit name="westdirection" />
      </exit>
      <exit alias="north" to="road_milepost_north">
        <inherit name="northdirection" />
      </exit>
      <object name="bridge_north">
        <inherit name="editor_object" />
        <alias>bridge</alias>
        <scenery />
        <look>The bridge was made of wood. It looks like there was a central pier, and when that washed away the rest if the bridge quickly followed.</look>
      </object>
    </object>
    <object name="road_milepost_north">
      <inherit name="editor_room" />
      <alias>Road, By Milepost</alias>
      <description>The road here cuts straight through the forest, south to north. A milepost lies beside the road.</description>
      <enviro type="object">e_forest_road</enviro>
      <object name="milepost2">
        <inherit name="editor_object" />
        <scenery />
        <look>The milepost looks very old, but you can just make out that it is two leagues to the town and one to the citadel. Presumably that assumes the bridge is there...</look>
      </object>
      <exit alias="south" to="road_bridge_north">
        <inherit name="southdirection" />
      </exit>
      <exit alias="north" to="road_near_citadel">
        <inherit name="northdirection" />
      </exit>
      <exit alias="east" to="forest_grave">
        <inherit name="eastdirection" />
      </exit>
    </object>
    <object name="road_near_citadel">
      <inherit name="editor_room" />
      <alias>Road, Near Citadel</alias>
      <description>The road here emerges from the forest, and it is not far to the gates of the citadel to the north.</description>
      <enviro type="object">e_forest_road</enviro>
      <exit alias="north" to="road_outside_citadel">
        <inherit name="northdirection" />
      </exit>
      <exit alias="south" to="road_milepost_north">
        <inherit name="southdirection" />
      </exit>
      <exit alias="west" to="forest_blasted_tree">
        <inherit name="westdirection" />
      </exit>
      <exit alias="east" to="forest_mushroom">
        <inherit name="eastdirection" />
      </exit>
    </object>
    <object name="road_outside_citadel">
      <inherit name="editor_room" />
      <description>You are stood outside the gates of the citadel, to the north. The road south heads back to the town.</description>
      <alias>Road, Outside the Citadel</alias>
      <enviro type="object">e_forest_road</enviro>
      <exit alias="south" to="road_near_citadel">
        <inherit name="southdirection" />
      </exit>
      <object name="magpie_look_over_gates">
        <inherit name="editor_object" />
        <inherit name="startingtopic" />
        <alias>Take a look over the gates.</alias>
        <talk type="script">
          Print ("'Can you take a look inside?'")
          Print ("The magpie looks at you for a moment. 'I guess.' He takes to the wing, flapping to gain a good height, then swoops down, over the gates, into the Citadel itself.")
          Print ("A few minutes later, he is back, landing on the ground in front of you. 'Yep, it's the Citadel.'")
          Print ("'I knew that already. What did you see in there?'")
          Print ("'A courtyard. Lot of kobolds - including a shaman and a champion. Looked like the barracks was to the left, something else to right.'")
          Print ("'What sort of thing?'")
          Print ("'Couldn't see, but something big. Smelt kind of animal-like, but... not.'")
        </talk>
      </object>
      <object name="gates">
        <inherit name="editor_object" />
        <inherit name="openable" />
        <inherit name="plural" />
        <alt type="stringlist">
          <value>gate</value>
          <value>door</value>
          <value>doors</value>
        </alt>
        <scenery />
        <alias>Gates</alias>
        <displayverbs type="stringlist">
          <value>Look at</value>
        </displayverbs>
        <feature_container />
        <unlock>There is no sign of a lock on this side of the gates.</unlock>
        <locked />
        <look type="script">
          s = "The gates of the citadel tower over you, perhaps four times your height, and wide enough to allow the biggest of wagons through. They are of ironwood, and are festooned with spikes to deter anyone considering a frontal attack."
          if (this.isopen) {
            s = s + " The right gate stands open."
          }
          Print (s)
        </look>
        <knock type="script">
          do (knock_on_gate, "script")
        </knock>
        <openscript type="script">
          if (this.isopen) {
            msg ("The gates are already open")
          }
          else if (this.locked) {
            Print ("You try the gates, but they are locked from the other side.")
          }
          else {
            Print ("You pull the right gate towards yourself, opening it enough to get through.")
            exit_road_to_gateway.locked = false
            exit_gateway_to_road.locked = false
            this.isopen = true
            gates1.isopen = true
          }
        </openscript>
        <closescript type="script">
          if (not this.isopen) {
            msg ("The gates are already closed")
          }
          else {
            Print ("You push the right gate closed.")
            exit_road_to_gateway.locked = true
            exit_gateway_to_road.locked = true
            this.isopen = false
            gates1.isopen = false
          }
        </closescript>
      </object>
      <command name="knock_on_gate">
        <pattern>knock</pattern>
        <script><![CDATA[
          if (kobold_guard.dead) {
            Print ("You knock on the gates, but there is no reply. You knock again, more urgently, but still no reply. Surely the kobold you killed, the one on guard, will have been replaced by now? Apparently not.")
          }
          else if (player.status = "KoboldGlamour") {
            Print ("You knock on the great gates and a slot opens in the gate, and you see two reptilian eyes peering through at you. 'This is the Sun Queen's now.'")
            Print ("Hoping the witch's glamour spell is working, you say; 'I know, let me in, you can see I'm one of you.'")
            Print ("The eyes narrow. 'Yeah, but are you one of the Sun Queen's kobolds?'")
            Print ("'Of course I am. Go Sun Queen! Yah!'")
            Print ("'So what's the password? No passsword, no coming in.'")
            if (player.gate_password = "") {
              Print ("'It's, er, on the tip of my tongue...' The slot closes, and the gate remains closed.")
              do (sage_password, "show")
            }
            else {
              Print ("'Of course I know the password. \"" + player.gate_password + "\".' You hope it is correct. The slot closes, but then the gate opens, allowing you inside. The kobold shuts and locks the gate behind you.")
              player.parent = citadel_first_gateway
            }
          }
          else {
            Print ("You think about knocking on the gate, and the world goes hazy for a moment. As if watching someone else, you see yourself...")
            Print ("<i>You knock on the great gates - surely the enemy will respect your forthright approach. A slot opens in the gate, and you see two reptilian eyes peering through at you. 'I thought the flood killed you all,' the creature sneers. The doors open, and several kobolds rush out and attack you! You try a spell, but it is not use, you are overrun by the filthy creatures, and you watch as you your bloody body falls to the ground.<i>")
            Print ("You shudder, in a cold sweat. It was just a vision, a premonition. Perhaps knocking on the gates is a bad idea.")
          }
        ]]></script>
      </command>
      <exit name="exit_road_to_gateway" alias="north" to="citadel_first_gateway">
        <inherit name="northdirection" />
        <locked />
      </exit>
    </object>
    <object name="forest_shack">
      <inherit name="editor_room" />
      <alias>Forest, Tumbledownshack.</alias>
      <description><![CDATA[A small clearing with a tumbledown shack off to the side. A small stream tumbles past, heading to the river to the south. The track north follows the stream. A plank of wood has been placed across the stream, and a rather better track heads east. A third track goes west.<br/>]]></description>
      <enviro type="object">e_forest</enviro>
      <exit alias="west" to="forest_giant_head">
        <inherit name="westdirection" />
      </exit>
      <exit alias="east" to="road_bridge_north">
        <inherit name="eastdirection" />
      </exit>
      <object name="tumbledown_shack">
        <inherit name="editor_object" />
        <alias>tumbledown shack</alias>
        <scenery />
        <look type="script">
          if (player.status = "Lore") {
            Print ("There really is not much left of the shack. Most of the front wall and all the right wall have gone, and of the roof there is only a few beams left. It would have been a simple structure when complete, probably home to a charcoal burner.")
          }
          else {
            Print ("There really is not much left of the shack. Most of the front wall and all the right wall have gone, and of the roof there is only a few beams left.")
          }
        </look>
      </object>
      <exit alias="north" to="forest_duck_pond">
        <inherit name="northdirection" />
      </exit>
      <object name="stream1">
        <inherit name="editor_object" />
        <look>The stream is not deep, and unlike the river looks to be no higher than usual.</look>
        <scenery />
        <alias>stream</alias>
      </object>
    </object>
    <object name="forest_cairn">
      <inherit name="editor_room" />
      <alias>Forest, Cairn</alias>
      <enviro type="object">e_forest</enviro>
      <description type="script">
        Print ("A large open area, with a small cairn in the centre.  The only way is the track south east.")
        if (centaur.parent = this) {
          if (centaur.dead) {
            Print ("The corpse of a centaur lies here.")
          }
          else {
            Print ("A centaur is tending the cairn.")
          }
        }
        if (MonsterPresent("Bugbear")) {
          if (centaur_corpse.parent = this) {
            if (centaur.dead) {
              Print ("A bugbear is eating from the corpse of the centaur you killed.")
            }
            else {
              Print ("A bugbear is eating from the corpse of a centaur.")
            }
          }
          else {
            Print ("There is a bugbear, sniffing around the cairn.")
          }
        }
        else {
          if (centaur_corpse.parent = this) {
            if (centaur.dead) {
              Print ("The corpse of the centaur you killed lies here.")
            }
            else {
              Print ("The corpse of a centaur lies here.")
            }
          }
        }
      </description>
      <exit alias="southeast" to="forest_giant_head">
        <inherit name="southeastdirection" />
      </exit>
      <object name="centaur">
        <inherit name="editor_object" />
        <inherit name="male" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <alias>Centaur</alias>
        <level type="int">4</level>
        <hitpoints type="int">50</hitpoints>
        <defence type="int">2</defence>
        <armour type="int">2</armour>
        <attackbonus type="int">3</attackbonus>
        <damagedicenumber type="int">2</damagedicenumber>
        <damagedicesides type="int">8</damagedicesides>
        <movetype>Free</movetype>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <desc>The centaur is tending the cairn.</desc>
        <image>centaur</image>
        <picture>centaur.png</picture>
        <object name="centaur_cairn">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <nowshow type="stringlist">
            <value>centaur_battle</value>
          </nowshow>
          <alias>What is the cairn for?</alias>
          <talk type="script">
            Print ("'What's the cairn for?' you ask.")
            Print ("'A battle many years, where many centaurs - and other folk - lost their lives.'")
          </talk>
        </object>
        <object name="centaur_battle">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <nowshow type="stringlist">
            <value>centaur_frost_lord</value>
          </nowshow>
          <alias>What battle?</alias>
          <talk type="script">
            Print ("'What battle?'")
            Print ("'The Frost Lord sought to rule the land. His claim was fair, he was the nephew of King Hegmai, who had recently died. But Hegmai had appointed an heir, albeit not one of royal descent. When men argue such issues, many will fall in battle.'")
          </talk>
        </object>
        <object name="centaur_citadel">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <nowshow type="stringlist">
            <value>centaur_spell</value>
            <value>centaur_secret_passage</value>
          </nowshow>
          <alias>How do I get in the citadel?</alias>
          <talk type="script">
            Print ("'I'm trying to get into the citadel.'")
            s = "'Why would anyone want to do that? Any sane centaur"
            if (player.female) {
              s = s + " or man come to that...' he peers at you carefully. 'Or woman "
            }
            else {
              s = s + " - or man come to that -"
            }
            Print (s + "would try to keep as far away as possible.'")
            Print ("'I have cetain reasons,' you say, not wanting to reveal too much. 'Do you know a way in.'")
            Print ("'There is a way, a secret passage for use in times of an emergency. It lies to the west of the main gate, a short walk north of a blasted tree. But it is hidden by illusion, and so impossible to find from this side.'")
          </talk>
        </object>
        <object name="centaur_spell">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Would a spell help?</alias>
          <talk type="script"><![CDATA[
            Print ("'Could I see through the illusion with magic?'")
            Print ("'Yes,' said the centaur thoughtfully. 'That would do it. A <i>Truesight</i> spell would reveal it. As to who miht teach you such a thing, I could not say.'")
          ]]></talk>
        </object>
        <object name="centaur_frost_lord">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Who was the frost lord?</alias>
          <talk type="script">
            Print ("'I'm glag the Frost Lord didn't win.'")
            Print ("The centaur shrugged. 'He was not a bad person. His true name was Lord Froast, but he lost the war, and hence forth became known as the Frost lord.'")
          </talk>
        </object>
        <object name="centaur_secret_passage">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>How do you know about the secret passage?</alias>
          <talk type="script">
            Print ("'How do you know about this secret passage?'")
            Print ("'I used it once, when I was a foal - I doubt I would fit through it now. A dare, to impress a rather special filly, who sadly was not as impressed as I had hoped. I showed her where I had come out, and of course she could see nothing, and so did not believe me. Ah, well.' He signed.")
          </talk>
        </object>
      </object>
      <object name="cairn">
        <inherit name="editor_object" />
        <scenery />
        <alias>cairn</alias>
        <look type="script">
          if (player.status = "Lore") {
            Print ("A carefully arranged pile of rocks, all about fist sized, and reaching to about waist height. It stands here to remember those who fell in battle when the so-called Frost Lord was defeated many decades ago.")
          }
          else {
            Print ("A carefully arranged pile of rocks, all about fist sized, and reaching to about waist height. You wonder what it signifies.")
          }
        </look>
      </object>
    </object>
    <object name="forest_giant_head">
      <inherit name="editor_room" />
      <alias>Forest, Giant Head</alias>
      <description>You are at the edge of the forest; the track south leads to the marsh. There is a giant stone head lying beside the path, tilted to one side. Tracks lead north west and east.</description>
      <enviro type="object">e_forest</enviro>
      <exit alias="northwest" to="forest_cairn">
        <inherit name="northwestdirection" />
      </exit>
      <exit alias="south" to="marsh_north">
        <inherit name="southdirection" />
      </exit>
      <exit alias="east" to="forest_shack">
        <inherit name="eastdirection" />
      </exit>
      <object name="giant_head">
        <inherit name="editor_object" />
        <scenery />
        <alias>giant head</alias>
        <look type="script">
          if (player.status = "Lore") {
            Print ("The head is considerably taller than you. Rather crudely carved from dark stone, and somewhat weathered too, it depicts a rather thickset man with a heavy frown. Centuries ago this would have been part of a complete statue, one of a pair that stood guarding the entrance to the Citadel. A violent change of ownership, accompanied by a change in religion, led to the statues being destroyed, and the heads buried (the rest of the statues would have been broken up and probably used to make or repair roads). Over the years, the river has, it would seem, unearthed this one.")
          }
          else {
            Print ("The head is considerably taller than you. Rather crudely carved from dark stone, and somewhat weathered too, you guess it depicts a rather thickset man with a heavy frown.")
          }
        </look>
        <take type="script">
          if (player.status = "Tongues" and magpie.following) {
            Print ("You spend a few minutes trying to pick up the massive head, reasoning that two heads are better than one.")
            Print ("'You planning on putting that in your pocket,' asks the magpie.")
            Print ("The head shows no sign of shifting at all, and you give up. 'I might just leave it here. It's probably cultural or something.'")
          }
          else {
            Print ("You spend a few minutes trying to pick up the massive head, reasoning that two heads are better than one. It shows no sign of shifting at all, and you give up.")
          }
        </take>
      </object>
    </object>
    <object name="forest_blasted_tree">
      <inherit name="editor_room" />
      <description>A clearing in the forest. In the centre, a tree, blacked by a lightning strike presumably. Tracks lead north, east and southeast.</description>
      <alias>Forest, Blasted Tree</alias>
      <enviro type="object">e_forest</enviro>
      <exit alias="east" to="road_near_citadel">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="southeast" to="forest_duck_pond">
        <inherit name="southeastdirection" />
      </exit>
      <object name="blasted_tree">
        <inherit name="editor_object" />
        <alias>blasted tree</alias>
        <scenery />
        <look>The blasted tree is black and lifeless, and in a strange way a little sinster.</look>
      </object>
      <exit alias="north" to="forest_dead_end">
        <inherit name="northdirection" />
      </exit>
    </object>
    <object name="forest_duck_pond">
      <inherit name="editor_room" />
      <alias>Forest, Duck Pond</alias>
      <description>The forest opens out somewhat by a pond. A track heads north west, another follows a stream from the pond southwards.</description>
      <enviro type="object">e_forest</enviro>
      <firstenter type="script">
        Print ("Three ducks fly up from the pond, startled by your movement.")
        if (player.status = "Tongues" and magpie.following) {
          Print ("'Stupid ducks,' mutters the magpie.")
        }
      </firstenter>
      <exit alias="northwest" to="forest_blasted_tree">
        <inherit name="northwestdirection" />
      </exit>
      <exit alias="south" to="forest_shack">
        <inherit name="southdirection" />
      </exit>
      <object name="stream2">
        <inherit name="editor_object" />
        <look>The stream is not deep, and unlike the river looks to be no higher than usual.</look>
        <scenery />
        <alias>stream</alias>
      </object>
      <object name="pond">
        <inherit name="editor_object" />
        <scenery />
        <look>The pond reminds you of feeding the ducks as a child, though there are no ducks here now.</look>
      </object>
      <object name="duck">
        <inherit name="editor_object" />
        <alias>ducks</alias>
        <scenery />
        <look>You look up at the sky, but the ducks are far away now.</look>
      </object>
    </object>
    <object name="forest_grave">
      <inherit name="editor_room" />
      <alias>Forest, By Grave</alias>
      <description>You can see a grave marker in the centre of this clearing. Tracks lead west and sloping upwards to the northeast.</description>
      <enviro type="object">e_forest</enviro>
      <object name="grave_forest">
        <inherit name="editor_object" />
        <scenery />
        <alias>grave marker</alias>
        <look type="script">
          if (player.status = "Tongues" and magpie.following and not GetBoolean(this, "flag")) {
            Print ("It is a simple grave marker, typical of the worshippers of Yon, indicates where a warrior fell many years ago. 'Something disturbing about a grave,' says the magpie. 'It's like humans saying they want to be eaten by worms and not proper animals.'")
            Print ("'Proper animals like you?'")
            Print ("'Well, among others.'")
            this.flag = true
          }
          else {
            Print ("It is a simple grave marker, typical of the worshippers of Yon, indicates where a warrior fell many years ago.")
          }
        </look>
      </object>
      <exit alias="northeast" to="forest_mushroom">
        <inherit name="northeastdirection" />
      </exit>
      <exit alias="west" to="road_milepost_north">
        <inherit name="westdirection" />
      </exit>
    </object>
    <object name="forest_mushroom">
      <inherit name="editor_room" />
      <description>You are in a clearing dominated by a giant mushroom. The forest slopes, rising to the east, falling to the west. Tracks lead west, southwest and east.</description>
      <alias>Forest, Giant Mushroom</alias>
      <enviro type="object">e_forest</enviro>
      <object name="giant_mushroom">
        <inherit name="editor_object" />
        <alias>giant mushroom</alias>
        <scenery />
        <look>The mushroom is red with white spots, and almost as tall as you are. You recalled tales when you were a child of feyfolk living in mushrooms, but against all the laws of narrative there is no sign of a door or windows.</look>
      </object>
      <exit alias="southwest" to="forest_grave">
        <inherit name="southwestdirection" />
      </exit>
      <exit alias="east" to="forest_steep_track">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="west" to="road_near_citadel">
        <inherit name="westdirection" />
      </exit>
    </object>
    <object name="forest_steep_track">
      <inherit name="editor_room" />
      <alias>Forest, Steep Track</alias>
      <description>The track is steep here, and footing is tricky, what with everthing so wet and muddy. The track climbs to the east, falls to the west.</description>
      <enviro type="object">e_forest</enviro>
      <exit alias="east" to="forest_high_bridge_north">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="west" to="forest_mushroom">
        <inherit name="westdirection" />
      </exit>
    </object>
    <object name="forest_high_bridge_north">
      <inherit name="editor_room" />
      <alias>Forest, North Side of Chasm</alias>
      <enviro type="object">e_forest</enviro>
      <description type="script">
        s = "You are stood on the edge of a wide chasm, carved deep by the river, someway below you."
        if (forest_high_bridge_south.logfallen) {
          s = s + " No way are you getting across there!"
        }
        else {
          s = s + " As chance would have, a log has fallen across the chasm, and spans the gap. It would be precarious, but you could probably use it to get across."
        }
        s = s + " A track heads up to the north east, and downwards to the west."
        Print (s)
      </description>
      <stonesthrow type="script">
        Print ("You throw the Stone of Returning acrioss the gorge.")
        stone_of_returning.parent = forest_high_bridge_south
      </stonesthrow>
      <object name="river1">
        <inherit name="editor_object" />
        <scenery />
        <alias>river</alias>
        <look>The river here is very fast flowing; all the rainwater from the mountains forced through a narrow channel.</look>
      </object>
      <object name="chasm1">
        <inherit name="editor_object" />
        <alias>chasm</alias>
        <scenery />
        <look>The chasm is wide and deep, with a river at the bottom. Falling in it would probably be fatal.</look>
      </object>
      <object name="log_bridge1">
        <inherit name="editor_object" />
        <alias>log bridge</alias>
        <scenery />
        <look>The log is not an ideal way to cross the ravine, but looks possible with care. You can see signs someone has tried to secure the end to stop it moving. It does not look like it fell here naturally - there is no stump - but it would be no mean feat getting the log in place.</look>
      </object>
      <exit alias="northeast" to="forest_track_ends">
        <inherit name="northeastdirection" />
      </exit>
      <exit name="exit_log_bridge_going_south" alias="south" to="forest_high_bridge_south">
        <inherit name="southdirection" />
        <runscript />
        <script type="script">
          if (GetBoolean(player, "hasaccessacrossriver")) {
            Print ("You gingerly edge along the log, trying not to look at the great drop beneath you. You get about half way and hear a cracking sound - the log is starting to break under you wait. You move a bit faster, as the log starts to sag alarmingly.")
            Print ("You are almost there as you feel the log give way. A desparate leap, and you are scrambling up the edge of the gorge, to stand on the side, even as the remains of the log crash on to the rocks and water below.")
            exit_log_bridge_going_north.parent = dead
            exit_log_bridge_going_south.parent = dead
            forest_high_bridge_south.logfallen = true
          }
          else {
            Print ("You gingerly edge along the log, trying not to look at the great drop beneath you. The log creaks ominously beneath you, but you reach the other side safely.")
          }
          player.parent = this.to
        </script>
      </exit>
      <exit alias="west" to="forest_steep_track">
        <inherit name="westdirection" />
      </exit>
    </object>
    <object name="forest_track_ends">
      <inherit name="editor_room" />
      <alias>Forest, Track Ends</alias>
      <enviro type="object">e_forest</enviro>
      <description type="script"><![CDATA[
        s = "The track just peters out here. Ahead, a cliff face marks the start of the mountains. "
        if (player.agility > exit_to_mountain_track.agility) {
          s = s + "You think you just could climb the cliff to the northeast."
        }
        else {
          s = s + "If you were a little more agile, you could probably climb the cliff to the northeast."
        }
        Print (s)
      ]]></description>
      <exit alias="southwest" to="forest_high_bridge_north">
        <inherit name="southwestdirection" />
      </exit>
      <exit name="exit_to_mountain_track" alias="climb" to="mountain_track">
        <visible />
        <runscript />
        <agility type="int">3</agility>
        <script type="script"><![CDATA[
          if (player.agility > this.agility) {
            msg ("You climb the cliff to the northeast.")
            player.parent = this.to
          }
          else {
            msg ("If only you were a little more agile, you could probably climb that cliff.")
          }
        ]]></script>
      </exit>
      <object name="magpie_scout_cliff">
        <inherit name="editor_object" />
        <inherit name="startingtopic" />
        <alias>What is up the cliff?</alias>
        <talk type="script">
          Print ("'Can you see what's up there,' yu asay to the magpie.")
          Print ("'Do I have to?' The bird flaps into the air, circles to get higher, then disappears from view.")
        </talk>
      </object>
      <object name="cliff_fface">
        <inherit name="editor_object" />
        <alias>Cliff face</alias>
        <scenery />
        <alt type="stringlist">
          <value>cliffface</value>
        </alt>
        <look>The cliff face is the start of the mountains.</look>
      </object>
    </object>
    <object name="forest_dead_end">
      <inherit name="editor_room" />
      <alias>Forest, Dead End</alias>
      <revealed type="boolean">false</revealed>
      <enviro type="object">e_forest</enviro>
      <description type="script">
        if (this.revealed) {
          Print ("The forest thins out as it approaches the rocky outcrop upon which the citadel stands. The track from the south leads into a narrow cave to the north.")
        }
        else {
          Print ("The forest thins out as it approaches the rocky outcrop upon which the citadel stands. The track from the south just stops here.")
        }
      </description>
      <truesight type="script">
        if (not this.revealed) {
          this.revealed = true
          Print ("The rocks to the north become hazy, then disappear, to reveal a narrow cave.")
          player.truesight_worked = true
          exit_narrow_cave.visible = true
        }
      </truesight>
      <exit alias="south" to="forest_blasted_tree">
        <inherit name="southdirection" />
      </exit>
      <exit name="exit_narrow_cave" alias="north" to="forest_narrow_cave">
        <inherit name="northdirection" />
        <visible type="boolean">false</visible>
      </exit>
    </object>
    <object name="forest_narrow_cave">
      <inherit name="editor_room" />
      <alias>Narrow Cave</alias>
      <description>The cave is long, and slopes upwards to the north. It is relatively smooth under foot, and the walls as well show some signs of working; it looks like the cave has been enlarged by someone as it continues to the east.</description>
      <enviro type="object">e_cave</enviro>
      <exit alias="south" to="forest_dead_end">
        <inherit name="southdirection" />
      </exit>
      <exit alias="east" to="citadel_guardroom_store">
        <inherit name="eastdirection" />
        <runscript />
        <script type="script">
          Print ("You head down the passage to the east, pushing open a door and walking through it.")
          exit_from_store.visible = true
          player.parent = this.to
        </script>
      </exit>
      <object name="magpie_fly_on">
        <inherit name="editor_object" />
        <inherit name="startingtopic" />
        <alias>Fly on ahead!</alias>
        <talk type="script">
          Print ("'Can you fly on ahead,' you say to the magpie.")
          Print ("'Why don't you run on a head, and I'll wait here. How about that?' You decide to take that as a \"no\".")
        </talk>
      </object>
    </object>
    <object name="mountain_track">
      <inherit name="editor_room" />
      <alias>Mountain track</alias>
      <description>You are now some way above the forest, on a narrow track that cuts northeast. To the east, the mountains rise higher, but you can see the Citadel to the west, with the forest to its south. The river, from its start in the mountains, cuts a winding path through the forest, through the salt marshes and into the sea on the horizon. Even Applebrook is just visible to the southwest, the sage's tower visible over the treetops.</description>
      <enviro type="object">e_mountain</enviro>
      <exit alias="southwest" to="forest_track_ends">
        <inherit name="southwestdirection" />
        <runscript />
        <script type="script">
          msg ("Carefully, you climb down.")
          game.pov.parent = this.to
        </script>
      </exit>
      <exit alias="northeast" to="mountain_slope">
        <inherit name="northeastdirection" />
      </exit>
    </object>
    <object name="mountain_slope">
      <inherit name="editor_room" />
      <alias>Mountain slope</alias>
      <description>The mountain track from the southwest stops here at a small cave, lying northwest, beside a small stream that tumbles down the mountain.</description>
      <enviro type="object">e_mountain</enviro>
      <exit alias="southwest" to="mountain_track">
        <inherit name="southwestdirection" />
      </exit>
      <exit alias="northwest" to="mountain_cave">
        <inherit name="northwestdirection" />
      </exit>
      <object name="stream3">
        <inherit name="editor_object" />
        <look>The stream is not deep, and unlike the river looks to be no higher than usual.</look>
        <scenery />
        <alias>stream</alias>
      </object>
    </object>
    <object name="mountain_cave">
      <inherit name="editor_room" />
      <alias>Mountain cave</alias>
      <description>The cave is about the size of a large room, and shows clear signs of habitation, not least of all the witch stood wstirring a cauldron.</description>
      <smell>The cave smells of wood smoke,</smell>
      <enviro type="object">e_cave</enviro>
      <enter type="script">
        if (player.status = "KoboldGlamour" and witch.parent = this) {
          Print ("'You want to be careful wandering into people's home looking like that,' says the witch.")
          Print ("'What? oh, the glamour' You cancel the spell, so you look human whilst talking to her.")
          CancelSpell
        }
      </enter>
      <exit alias="southeast" to="mountain_slope">
        <inherit name="southeastdirection" />
      </exit>
      <object name="witch">
        <inherit name="editor_object" />
        <inherit name="namedfemale" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <alias>Witch</alias>
        <attackdesc>% swings a punch at you</attackdesc>
        <image>witch</image>
        <desc>The witch is tall, slim and about a hundred yerars old. She is wearing the traditional costume of her profession.</desc>
        <picture>witch.png</picture>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <object name="witch_whats_cooking">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>What is cooking?</alias>
          <nowshow type="stringlist">
            <value>witch_kobolds_are_sentient</value>
            <value>witch_any_spare</value>
            <value>witch_where_find_kobold</value>
          </nowshow>
          <talk type="script">
            Print ("'What are you cooking,' you ask the old lady.")
            Print ("'Stew. And I'm going to put you in it!' She cackles for a moment. 'No, I'm just messing with you. I got me a kobold in it.'")
            Print ("'You're cooking a kobold?'")
            Print ("'If you slowly cook them over a low heat they can be quite good.'")
          </talk>
        </object>
        <object name="witch_kobolds_are_sentient">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>But Kobolds are thinking beings</alias>
          <talk type="script">
            Print ("'But you can't eat kobolds - they're intelligent!'")
            Print ("'You need to be a bit more cunning to get one for the pot, but after that, it's not so hard.'")
            Print ("'I meant it's morally wrong to eat intelligent beings.'")
            Print ("'Because they're intelligent! How would you like it if someone ate you?'")
            Print ("'No more than if I was a dumb chicken.'")
          </talk>
        </object>
        <object name="witch_any_spare">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Any of that stew going spare?</alias>
          <talk type="script">
            Print ("'Any of the stew going spare? I've never had kobold.'")
            if (player.female) {
              s = "'Your timing is good, girl,"
            }
            else {
              s = "'Your timing is good, young man,"
            }
            Print (s + " it should be about done. I think I could spare a little.' She finds a couple of bowls and uses the ladle she was stirring it with to fill them with stew. She hands a bowl to you.")
            Print ("It looks a little gloopy, but smells okay. She passes you some bread, and you use that to scoop up somke stew. 'Hey, this tastes okay,' you say, a little surprised. 'It's a bit like chicken.'")
            Print ("Before you know it, you have finished the lot. You hand back the bowl, with your thanks.")
          </talk>
        </object>
        <object name="witch_where_find_kobold">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Where did you get the kobold?</alias>
          <nowshow type="stringlist">
            <value>witch_kobold_glamour</value>
          </nowshow>
          <talk type="script">
            Print ("'How did you get yourself a kobold? Was it fresh?'")
            Print ("'I came across a group of them in the forest. They somehow got to fighting, and one ended up dead.'")
            Print ("'Er, somehow?'")
            Print ("'I may have cast a glamour on myself that made me appear to them as a kobold. A rather attractive kobold I might add. That did seem to spark the debate...'")
          </talk>
        </object>
        <object name="witch_name">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>What is your name?</alias>
          <talk type="script">
            Print ("'I'm " + player.alias + ", what's your name?' you say to the old woman.")
            Print ("'I'm Raculi; it is good to meet you. I don't get many visitors.'")
            Print ("'I can imagine.'")
          </talk>
        </object>
        <object name="witch_kobold_glamour">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <nowshow type="stringlist" />
          <alias>You know a kobold glamour?</alias>
          <talk type="script">
            Print ("'So you have a glamour that will make you look like a kobold?'")
            Print ("'What of it?'")
            Print ("'I have to infiltrate the Citadel. Looking like a kobold might make that more easy.'")
            Print ("She shrugs. 'I suppose I could. But I have a favour to ask in return. My sister lives in the village. Her name is Feculi. tell her I would like her to visit me - sooner rather than later.'")
            if (villager.alias = "Feculi") {
              do (villager_feculi2, "show")
              if (villager.revealed) {
                Print ("'Sure, I can do that. So Feculi is your sister? That makes sense. So that spell..?'")
              }
              else {
                Print ("'Sure, I can do that. Wait... Feculi? The girl in the tavern is your sister? But she's only... Unless... She do glamours too, can't she? Oh. So that spell..?'")
              }
            }
            else {
              do (innkeeper_feculi, "show")
              do (villager_feculi, "show")
              if (villager.revealed) {
                Print ("'Sure, I can do that. Wait, the girl in the tavern, who's really an old hag, she's your sister? I guess that makes sense. So that spell..?'")
              }
              else {
                Print ("'Sure, I can do that. So that spell..?'")
              }
            }
            Print ("'Of course!'")
            spell_kobold_glamour.parent = player
          </talk>
        </object>
        <object name="spell_kobold_glamour">
          <inherit name="editor_object" />
          <inherit name="lastingspell" />
          <status>KoboldGlamour</status>
          <alias>Kobold glamour</alias>
          <description>You cast the spell; you do not feel any different, but your hards look green and scaly now, so presumably it worked,</description>
          <desc>While this spell is active you will look like a kobold, at least to casual inspection. Kobolds - and perhaps other goblinoids - will not attack you on sight. Of course, they will still attack ifyou attack them, and if you cast this in battle, do not expect them to suddenly be your friend!</desc>
        </object>
        <object name="witch_sun_queen">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>How about the Sun Queen?</alias>
          <talk type="script">
            Print ("'What do yuou know about the Sun Queen,' you ask the old lady.")
            Print ("'She's a bad'un, that one. Powerful magicks and a heart consumed in fire.' Then; 'She's not as young as she looks, neither!'")
          </talk>
        </object>
      </object>
      <object name="cauldron">
        <inherit name="editor_object" />
        <alias>Cauldron</alias>
        <scenery />
        <look>The cauldron is huge, black and metal. It hangs from the roof of the cave by a chain attached to its handle. Under it a fire smoulders gently.</look>
      </object>
    </object>
    <object name="marsh_north">
      <inherit name="editor_room" />
      <description>You are pretty much over the river now. The ground is still boggy, but you can see the track heads clearly into firmer ground, in the forest to the north. A rather more muddy path leads further into the marsh to the west.</description>
      <alias>Marsh, North</alias>
      <enviro type="object">e_marsh</enviro>
      <exit alias="south" to="marsh_south">
        <inherit name="southdirection" />
        <runscript />
        <script type="script">
          if (not mudman.dead) {
            Print ("You head south, sneaking past the mudman that is diligently guarding the way back north.")
          }
          player.parent = this.to
        </script>
      </exit>
      <exit alias="north" to="forest_giant_head">
        <inherit name="northdirection" />
      </exit>
      <exit alias="west" to="marsh_central">
        <inherit name="westdirection" />
      </exit>
    </object>
    <object name="marsh_central">
      <inherit name="editor_room" />
      <alias>Marsh</alias>
      <description>This is a wide open area, from were you have a good view of the Citadel to the north west, rising above the forest, while to the south the river heads west wards to the sea. The ground is boggy, but it looks like you could pick your way east or northwest.</description>
      <enviro type="object">e_marsh</enviro>
      <exit alias="east" to="marsh_north">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="northwest" to="marsh_west">
        <inherit name="northwestdirection" />
      </exit>
    </object>
    <object name="marsh_west">
      <inherit name="editor_room" />
      <alias>Marsh, west</alias>
      <description>The marsh here borders the sea to the west. The ground is as boggy as ever, but only the hardiest of grasses can live in the brackish water. To the northeast, a huge pipe, wider than you are high, juts out from the rock , into the marsh, discharging it content. From the smell, you guess this is the sewer from the Citadel. Nevertheless, you could pick a way across to the northwest.</description>
      <enviro type="object">e_marsh</enviro>
      <exit alias="southeast" to="marsh_central">
        <inherit name="southeastdirection" />
      </exit>
      <exit alias="northeast" to="sewers_outlet">
        <inherit name="northeastdirection" />
        <runscript />
        <script type="script">
          Print ("The stench from the sewer is not good, but you need to get into the Citadel somehow. Doing your best not to breathe at all, you step into the, well, let uis call it the effluent. It comes up to your knees as you wade into the giant sewer pipe.")
          if (magpie.following and player.status = "Tongues" and not GetBoolean(this, "magpieflag")) {
            Print ("'So this is the sort of thing you get up to in your spare time,' says the magpie.")
            Print ("'No!'")
            this.magpieflag = true
          }
          player.parent = this.to
          if (magpie.following and player.status = "Tongues" and not GetBoolean(giant_rat, "dead")) {
            Print ("The magpie flies on a bit further, then returns and says; 'Just so you know, there's a giant rat up ahead. I only say this because I get the feeling it will attack on sight, and that will slow us down, and I realy don't want to spend any longer in here than I have to.'")
          }
        </script>
      </exit>
      <object name="pipe">
        <inherit name="editor_object" />
        <alias>Pipe</alias>
        <scenery />
        <alt type="stringlist">
          <value>sewer</value>
          <value>outlet</value>
        </alt>
        <look type="script">
          Print ("The pipe is metal and heavily corroded. You can see that it goes only a short way into to the rock, beond that the tunnel is cut directly into the stone.")
        </look>
      </object>
      <exit alias="northwest" to="marsh_far_west">
        <inherit name="northwestdirection" />
      </exit>
    </object>
    <object name="marsh_far_west">
      <inherit name="editor_room" />
      <alias>Marsh, far west</alias>
      <description>The salt marshes extend out into the sea here, and the only way is back to the southeast. This is a bleak, wind-swept place.</description>
      <enviro type="object">e_marsh</enviro>
      <exit alias="southeast" to="marsh_west">
        <inherit name="southeastdirection" />
      </exit>
      <object name="hydra">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <alias>Hydra</alias>
        <image>hydra</image>
        <desc>A semi-aquatic creature with numerous heads,</desc>
        <loredesc>A semi-aquatic creature with numerous heads, academics have speculated that it is related to the dragon, adpted for life in water. Some speculate that in fact it is a colony of creatures; each head is in fact a separate entity, but this theory so far remains unpopular with more respected scholars.</loredesc>
        <picture>hydra.png</picture>
        <look type="script">
          picture ("hydra.png")
        </look>
      </object>
    </object>
    <object name="sewers_outlet">
      <inherit name="editor_room" />
      <alias>Sewers, Outlet</alias>
      <description>You are knee-deep in raw sewage. To the southwest, you can see light and the promise of fresh air, to the west, more of what you are currently stood in.</description>
      <enviro type="object">e_sewer</enviro>
      <exit alias="southwest" to="marsh_west">
        <inherit name="southwestdirection" />
      </exit>
      <exit alias="east" to="sewers_tunnel">
        <inherit name="eastdirection" />
      </exit>
    </object>
    <object name="sewers_tunnel">
      <inherit name="editor_room" />
      <alias>Sewers, Tunnel</alias>
      <enviro type="object">e_sewer</enviro>
      <description type="script">
        s = "The sewer runs quite a distance from east to west."
        if (not giant_rat.dead) {
          s = s + " A giant rats prevents you going east."
        }
      </description>
      <exit name="exit_west_guarded_by_rat" alias="west" to="sewers_outlet">
        <inherit name="westdirection" />
        <locked />
        <lockmessage>The giant rat is preventing your escape.</lockmessage>
      </exit>
      <object name="giant_rat">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <nonweapon />
        <attackonsight />
        <alias>Giant rat</alias>
        <level type="int">1</level>
        <hitpoints type="int">20</hitpoints>
        <defence type="int">3</defence>
        <armour type="int">1</armour>
        <damagedicenumber type="int">2</damagedicenumber>
        <noncorporeal />
        <movetype>Constrained</movetype>
        <guarding />
        <image>giant_rat</image>
        <desc>This thing looks like a rat, only bigger. Much bigger.</desc>
        <loredesc>Giantism is a common way for those skilled in the art to create powerful guardians, and in many ways the rat is the idea starting point, being fierce, easy to feed and overly abundant.</loredesc>
        <picture>giant_rat.png</picture>
        <look type="script">
          msg ("")
          picture ("giant_rat.png")
        </look>
      </object>
      <exit name="exit_east_guarded_by_rat" alias="east" to="sewers_nexus">
        <inherit name="eastdirection" />
        <locked />
        <lockmessage>The giant rat is preventing your escape.</lockmessage>
        <runscript type="boolean">false</runscript>
        <script type="script">
          do (ladder, "climb")
        </script>
      </exit>
    </object>
    <object name="sewers_nexus">
      <inherit name="editor_room" />
      <alias>Sewers, Nexus</alias>
      <description>You estimate you are now under the Citadel itself. The main tunnel runs from the northeast, to the east, on a gentle slope,  and there are several small pipes connecting to this tunnel, though none of them big enough for you to crawl along. There is, however, a ladder leading upwards.</description>
      <enviro type="object">e_sewer</enviro>
      <exit alias="west" to="sewers_tunnel">
        <inherit name="westdirection" />
      </exit>
      <exit alias="northeast" to="sewers_end">
        <inherit name="northeastdirection" />
      </exit>
      <object name="ladder">
        <inherit name="editor_object" />
        <alias>ladder</alias>
        <scenery />
        <look>The ladder is metal, filthy and secured to the wall.</look>
        <climb type="script">
          Print ("You ascend the ladder, noticing there is actually light coming through a grating above you. As you reach the top, you lift up the filthy grating, and climb out, glad to be out of the sewer. You put the grating back in place.")
          player.parent = citadel_menagerie
        </climb>
      </object>
      <command name="climb_ladder_in_sewer">
        <pattern>climb</pattern>
        <script>
          do (ladder, "climb")
        </script>
      </command>
      <exit alias="up" to="citadel_menagerie">
        <inherit name="updirection" />
        <runscript />
        <script type="script">
          do (ladder, "climb")
        </script>
      </exit>
    </object>
    <object name="sewers_end">
      <inherit name="editor_room" />
      <alias>Sewers, End</alias>
      <description>This is the end of the main sewer tunnel, though many smaller pipes discharge into here.</description>
      <enviro type="object">e_sewer</enviro>
      <exit alias="southwest" to="sewers_nexus">
        <inherit name="southwestdirection" />
      </exit>
      <object name="ladder1">
        <inherit name="editor_object" />
        <alias>ladder</alias>
        <scenery />
        <look>The ladder is metal and secured to the wall.</look>
        <climb type="script">
          Print ("You ascend the ladder. As you reach the top, you lift up the cover, and climb out, glad to be out of the sewer. You put the cover back in place.")
          player.parent = citadel_menagerie
        </climb>
      </object>
      <command name="climb_ladder_in_sewer1">
        <pattern>climb</pattern>
        <script>
          do (ladder, "climb")
        </script>
      </command>
      <exit alias="up" to="citadel_cellars">
        <inherit name="updirection" />
        <runscript />
        <script type="script">
          do (ladder1, "climb")
        </script>
      </exit>
    </object>
  </object>
  <object name="outer_citadel">
    <inherit name="editor_room" />
    <zone />
    <beforeenter type="script">
    </beforeenter>
    <object name="citadel_first_gateway">
      <inherit name="editor_room" />
      <alias>Citadel, Gateway</alias>
      <description>The gateway was clearly built for something big. It is well over twice your height, and almost as wide. You notice some holes in the ceiling, and there are four sets of slots in walls where portcullises can be dropped. North takes you into the citadel, south back out.</description>
      <enviro type="object">e_citadel</enviro>
      <object name="murder_hole1">
        <inherit name="editor_object" />
        <alias>murder holes</alias>
        <alt type="stringlist">
          <value>murder hole</value>
        </alt>
        <look>The holes are about the size of your fist, and are probably to allow defenders to drop boiling oil or whatever on to any intruder.</look>
        <scenery />
      </object>
      <exit alias="north" to="citadel_first_courtyard">
        <inherit name="northdirection" />
      </exit>
      <object name="kobold_guard">
        <inherit name="editor_object" />
        <inherit name="male" />
        <inherit name="monster" />
        <alias>Kobold</alias>
        <level type="int">1</level>
        <hitpoints type="int">20</hitpoints>
        <defence type="int">2</defence>
        <armour type="int">1</armour>
        <damagedicesides type="int">4</damagedicesides>
        <damagedicenumber type="int">2</damagedicenumber>
        <movetype>Free</movetype>
        <attackonsight />
        <goblinoid />
        <image>kobold_warrior</image>
        <loredesc>Kobolds are reptilian humanoids, who would only come up to your shoulder if stood up straight, with green. scaled skin. Cunning and cruel, they breed quickly and grow fast, and the Sun Queen uses them extensively as foot soldiers.</loredesc>
        <desc>The kobold is a skulking humanoid, who would only come up to your shoulder if he stood up straight. His skin is green and scaled, and he is dressed in ragged clothes. His teeth look sharp, his eyes cruel.</desc>
        <picture>kobold_warrior.png</picture>
        <look type="script">
          picture ("kobold_warrior.png")
          if (player.status = "Lore") {
            Print ("Kobolds are reptilian humanoids, who would only come up to your shoulder if stood up straight, with green. scaled skin. Cunning and cruel, they breed quickly and grow fast, and the Sun Queen uses them extensively as foot soldiers.")
          }
          else {
            Print ("The kobold is a skulking humanoid, who would only come up to your shoulder if he stood up straight. His skin is green and scaled, and he is dressed in ragged clothes. His teeth look sharp, his eyes cruel.")
          }
        </look>
      </object>
      <exit name="exit_gateway_to_road" alias="south" to="road_outside_citadel">
        <inherit name="southdirection" />
        <locked />
      </exit>
      <object name="gates1">
        <inherit name="editor_object" />
        <inherit name="openable" />
        <alias>gates</alias>
        <feature_container />
        <alt type="stringlist">
          <value>gate</value>
          <value>door</value>
          <value>doors</value>
        </alt>
        <scenery />
        <openscript type="script">
          if (gates.isopen) {
            msg ("The gates are already open")
          }
          else if (gates.locked) {
            Print ("You try the gates, but the heavy bar is locking them shut.")
          }
          else {
            Print ("You push the left gate open enough to get through.")
            exit_road_to_gateway.locked = false
            exit_gateway_to_road.locked = false
            gates.isopen = true
            gates1.isopen = true
          }
        </openscript>
        <closescript type="script">
          if (not gates.isopen) {
            msg ("The gates are already closed")
          }
          else {
            Print ("You pull the left gate closed.")
            exit_road_to_gateway.locked = true
            exit_gateway_to_road.locked = true
            gates.isopen = false
            gates1.isopen = false
          }
        </closescript>
        <look type="script">
          s = "The gates of the Citadel tower over you, perhaps four times your height, and wide enough to allow the biggest of wagons through. "
          if (gates.isopen) {
            Print (s + "The left gate stands open")
          }
          else if (this.locked) {
            Print (s + "A heavy bar keeps the gates locked.")
          }
        </look>
        <unlock type="script"><![CDATA[
          if (not gates.locked) {
            msg ("The gates are not locked.")
          }
          if (player.strength < 3) {
            Print ("You try to lift the bar to unlock the gates, but it is too heavy for you. if only you were a little stronger...")
          }
          else {
            Print ("With a grunt, you lift the bar that locks the gates. It is certainly heavy, but you manage to heave it to the right, unlocking the gates.")
            gates.locked = false
          }
        ]]></unlock>
        <lock type="script"><![CDATA[
          if (gates.locked) {
            msg ("The gates are already locked.")
          }
          if (player.strength < 3) {
            Print ("You try to lift the bar to lock the gates, but it is too heavy for you. if only you were a little stronger...")
          }
          else {
            Print ("With a grunt, you lift the bar that locks the gates. It is certainly heavy, but you manage to heave it up off the ground, carry it to the gates, and drop it in place.")
            gates.locked = true
          }
        ]]></lock>
      </object>
      <object name="heavy_bar">
        <inherit name="editor_object" />
        <alias>Heavy bar</alias>
        <scenery />
        <look type="script">
          if (gates.locked) {
            Print ("The heavy bar is made of iron wood, and lies across almost the full width of the gateway, held inplace by ironwork, keeping the gates firmly locked.")
          }
          else {
            Print ("The heavy bar is made of iron wood, and would be almost the full width of the gateway. It is lying on the ground to the right of the gates.")
          }
        </look>
        <move type="script">
          if (gates.locked) {
            Print ("The heavy bar is made of iron wood, and lies across almost the full width of the gateway, held inplace by ironwork, keeping the gates firmly locked.")
          }
          else {
            Print ("The heavy bar is made of iron wood, and would be almost the full width of the gateway. It is lying on the ground to the right of the gates.")
          }
        </move>
        <lift type="script">
          do (this, "move")
        </lift>
      </object>
    </object>
    <object name="citadel_first_courtyard">
      <inherit name="editor_room" />
      <alias>Citadel, First Courtyard</alias>
      <description>This courtyard is almost as big as the market square in town, but the blood red stone of the citadel rising on all sides around you makes it feel quite oppressive. The huge gateway is to the south, and there are two doors almost as big to the east and south east. A more reasonably-sized door is to the west. To the north, two stone stairways lead up to a higher area - little more than a balcony really. The bulk of the citadel lies that way.</description>
      <enviro type="object">e_courtyard</enviro>
      <exit alias="south" to="citadel_first_gateway">
        <inherit name="southdirection" />
      </exit>
      <exit alias="southeast" to="citadel_coachhouse">
        <inherit name="southeastdirection" />
      </exit>
      <exit alias="east" to="citadel_lair">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="west" to="citadel_guardroom">
        <inherit name="westdirection" />
      </exit>
      <exit alias="north" to="citadel_first_courtyard_upper">
        <inherit name="northdirection" />
      </exit>
      <exit alias="up" to="citadel_first_courtyard_upper">
        <inherit name="updirection" />
        <scenery />
      </exit>
    </object>
    <object name="citadel_guardroom">
      <inherit name="editor_room" />
      <alias>Citadel, Guardroom</alias>
      <description>A long, narrow room with a low ceiling. The two windows are small, and look out on the courtyard; the only door is that way too, though there is a trapdoor in the floor. A long table with a dozen crude stools set under it are the only furniture.</description>
      <enviro type="object">e_citadel</enviro>
      <exit alias="east" to="citadel_first_courtyard">
        <inherit name="eastdirection" />
      </exit>
      <object name="guardroom_table">
        <inherit name="editor_object" />
        <scenery />
        <alias>table</alias>
        <look>The table is crudeky made from four long planks of wood, nails to a number pof cross beams, with legs attached.</look>
      </object>
      <object name="guardroom_stool">
        <inherit name="editor_object" />
        <scenery />
        <look>A simple three-legged stool.</look>
      </object>
      <exit alias="down" to="citadel_guardroom_store">
        <inherit name="downdirection" />
      </exit>
    </object>
    <object name="citadel_guardroom_store">
      <inherit name="editor_room" />
      <alias>Citadel, Guardroom store</alias>
      <enviro type="object">e_citadel</enviro>
      <description type="script">
        s = "A dark and dusty room with a vaulted ceiling, strewn with debris. A ladder leads up to a trap."
        if (exit_from_store.visible) {
          s = s + " To the west is the secret door you came through, cunningly hidden in the wall."
        }
        Print (s)
      </description>
      <exit name="exit_from_store" alias="west" to="forest_narrow_cave">
        <inherit name="westdirection" />
        <visible type="boolean">false</visible>
      </exit>
      <exit alias="up" to="citadel_guardroom">
        <inherit name="updirection" />
      </exit>
    </object>
    <object name="citadel_barracks">
      <inherit name="editor_room" />
      <alias>Citadel, Barracks</alias>
      <description>The far side of this long, narrow room is lined with bunk beds, fourteen in total. There are narrow slit windows between them. On the near side of the room, the larger windows look on to the courtyard. Doors to the northeast and southeast.</description>
      <enviro type="object">e_citadel</enviro>
      <beforefirstenter type="script">
        Generate (kobold, this, crude_spear, "Sneering kobold")
        Generate (kobold, this, crude_spear, "Stupid kobold")
        Generate (kobold, this, crude_spear, "Lazy kobold")
      </beforefirstenter>
      <exit alias="east" to="citadel_first_courtyard_upper">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="south" to="citadel_gatehouse">
        <inherit name="southdirection" />
      </exit>
      <exit alias="up" to="citadel_lower_ramparts">
        <inherit name="updirection" />
      </exit>
      <object name="bunkbeds">
        <inherit name="editor_object" />
        <alias>bunkbeds</alias>
        <alt type="stringlist">
          <value>bunk bed</value>
          <value>bunk beds</value>
          <value>bunkbed</value>
        </alt>
        <look>The bunks are nothing special; made of wood, padded with straw-filled bags.</look>
      </object>
    </object>
    <object name="citadel_coachhouse">
      <inherit name="editor_room" />
      <alias>Citadel, Coach House</alias>
      <description>This is the coachhouse - where the Sun Queen keeps her coach and various machines of war. The only door is to the northwest.</description>
      <enviro type="object">e_citadel</enviro>
      <exit alias="northwest" to="citadel_first_courtyard">
        <inherit name="northwestdirection" />
      </exit>
      <object name="machines_of_war">
        <inherit name="editor_object" />
        <alias>machines of war</alias>
        <alt type="stringlist">
          <value>machine of war</value>
        </alt>
        <scenery />
        <look>You can see three ballistas (giant crossbows), a sling, and a covered battering ram. They all look used, but carefully maintained and ready for action.</look>
      </object>
      <object name="coach">
        <inherit name="editor_object" />
        <scenery />
        <look>The coach is black, lined in red, and has places for six horses. It is open-topped, and for a moment you wonder what she does in poor weather, before remembering she is the Sun Queen. Presumable she can ensure it us not inclement.</look>
      </object>
    </object>
    <object name="citadel_lair">
      <inherit name="editor_room" />
      <alias>Citadel, Monster Lair</alias>
      <description>This is where the Sun Queen keeps the fearsome beasts she uses to terrorise the land and to dominate the battlefield. A large room, to storeys high. the floor is strew with straw, and there are barrels of water at various points. The room smells of death and blood. Probably just the creatures' last meal. Besides the huge doors to the west, a flight of wooden steps leads up to a door to the north.</description>
      <enviro type="object">e_citadel</enviro>
      <exit alias="west" to="citadel_first_courtyard">
        <inherit name="westdirection" />
      </exit>
      <exit alias="up" to="citadel_beastmasters_quarters">
        <inherit name="updirection" />
        <scenery />
      </exit>
      <exit alias="north" to="citadel_beastmasters_quarters">
        <inherit name="northdirection" />
      </exit>
      <object name="fire_bull">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <alias>Fire Bull</alias>
        <attackdesc>Head down, % charges at you</attackdesc>
        <image>fire_bull</image>
        <desc>The Fire Bull towers over you, several tonnes of pure muscle, charged with elemenatal magic. Every time it snorts, fire flickers from its nostrels.</desc>
        <armour type="int">3</armour>
        <damagebonus type="int">3</damagebonus>
        <damagedicenumber type="int">3</damagedicenumber>
        <damagedicesides type="int">7</damagedicesides>
        <hitpoints type="int">40</hitpoints>
        <nonweapon />
        <attackonsight />
        <picture>fire_bull.png</picture>
      </object>
    </object>
    <object name="citadel_first_courtyard_upper">
      <inherit name="editor_room" />
      <alias>Citadel, First Courtyard Upper</alias>
      <enviro type="object">e_courtyard</enviro>
      <exit alias="south" to="citadel_first_courtyard">
        <inherit name="southdirection" />
      </exit>
      <exit alias="down" to="citadel_first_courtyard">
        <inherit name="downdirection" />
        <scenery />
      </exit>
      <exit alias="southeast" to="citadel_beastmasters_quarters">
        <inherit name="southeastdirection" />
      </exit>
      <exit alias="west" to="citadel_barracks">
        <inherit name="westdirection" />
      </exit>
      <object name="gargoyle">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <alias>Gargoyle</alias>
        <desc>A dire cross between a bat and a statue.</desc>
        <image>gargoyle</image>
        <picture>gargoyle.png</picture>
      </object>
      <exit alias="north" to="citadel_second_gateway">
        <inherit name="northdirection" />
      </exit>
    </object>
    <object name="citadel_gatehouse">
      <inherit name="editor_room" />
      <alias>Citadel, Gatehouse</alias>
      <description>This long room extends the width of a citadel, going right across the gateway. You can see four portcullises here, raised out of the way, plus the associated mechanisms for each. Numerous slit windows overlook the forest, giving archers a relatively safe position to shoot potential attackers.</description>
      <enviro type="object">e_citadel</enviro>
      <exit alias="north" to="citadel_barracks">
        <inherit name="northdirection" />
      </exit>
    </object>
    <object name="citadel_beastmasters_quarters">
      <inherit name="editor_room" />
      <alias>Citadel, Beastmaster's Quarters</alias>
      <description>This is the quarters of the beastmaster, and this would seem to be a position of some standing. She has her own bed, and the room is relatively well-appointed, with a wardrobe, with a mirror on it, and a painting on the wall. It does smell somewhat of beasts, but perhaps she is so used to it she does not notice. Doors to west and south.</description>
      <enviro type="object">e_citadel</enviro>
      <exit alias="northwest" to="citadel_first_courtyard_upper">
        <inherit name="northwestdirection" />
      </exit>
      <exit alias="south" to="citadel_lair">
        <inherit name="southdirection" />
      </exit>
      <object name="beastmaster">
        <inherit name="editor_object" />
        <inherit name="female" />
        <inherit name="monster" />
        <alias>Beastmaster</alias>
        <desc>The beastmaster is a fearsome woman is black leather armour. She stands taller than you, and rather more muscled too! Her head is shaved, and she is brandishing a scimitar.</desc>
        <image>beastmaster</image>
        <picture>beastmaster.png</picture>
      </object>
    </object>
    <object name="citadel_lower_ramparts">
      <inherit name="editor_room" />
      <alias>Citadel, Lower Ramparts</alias>
      <description>The ramparts run around three sides of the courtyard, all except the north side where the bulk of the citadel rises up. From here you can see the forest, giving way to bog, and then the ocean as you look westward; to the east, the moutains. That might be a chimney in the town you can just see over the trees to the south.</description>
      <enviro type="object">e_courtyard</enviro>
      <exit alias="down" to="citadel_barracks">
        <inherit name="downdirection" />
      </exit>
    </object>
    <object name="monster_store">
      <inherit name="editor_room" />
      <zone />
      <object name="kobold">
        <inherit name="editor_object" />
        <inherit name="male" />
        <inherit name="monster" />
        <alias>Kobold</alias>
        <level type="int">1</level>
        <hitpoints type="int">20</hitpoints>
        <defence type="int">2</defence>
        <armour type="int">1</armour>
        <damagedicesides type="int">4</damagedicesides>
        <damagedicenumber type="int">2</damagedicenumber>
        <movetype>Free</movetype>
        <attackonsight />
        <goblinoid />
        <image>kobold_warrior</image>
        <desc>The kobold is a skulking humanoid, who would only come up to your shoulder if he stood up straight. His skin is green and scaled, and he is dressed in ragged clothes. His teeth look sharp, his eyes cruel.</desc>
        <loredesc>Kobolds are reptilian humanoids, who would only come up to your shoulder if stood up straight, with green. scaled skin. Cunning and cruel, they breed quickly and grow fast, and the Sun Queen uses them extensively as foot soldiers.</loredesc>
        <picture>kobold_warrior.png</picture>
      </object>
      <object name="iron_dagger">
        <inherit name="editor_object" />
        <alias>iron dagger</alias>
        <look>A simple iron dagger.</look>
      </object>
      <object name="crude_spear">
        <inherit name="editor_object" />
        <alias>crude spear</alias>
        <look>This spear is a metal blade tied to a straightish branch, and then tarred to seal the rope.</look>
      </object>
      <object name="kobold_shaman">
        <inherit name="editor_object" />
        <inherit name="male" />
        <inherit name="multi_monster" />
        <alias>Kobold shaman</alias>
        <level type="int">2</level>
        <defence type="int">3</defence>
        <armour type="int">1</armour>
        <attackbonus type="int">4</attackbonus>
        <damagedicesides type="int">10</damagedicesides>
        <nonweapon />
        <movetype>Free</movetype>
        <attackonsight />
        <goblinoid />
        <image>kobold_shaman</image>
        <loredesc>Kobolds are reptilian humanoids, who would only come up to your shoulder if stood up straight, with green. scaled skin. Cunning and cruel, they breed quickly and grow fast, and the Sun Queen uses them extensively as foot soldiers.</loredesc>
        <desc>The kobold is a skulking humanoid, who would only come up to your shoulder if he stood up straight. His skin is green and scaled, and he is dressed in ragged clothes. His teeth look sharp, his eyes cruel.</desc>
        <picture>kobold_shaman.png</picture>
        <object name="kobold_shaman_ice_blast">
          <inherit name="editor_object" />
          <inherit name="monster_attack" />
          <attackdesc><![CDATA[The shaman casts <i>Ice blast</i> at you]]></attackdesc>
          <damagedicenumber type="int">3</damagedicenumber>
          <nonweapon />
          <alias>Ice blast</alias>
        </object>
        <object name="kobold_shaman_lightning">
          <inherit name="editor_object" />
          <inherit name="monster_attack" />
          <attackdesc><![CDATA[The shaman casts <i>Lightning bolt</i> at you]]></attackdesc>
          <damagedicesides type="int">14</damagedicesides>
          <nonweapon />
          <alias>Lightning bolt</alias>
        </object>
        <object name="kobold_shaman_staff">
          <inherit name="editor_object" />
          <inherit name="monster_attack" />
          <attackdesc>The shaman swings his staff at you</attackdesc>
          <damagedicesides type="int">6</damagedicesides>
          <alias>Staff</alias>
        </object>
      </object>
      <object name="kobold_champion">
        <inherit name="editor_object" />
        <inherit name="male" />
        <inherit name="monster" />
        <alias>Kobold champion</alias>
        <level type="int">3</level>
        <hitpoints type="int">30</hitpoints>
        <defence type="int">3</defence>
        <armour type="int">2</armour>
        <attackbonus type="int">3</attackbonus>
        <damagedicenumber type="int">3</damagedicenumber>
        <damagedicesides type="int">6</damagedicesides>
        <damagebonus type="int">2</damagebonus>
        <movetype>Free</movetype>
        <attackonsight />
        <goblinoid />
        <image>kobold_champion</image>
        <loredesc>Kobolds are reptilian humanoids, who would only come up to your shoulder if stood up straight, with green. scaled skin. Cunning and cruel, they breed quickly and grow fast, and the Sun Queen uses them extensively as foot soldiers.</loredesc>
        <desc>The kobold is a skulking humanoid, who would only come up to your shoulder if he stood up straight. His skin is green and scaled, and he is dressed in ragged clothes. His teeth look sharp, his eyes cruel.</desc>
        <picture>kobold_champion.png</picture>
      </object>
    </object>
    <object name="citadel_second_gateway">
      <inherit name="editor_room" />
      <alias>Citadel, Second Gateway</alias>
      <description>This second gate is rather more modest than the first, merely one and a half times your height, and wide eough for three men to walk abreast. To the south the balcony overlooking the first courtyard, to the north another courtyard.</description>
      <enviro type="object">e_citadel</enviro>
      <exit alias="north" to="citadel_second_courtyard">
        <inherit name="northdirection" />
      </exit>
      <exit alias="south" to="citadel_first_courtyard_upper">
        <inherit name="southdirection" />
      </exit>
    </object>
    <object name="citadel_second_courtyard">
      <inherit name="editor_room" />
      <description>The second courtyard is perhaps a little larger than the first. The great towers of the central citadel loom over you to the east, and a further gateway gives access. Another smaller gateway heads north. To the west, it looks like a chapel forms one side of the courtyard, and there are also doors northwest and northeast.</description>
      <alias>Citadel, Second Courtyard</alias>
      <redskynoted type="boolean">false</redskynoted>
      <nighttime type="boolean">false</nighttime>
      <flag type="boolean">false</flag>
      <enviro type="object">e_courtyard</enviro>
      <beforeenter type="script">
      </beforeenter>
      <enter type="script">
        if (not this.flag and player.worldcursed) {
          msg ("As you emerge from the chapel, you realise the sky is orange. Is it sunset already?")
          this.flag = true
        }
      </enter>
      <exit alias="south" to="citadel_second_gateway">
        <inherit name="southdirection" />
      </exit>
      <exit alias="north" to="citadel_menagerie">
        <inherit name="northdirection" />
      </exit>
      <exit alias="northeast" to="citadel_quartermaster">
        <inherit name="northeastdirection" />
      </exit>
      <exit alias="southeast" to="citadel_smithy">
        <inherit name="southeastdirection" />
      </exit>
      <exit alias="west" to="citadel_chapel">
        <inherit name="westdirection" />
      </exit>
    </object>
    <object name="citadel_menagerie">
      <inherit name="editor_room" />
      <alias>Citadel, Menagerie</alias>
      <description>This small courtyard is a menagerie. Cages along three sides hold a variety of bizarre and, in most cases, unpleasant creatures. The only exit is back through the gateway to the south. A series of channels in the floor run from the cages to a grating in the centre of square.</description>
      <enviro type="object">e_citadel</enviro>
      <exit alias="south" to="citadel_second_courtyard">
        <inherit name="southdirection" />
      </exit>
      <exit alias="down" to="sewers_nexus">
        <inherit name="downdirection" />
        <runscript />
        <script type="script">
          Print ("You lift up the grating, trying to ignore the smell, and make your way down the ladder into the Citadel sewers, pulling the grating back across on your way.")
          player.parent = this.to
        </script>
      </exit>
      <object name="grating">
        <inherit name="editor_object" />
        <inherit name="openable" />
        <alias>Grating</alias>
        <scenery />
        <look>A metal grating, covering a hole in the ground.</look>
        <feature_container />
        <close type="boolean">false</close>
        <move type="script">
          Print ("You move the grating to reveal a tunnel and ladder. From the smell it is a good bet this leads to the sewers. You put the cover back for now; you do not want to fall down there!")
        </move>
        <openscript type="script">
          do (this, "move")
        </openscript>
      </object>
    </object>
    <object name="citadel_smithy">
      <inherit name="editor_room" />
      <alias>Citadel, Smithy</alias>
      <enviro type="object">e_citadel</enviro>
      <exit alias="northwest" to="citadel_second_courtyard">
        <inherit name="northwestdirection" />
      </exit>
    </object>
    <object name="citadel_quartermaster">
      <inherit name="editor_room" />
      <alias>Citadel, Quartermaster</alias>
      <enviro type="object">e_citadel</enviro>
      <exit alias="southwest" to="citadel_second_courtyard">
        <inherit name="southwestdirection" />
      </exit>
      <object name="quarterrmaster">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <alias>Quartermaster</alias>
        <desc>A rather shifty looking man; he might be willing to sell you supplies on the quiet if it meant gold in his own pocket.</desc>
        <image>peddler</image>
        <picture>peddler.png</picture>
      </object>
    </object>
    <object name="citadel_chapel">
      <inherit name="editor_room" />
      <alias>Citadel, Chapel</alias>
      <description>This chapel is dedicated to the worship of the Sun Queen, and there are statues of her in various poses down the sides. Simple wooden benches offer seating for woshipers. To the south, is the apse, with the chapel alter, and to the north, the rear of the chapel. There is also a door to the west as well as the way back to the courtyard to east.</description>
      <enviro type="object">e_citadel</enviro>
      <beforeenter type="script">
        if (player.levelstatus = 1) {
          CancelSpell
          player.maxpoints = 15
          player.levelstatus = 2
          LevelUp
        }
      </beforeenter>
      <exit alias="west" to="citadel_chapel_quarters">
        <inherit name="westdirection" />
      </exit>
      <exit alias="east" to="citadel_second_courtyard">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="south" to="citadel_chapel_apse">
        <inherit name="southdirection" />
      </exit>
      <exit alias="north" to="citadel_chapel_rear">
        <inherit name="northdirection" />
      </exit>
    </object>
    <object name="citadel_chapel_apse">
      <inherit name="editor_room" />
      <alias>Citadel, Chapel Apse</alias>
      <description>The is a raised area at the front of the chapel, with an alter made of ornate bronze, and a pair of matching lecturns. The only way is back to the central area to the north.</description>
      <enviro type="object">e_citadel</enviro>
      <exit alias="north" to="citadel_chapel">
        <inherit name="northdirection" />
      </exit>
    </object>
    <object name="citadel_chapel_quarters">
      <inherit name="editor_room" />
      <alias>Citadel, chapel Quarters</alias>
      <enviro type="object">e_citadel</enviro>
      <exit alias="east" to="citadel_chapel">
        <inherit name="eastdirection" />
      </exit>
    </object>
    <object name="citadel_chapel_rear">
      <inherit name="editor_room" />
      <alias>Citadel, Chapel Rear</alias>
      <description>This area appears to be used for ritual magic. The floor has an ornate circle inscribed in it, and there are traces of blood near the centre. The main chapel is to the south, but there is a doorway, and stairs leading downwards to the west.</description>
      <enviro type="object">e_citadel</enviro>
      <beforeenter type="script">
        if (player.levelstatus = 2 and gem.parent = player) {
          CancelSpell
          player.maxpoints = 20
          player.levelstatus = 3
          LevelUp
        }
      </beforeenter>
      <exit alias="south" to="citadel_chapel">
        <inherit name="southdirection" />
      </exit>
      <exit alias="down" to="necropolis_entrance">
        <inherit name="downdirection" />
        <scenery />
      </exit>
      <exit alias="west" to="necropolis_entrance">
        <inherit name="westdirection" />
      </exit>
    </object>
  </object>
  <object name="necropolis">
    <inherit name="editor_room" />
    <zone />
    <object name="necropolis_octagon">
      <inherit name="editor_room" />
      <alias>Necropolis, Octagon</alias>
      <description>This sizeable chamber is octagonal, with a high vaulted roof. Six of the eight corners have niches, with one or more ossuary jars. There are arched openings to north and east.</description>
      <usedefaultprefix type="boolean">false</usedefaultprefix>
      <enviro type="object">e_necropolis</enviro>
      <exit alias="east" to="necropolis_entrance">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="north" to="necropolis_great_gallery_overlook">
        <inherit name="northdirection" />
      </exit>
      <object name="ghost">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <alias>Ghost</alias>
        <noncorporeal />
        <nonweapon />
        <desc>Floating a little above the ground, theinsubstantial ghost regards you with its one good eye.</desc>
        <image>ghost</image>
        <picture>ghost.png</picture>
      </object>
    </object>
    <object name="necropolis_great_gallery_overlook">
      <inherit name="editor_room" />
      <alias>Necropolis, Overlooking Great Vault</alias>
      <usedefaultprefix type="boolean">false</usedefaultprefix>
      <enviro type="object">e_necropolis</enviro>
      <description type="script">
        s = "You are stood on a balcony overlooking an enormous chamber - the Great Vault. It is probably bigh enough to hold two sizeable houses, one on top of the other, you would guess."
        s = s + " A wide ledge runs both ways round the vault, to chambers to northwest and northeast, and then beyond them to another chamber on the opposite side, and stairs lead down from there to the vault itself."
        if (not GetBoolean(mummy, "dead")) {
          s = s + " Is something moving in the west chamber?"
        }
        if (not GetBoolean(zombie1, "dead")) {
          s = s + " You think you can see at least one thing moving in the east chamber."
        }
        if (not GetBoolean(lich, "dead")) {
          s = s + " You can definitely see some kind of armour-wearing skeleton in the vault."
        }
        s = s + " It would not be easy, but you might be able to climb down to the vault floor."
        msg (s)
      </description>
      <exit alias="south" to="necropolis_octagon">
        <inherit name="southdirection" />
      </exit>
      <exit alias="northwest" to="necropolis_west">
        <inherit name="northwestdirection" />
      </exit>
      <exit alias="northeast" to="necropolis_east">
        <inherit name="northeastdirection" />
      </exit>
      <command name="vault_climb_down">
        <pattern>climb;climb down</pattern>
        <script><![CDATA[
          if (player.agility > 3) {
            msg ("You climb over the balastrade, and then carefully down the wall of the vault, the bas relief artwork helping for the last third.")
            player.parent = necropolis_great_gallery
          }
          else {
            msg ("You climb over the balastrade, and then start to make your way down the wall of the vault. Suddenly you slip, and fall, passing the bas relief artwork on the way.")
            player.parent = necropolis_great_gallery
            player.hits = player.hits - 6
          }
        ]]></script>
      </command>
      <object name="magpie_necropolis_scout">
        <inherit name="editor_object" />
        <inherit name="startingtopic" />
        <alias>Can you scout ahead?</alias>
        <talk type="script">
          Print ("'Can you scout ahead,' you ask the magpie.")
          Print ("'yeah, I was just thinking I want to go on ahead all alone. That was just what I was thinking...' Still muttering the bird flaps its wings, and takes to the air, makes a circuit of the great chamber, before returning. ")
          Print ("'Well?'")
          Print ("'To the left, a guy all wrapped up in bandages. How hard can he be, if he is already badly injured, right? And to the right, two dead guys. Admittedly, they are moving about more than dead guys normally do, but the smell of them - they're dead alright. At the far end a table with some stuff on it, and stairs down to the centre, where there was some guy who was just bones and a skull.'")
          Print ("'So a mummy to the west and two zombies to the east, and a skeleton.'")
          Print ("'Think more lich than skeleton.'")
          Print ("'Oh.'")
        </talk>
      </object>
    </object>
    <object name="necropolis_west">
      <inherit name="editor_room" />
      <alias>Necropolis, West</alias>
      <usedefaultprefix type="boolean">false</usedefaultprefix>
      <description>The ledge from the southeast curves on round to the northeast, but there is a chamber here, the walls of which are lined with stone shelves, crowded with ossuary jars.</description>
      <enviro type="object">e_necropolis</enviro>
      <exit alias="northeast" to="necropolis_hall_ancient_stone">
        <inherit name="northeastdirection" />
      </exit>
      <exit alias="southeast" to="necropolis_great_gallery_overlook">
        <inherit name="southeastdirection" />
      </exit>
      <object name="mummy">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <alias>Mummy</alias>
        <attackonsight />
        <hitpoints type="int">20</hitpoints>
        <level type="int">2</level>
        <defence type="int">2</defence>
        <armour type="int">1</armour>
        <damagedicesides type="int">8</damagedicesides>
        <movetype>Free</movetype>
        <desc>In ancient times, priests would try to preserve the body of the deceased by embalming. Such corpses are highly prized by necromancers who can animate them for their own evil deeds.</desc>
        <image>mummy</image>
        <picture>mummy.png</picture>
      </object>
    </object>
    <object name="necropolis_east">
      <inherit name="editor_room" />
      <alias>Necropolis, East</alias>
      <usedefaultprefix type="boolean">false</usedefaultprefix>
      <description>The ledge from the southwest curves on round to the northwest, but there is a chamber here, the walls of which are lined with stone shelves, crowded with ossuary jars.</description>
      <enviro type="object">e_necropolis</enviro>
      <exit alias="northwest" to="necropolis_hall_ancient_stone">
        <inherit name="northwestdirection" />
      </exit>
      <exit alias="southwest" to="necropolis_great_gallery_overlook">
        <inherit name="southwestdirection" />
      </exit>
      <object name="zombie1">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <alias>Zombie</alias>
        <attackonsight />
        <damagedicesides type="int">6</damagedicesides>
        <movetype>Free</movetype>
        <desc>The bodies of the recently dead are easily transformed into zombies by those skilled in the necrotic arts.</desc>
        <image>zombie</image>
        <picture>zombie.png</picture>
      </object>
      <object name="zombie2">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <attackonsight />
        <damagedicesides type="int">6</damagedicesides>
        <alias>Zombie</alias>
        <image>zombie</image>
        <desc>The bodies of the recently dead are easily transformed into zombies by those skilled in the necrotic arts.</desc>
        <picture>zombie.png</picture>
      </object>
    </object>
    <object name="necropolis_hall_ancient_stone">
      <inherit name="editor_room" />
      <alias>Necropolis, Hall of Ancient Stone</alias>
      <usedefaultprefix type="boolean">false</usedefaultprefix>
      <description>The ledges running round the vault meet here. Again this chamber is filled with shelves of ossuary jars. Wide steps to the south lead down to the floor of the vault, while at the north end is a stone table. You can imagine this would have looked magnificent in days long gone, but no longer.</description>
      <enviro type="object">e_necropolis</enviro>
      <exit alias="south" to="necropolis_great_gallery">
        <inherit name="southdirection" />
      </exit>
      <exit alias="down" to="necropolis_great_gallery">
        <inherit name="downdirection" />
      </exit>
      <exit alias="southwest" to="necropolis_west">
        <inherit name="southwestdirection" />
      </exit>
      <exit alias="southeast" to="necropolis_east">
        <inherit name="southeastdirection" />
      </exit>
      <object name="lich">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <alias>Lich</alias>
        <desc>A malicious wizard who has tried to cheat death, the lich is now little more than a skeleton animated by evil in some disturbing armour.</desc>
        <image>lich</image>
        <picture>lich.png</picture>
      </object>
    </object>
    <object name="necropolis_great_gallery">
      <inherit name="editor_room" />
      <alias>Necropolis, Great Gallery</alias>
      <usedefaultprefix type="boolean">false</usedefaultprefix>
      <description>You feel dwarfed by the size of the Great Vault, now you are stood in it.</description>
      <enviro type="object">e_necropolis</enviro>
      <firstenter type="script">
        msg ("'You come to steal my gem?' hisses the lich. 'Many have tried, all have failed. Some serve me still,' it waves a skeltal claw to the overlooking chamber to the east. 'Soon you will too.'")
      </firstenter>
      <exit alias="north" to="necropolis_hall_ancient_stone">
        <inherit name="northdirection" />
      </exit>
      <exit alias="up" to="necropolis_hall_ancient_stone">
        <inherit name="updirection" />
      </exit>
      <command name="vault_climb_up">
        <pattern>climb</pattern>
        <script><![CDATA[
          if (player.agility > 3) {
            msg ("You climb up the wall of the vault, the bas relief artwork helping at least some of the way.")
            player.parent = necropolis_great_gallery_overlook
          }
          else {
            msg ("You try to climb up the wall of the vault, the bas relief artwork helping at first, but you cannot get any further, and drop back down to the floor of the vault.")
          }
        ]]></script>
      </command>
      <object name="stone_table">
        <inherit name="editor_object" />
        <inherit name="surface" />
        <feature_container />
        <scenery />
        <look>A large table, with six thick legs, all of white stone.</look>
        <hidechildren />
        <listchildren />
        <listchildrenprefix>On it you can see:</listchildrenprefix>
        <object name="lich_spell_book">
          <inherit name="editor_object" />
          <alias>Lich's spell book</alias>
          <look>A large book, bound in beige leather.</look>
          <take type="script">
            Print ("You consider grabbing the spell book, but it would only slow you down. It would be easier to just get the useful spells,and leave the book.")
          </take>
          <read type="script"><![CDATA[
            Print ("You do not have time to read the book, but you quickly skim though it. Most of it describes rituals for necromancy; creating mummies, raising spectres and such like. They seem to involve a lot of blood. However, there are a couple of spells that would be useful; <i>Mark</i> and <i>Teleport</i>.")
            spell_teleport.visible = true
            spell_mark.visible = true
          ]]></read>
          <object name="spell_teleport">
            <inherit name="editor_object" />
            <inherit name="nonattackspell" />
            <description type="string"></description>
            <alias>Teleport</alias>
            <level type="int">1</level>
            <visible type="boolean">false</visible>
            <desc><![CDATA[This spell will teleport the caster instantly to a location where the caster has previously cast <i>Mark</i>.]]></desc>
            <spelleffect type="script"><![CDATA[
              if (not HasObject(player, "teleportdestination")) {
                msg ("You need to cast <i>Mark</i> to set a destination for <i>Teleport</i>.")
              }
              else if (player.parent = player.teleportdestination) {
                Print ("You feel as though you are being turned inside out, suddenly you are... in the same place.")
              }
              else {
                Print ("You feel as though you are being turned inside out, suddenly you are elsewhere...")
                MoveObject (player, player.teleportdestination)
                do (magpie_teleport, "show")
              }
            ]]></spelleffect>
          </object>
          <object name="spell_mark">
            <inherit name="editor_object" />
            <inherit name="nonattackspell" />
            <description><![CDATA[You cast <i>Mark</i>, storing this location for further use.]]></description>
            <alias>Mark</alias>
            <level type="int">1</level>
            <visible type="boolean">false</visible>
            <desc><![CDATA[This spell will mark this location, setting it as the destination for a <i>Teleport</i> spell.]]></desc>
            <spelleffect type="script">
              player.teleportdestination = player.parent
            </spelleffect>
          </object>
        </object>
        <object name="curved_dagger">
          <inherit name="editor_object" />
          <inherit name="weapon" />
          <alias>Curved dagger</alias>
          <look>This silver dagger has a blade that curves one way, then the other. It looks fancy, but would not be great in battle; its purpose was probably ceremonial. Probably worth quite a bit, though.</look>
          <price type="int">45</price>
        </object>
        <object name="gem">
          <inherit name="editor_object" />
          <inherit name="magic_item" />
          <alias>The Moonstone of Rhapsody</alias>
          <corruptionnoted type="boolean">false</corruptionnoted>
          <take />
          <worn>amulet</worn>
          <price type="int">740</price>
          <look type="script"><![CDATA[
            s = "The gem is about two inches across, cut with 22 facets, with a bluish hue that looks green from certain angles."
            if (player.intelligence > 4) {
              s = s + " You can sense magic with in, lots of magic, but there is corruption too. Perhaps it has been in the possession of the lich too long."
              this.corruptionnoted = true
            }
            else if (player.intelligence > 2) {
              s = s + " You can sense magic with in."
            }
            msg (s)
          ]]></look>
          <ontake type="script">
            if (not player.worldcursed) {
              CurseTheWorld
            }
          </ontake>
        </object>
      </object>
    </object>
    <object name="necropolis_entrance">
      <inherit name="editor_room" />
      <alias>Necropolis, Entrance</alias>
      <usedefaultprefix type="boolean">false</usedefaultprefix>
      <description>A large, rectangular room, with a vaulted roof, and a stone floor. Stone benches are fitted along the longer sides, north and south. Stairs to the east lead up to the chapel, while the main complex of the necropolis is west.</description>
      <enviro type="object">e_necropolis</enviro>
      <beforeenter type="script">
      </beforeenter>
      <enter type="script">
      </enter>
      <beforefirstenter type="script">
        msg ("As everyone knows, a necropolis is just somewhere to entomb the dead. Spooky, to be sure, but no reason to suppose there will be anything to worry about down here apart from the occasion rat.")
        game.necropolis_visited = true
      </beforefirstenter>
      <firstenter type="script">
        msg ("Traditionally the dead are dedicated to the air and the earth; a year exposed to the air in a death-tower, then the bones are collected in an ossuary jar, and placed in the necropolis. This room is where relatives of the deceased might sit and remember.")
      </firstenter>
      <exit alias="up" to="citadel_chapel_rear">
        <inherit name="updirection" />
        <scenery />
      </exit>
      <exit alias="east" to="citadel_chapel_rear">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="west" to="necropolis_octagon">
        <inherit name="westdirection" />
      </exit>
    </object>
  </object>
  <object name="nighttime">
    <inherit name="editor_room" />
    <zone />
    <object name="bugbear">
      <inherit name="editor_object" />
      <inherit name="monster" />
      <alias>Bugbear</alias>
      <goblinoid />
      <desc>A fearsome humanoid, in some way related to the goblins, but rather more bestial.</desc>
      <image>bugbear</image>
      <picture>bugbear.png</picture>
    </object>
    <object name="spider">
      <inherit name="editor_object" />
      <inherit name="monster" />
      <alias>Giant spider</alias>
      <image>giant_spider</image>
      <desc>Eight legs of horror!</desc>
      <picture>giant_spider.png</picture>
    </object>
    <object name="shambling_mound">
      <inherit name="editor_object" />
      <inherit name="monster" />
      <alias>Shambling Mound</alias>
      <image>shambling_mound</image>
      <desc>Humanoid, flesh-eating vegetation!</desc>
      <picture>shambing_mound.png</picture>
    </object>
    <object name="spectre">
      <inherit name="editor_object" />
      <inherit name="monster" />
      <alias>Spectre</alias>
      <desc>A floating apparition of evil.</desc>
      <image>spectre</image>
      <picture>spectre.png</picture>
    </object>
    <object name="centaur_corpse">
      <inherit name="editor_object" />
      <scenery />
      <look>The centaur's corpse is half eaten, and buzzing with flies.</look>
    </object>
  </object>
  <object name="inner_citadel">
    <inherit name="editor_room" />
    <zone />
    <object name="fire_elemental">
      <inherit name="editor_object" />
      <inherit name="monster" />
      <alias>Fire elemental</alias>
      <image>fire_elemental</image>
      <desc>A swirling mass of fire.</desc>
      <picture>fire_elemental.png</picture>
    </object>
    <object name="slug">
      <inherit name="editor_object" />
      <inherit name="monster" />
      <alias>Giant slug</alias>
      <image>giant_slug</image>
      <desc>At least fifteen foot of slimy slug.</desc>
      <picture>giant_slug.png</picture>
    </object>
    <object name="imp">
      <inherit name="editor_object" />
      <inherit name="monster" />
      <alias>Imp</alias>
      <desc>Do not underestimate imps. Being small just makes them harder to hit.</desc>
      <image>imp</image>
      <picture>imp.png</picture>
    </object>
    <object name="lava_elemental">
      <inherit name="editor_object" />
      <inherit name="monster" />
      <alias>Lava elemental</alias>
      <image>lava_elemental</image>
      <desc>An anthropomorphic pile of lava, solidifying at its extremities.</desc>
      <picture>lava_elemental.png</picture>
    </object>
    <object name="lava_golem">
      <inherit name="editor_object" />
      <inherit name="monster" />
      <alias>Lava golem</alias>
      <picture>lave_golem.png</picture>
      <desc>A giant humanoid, it skin is solid lava, its interior molten.</desc>
    </object>
    <object name="tentacled_horror">
      <inherit name="editor_object" />
      <inherit name="monster" />
      <alias>Tentacled horror</alias>
      <desc>A writhing black mass of mouths and eyes.</desc>
      <image>tentacled_horror</image>
      <picture>tentacled_horror.png</picture>
    </object>
    <object name="citadel_cellars">
      <inherit name="editor_room" />
      <alias>Citadel cellars</alias>
      <enviro type="object">e_citadel</enviro>
      <object name="manhole_cover">
        <inherit name="editor_object" />
        <inherit name="openable" />
        <alias>Manhole cover</alias>
        <scenery />
        <look>A metal disk, covering a hole in the ground.</look>
        <feature_container />
        <close type="boolean">false</close>
        <move type="script">
          Print ("You move the cover to reveal a tunnel and ladder. From the smell it is a good bet this leads to the sewers. You put the cover back for now; you do not want to fall down there!")
        </move>
        <openscript type="script">
          do (this, "move")
        </openscript>
      </object>
      <exit alias="down" to="sewers_end">
        <inherit name="downdirection" />
        <runscript />
        <script type="script">
          Print ("You lift up the manhole cover, trying to ignore the smell, and make your way down the ladder into the Citadel sewers, pulling the cover back across on your way.")
          player.parent = this.to
        </script>
      </exit>
      <exit alias="up" to="lower_gallery">
        <inherit name="updirection" />
      </exit>
    </object>
    <object name="throne_room">
      <inherit name="editor_room" />
      <alias>Throne room</alias>
      <revealed type="boolean">false</revealed>
      <enviro type="object">e_inner_citadel</enviro>
      <description type="script">
        if (this.revealed) {
          s = "This is a large room, with a high ceiling. Two columns of bare pillars run down each side, and from the walls hang ancient tapestries. The door to the east leads to the throne room, and back to the west is the gallery."
        }
        else {
          s = "This is a large room, with a high ceiling, ornately painted. Two columns of pillars, intricately carved, and inlaid with gilt, run down each side, and from the walls hang magnificent tapestries. The door to the east leads to the throne room, and back to the west is the gallery."
        }
        if (sun_queen.parent = this and not sun_queen.dead) {
          if (general_halidaar.parent = this and not general_halidaar.dead) {
            s = s + " The Sun Queen is here, sat on the throne, talking to one of her generals."
          }
          else {
            s = s + " The Sun Queen is here, sat on the throne."
          }
        }
        else {
          if (general_halidaar.parent = this and not general_halidaar.dead) {
            s = s + " One of the Sun Queen's generals is here."
          }
        }
        if (bodyguard.parent = this and not bodyguard.dead) {
          s = s + " A half-orc bodyguasrd stands beside the throne."
        }
        Print (s)
      </description>
      <truesight type="script">
        player.truesight_worked = true
        if (sage.parent = this) {
          Print ("A part of the ceiling in the centre of the room goes kind of hazy, then clears and you can see there is really a hole there. Rather more alarming is that about a dozen string fall from the hole to the sage, many attached to his head, but some to his elbows and hands.")
        }
        else {
          Print ("A part of the ceiling in the centre of the room goes kind of hazy, then clears and you can see there is really a hole there. Presumably the sage went through there.")
        }
        this.revealed = true
        do (sun_queen_illusion, "show")
        do (illusionist_illusion, "show")
      </truesight>
      <object name="sun_queen">
        <inherit name="editor_object" />
        <inherit name="namedfemale" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <alias>Sun Queen</alias>
        <notindescription />
        <image>sunqueen</image>
        <desc>The Sun Queen looked rather young than her years.</desc>
        <picture>sunqueen.png</picture>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <object name="sun_queen_prophecy">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>The prophecy says I will defeat you</alias>
          <talk type="script">
            Print ("'The prophecy says I will defeat you,' you say to the Sun Queen.")
            Print ("'I am well aware of the prophecy. That is why I had you brought here.'")
            Print ("'Er, what?'")
            if (player.female) {
              Print ("'Somewhere out there is a real hero, someone destined to defeat me. I don't want to have to confront her - she might beat me. So I got you. Same " + player.haircolour + " hair, same " + player.eyecolour + " eyes. I even got that stupid bird to follow you round. Now all I have to confront is some dumb sap who let herself get mugged in Tandren markets, rather than someone actually competent.'")
            }
            else {
              Print ("'Somewhere out there is a real hero, someone destined to defeat me. I don't want to have to confront him - he might beat me. So I got you. Same " + player.haircolour + " hair, same " + player.eyecolour + " eyes. I even got that stupid bird to follow you round. Now all I have to confront is some dumb sap who let himself get mugged in Tandren markets, rather than someone actually competent.'")
            }
            Print ("'Oh. Well, I guess that explains why me.'")
          </talk>
        </object>
        <object name="sun_queen_massacre">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>You massacred all those soldiers</alias>
          <nowshow type="stringlist">
            <value>sun_queen_red_sky</value>
            <value>sun_queen_kobolds</value>
          </nowshow>
          <talk type="script">
            Print ("'You massacred all those soldiers,' you accuse the queen.")
            Print ("'Me? Hardly! They were killed by a rain storm. I'm a Sun Queen. Why would I use water to kill them?'")
            Print ("'So who..?'")
          </talk>
        </object>
        <object name="sun_queen_red_sky">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>You made the sky red!</alias>
          <talk type="script">
            Print ("'Perhaps you didn't massacre the soldiers, but you made the sky red!'")
            Print ("She laughs. 'You've got me there. A message to the citizens of this fair land that I am now their ruler.'")
            Print ("'And you sent all those creatures.'")
            Print ("'A quick way to bolster my defences. They won't wander from from the Citadel. I think.'")
          </talk>
        </object>
        <object name="sun_queen_kobolds">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>You have an army of kobolds!</alias>
          <nowshow type="stringlist">
            <value>sun_queen_kobolds_choose_evil</value>
            <value>sun_queen_kobolds_inherently_evil</value>
          </nowshow>
          <talk type="script">
            Print ("'You lead an army of kobolds and whatever.'")
            Print ("'What of it?'")
            Print ("'They are evil. They are your minions, so you must be evil.'")
            Print ("'Evil? All of them? Do they choose to be evil, do you suppose?'")
          </talk>
        </object>
        <object name="sun_queen_kobolds_choose_evil">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Kobolds choose evil</alias>
          <talk type="script">
            Print ("'Kobolds choose evil; they are cruel and cowardly by their nature.'")
            Print ("'All of them freely make the same choice? Does that not seem a litle unlikely to you? How many have you actually talked to?'")
            Print ("'Are you saying they're not evil?'")
            Print ("'Kobolds are all different just like people. I employ them as mercenaries because they have a certain shock value and, to be frank, they're relatively cheap.'")
            do (sun_queen_kobolds_inherently_evil, "hide")
          </talk>
        </object>
        <object name="sun_queen_kobolds_inherently_evil">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Kobolds are inherently evil</alias>
          <talk type="script">
            Print ("'Kobolds are inherently evil.'")
            Print ("'Strangely, they used to say the same of humans. They at least have learnt to be more open-minded.'")
            Print ("'Are you saying they're not evil?'")
            Print ("'No more than people are. I employ them as mercenaries because they have a certain shock value and, to be frank, they're relatively cheap.'")
            do (sun_queen_kobolds_choose_evil, "hide")
          </talk>
        </object>
        <object name="sun_queen_stole_throne">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>You stole the throne!</alias>
          <nowshow type="stringlist">
            <value>sun_queen_divine_right</value>
            <value>sun_queen_might_is_right</value>
            <value>sun_queen_might_does_not_make_right</value>
            <value>prince_grandfather_mandrin</value>
          </nowshow>
          <talk type="script">
            Print ("'You stole the throne from Prince Mandrin!' you accuse the Sun Queen.")
            Print ("'By what right was it his?'")
            Print ("'His father is King.'")
            Print ("'So being born in the right place at the right time makes him a ruler?'")
            Print ("'Of course,' you say, a little unsure. Is a hereditary king the best way?")
            Print ("'What of King Mandrin, the prince's great grandfather? Both the son of a blacksmith, he rose through King Letros' army, and then used it to depose the king, and take his place. I am following a fine tradition of grabbing the throne by might.'")
          </talk>
        </object>
        <object name="sun_queen_might_is_right">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Might is right, I suppose</alias>
          <nowshow type="stringlist">
            <value>sun_queen_job</value>
          </nowshow>
          <talk type="script">
            Print ("'I guess might is right then,' you concede.")
            Print ("'Exactly,' she smiles. 'So why risk your life trying to defeat me?'")
            do (sun_queen_divine_right, "hide")
            do (sun_queen_might_is_right, "hide")
            do (sun_queen_might_does_not_make_right, "hide")
          </talk>
        </object>
        <object name="sun_queen_might_does_not_make_right">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Might does not make right</alias>
          <talk type="script">
            Print ("'Might does not make right. What King Mendrin did was wrong, but that is the situation we are in now. We can't go into the past and correct that, but neither can we use the mistakes of the past to justify the present. Prince Mendril is the ruler under King Laliano, and I intend to keep it that way. Not for them, but for all the other people; the farmers and smiths and merchants, who will suffer and possibly die if you keep the land in civil war.'")
            Print ("'You are nobler than I gave you credit for. Very well then, it seems we have no choice.'")
            do (sun_queen_divine_right, "hide")
            do (sun_queen_might_is_right, "hide")
            do (sun_queen_might_does_not_make_right, "hide")
            do (sun_queen, "settoattack")
          </talk>
        </object>
        <object name="sun_queen_divine_right">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Prince Mendrin rules by divine right</alias>
          <nowshow type="stringlist">
            <value>sun_queen_job</value>
          </nowshow>
          <talk type="script">
            Print ("'Prince Mendrin rules by divine right. If King Mendrin took ther throne by force, that show that the gods were on his side, and so is further evidence of the divine right of rulership.'")
            Print ("'But I have Prince Mendrin in my dungeon. It looks as those the gods have forsake the royal line, and have now chosen me, just a the previously abandoned King Julos.'")
            Print ("'Hmm, that kind of makes sense.'")
            do (sun_queen_divine_right, "hide")
            do (sun_queen_might_is_right, "hide")
            do (sun_queen_might_does_not_make_right, "hide")
          </talk>
        </object>
        <object name="sun_queen_job">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Can I join you?</alias>
          <talk type="script"><![CDATA[
            Print ("'So, er, can I join you? You make a good case, and, well, you do have the Prince in your dungeon.'")
            Print ("'How delightful,' she laughs. 'You entered here determined to kill me, now you wish to join me. Why should I take someone so willing to betray {if player.female:her}{if not player.female:his} principles?'")
            Print ("'You've got an army of mercenary kobolds. How loyal are they?'")
            s = "'She shrugs. 'A fair point. But still I must know. If you will kill the sage, I will accept you. Indeed, you have shown yourself to be resourceful - more so than I ever imagined. Do this for me and I will make you "
            if (player.strength > player.intelligence) {
              s = s + "a captain in my army; your own regiment of kobolds under your command.'"
              player.offered = "Captain"
            }
            else {
              s = s + "a vizier in my court.'"
              player.offered = "Vizier"
            }
            Print (s)
          ]]></talk>
        </object>
        <object name="sun_queen_sage_defeated">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>The sage is dead</alias>
          <talk type="script">
            Print ("'The sage is dead!'")
            Print ("'Excellent. You have proved yourself loyal and useful. I like that combination. Hence forth, you will be my " + player.offered + ". I suggest you conclude any other business you may have in your home city before taking up the post.'")
          </talk>
        </object>
        <object name="sun_queen_sage_defeated_lie">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>The sage is dead</alias>
          <talk type="script">
            Print ("'The sage is dead!'")
            Print ("'Excellent. You have proved yourself loyal and useful. I like that combination. Hence forth, you will be my " + player.offered + ". I suggest you conclude any other business you may have in your home city before taking up the post.'")
          </talk>
        </object>
        <object name="sun_queen_illusion">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>What is with the illusions?</alias>
          <talk type="script">
            Print ("'All your finery, it's just an illusion!'")
            Print ("'Of course it is. I moved in a few days ago; you think interior design is a priority?'")
            Print ("'I... suppose not.'")
            Print ("'If my throne was real gold, it would be worth more than this land produces in five years. And it would be far to easy for other nations to steel. And it would be very uncomfortable. No, a nice padded chair that merely looks like it is solid gold is far preferable.'")
          </talk>
        </object>
      </object>
      <exit alias="west" to="audience_chamber">
        <inherit name="westdirection" />
      </exit>
      <object name="ac_throne">
        <inherit name="editor_object" />
        <alias>Throne</alias>
        <scenery />
        <alt type="stringlist" />
        <displayverbs type="stringlist">
          <value>Look at</value>
        </displayverbs>
        <look type="script">
          if (throne_room.revealed) {
            Print ("The throne is made of dark wood; the soft padding on the seat, arms and back is covered in dark leather.")
          }
          else {
            Print ("The throne is gold; animals are depicted in the legs and the high back.")
          }
        </look>
      </object>
      <exit alias="north" to="private_chambers">
        <inherit name="northdirection" />
      </exit>
      <object name="general_halidaar">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <alias>General Halidaar</alias>
        <level type="int">5</level>
        <hitpoints type="int">50</hitpoints>
        <defence type="int">2</defence>
        <armour type="int">1</armour>
        <attackbonus type="int">2</attackbonus>
        <damagedicenumber type="int">3</damagedicenumber>
        <damagedicesides type="int">5</damagedicesides>
        <damagebonus type="int">1</damagebonus>
        <attackasgroup />
        <movetype>Free</movetype>
        <desc>The general is a large man in a red uniform liberally decked with medals. Though perhaps in his fifties, he looks tough and strong. He has a scimitar by his side.</desc>
        <image>general</image>
        <picture>general.png</picture>
        <object name="general_kobolds">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>So you lead an army of kobolds</alias>
          <talk type="script">
            Print ("'So you lead an army of kobolds,' you say to the general.")
            Print ("'Indeed I do. Fine body of men. Er, kobolds.'")
            Print ("'I understood kobolds to be cruel and cowardly.'")
            Print ("'Not a bit of it, old {if player.female:thing}{if not player.female:chap}! You just have to know how to treat them, you see? Make fierce and, well, careful soldiers. Keeps the casualities low. Must admit, I found eating their enemies a bit rum...'")
            Print ("'They eat people?'")
            Print ("'Yes. Well, they're not human themselves so it's not really cannabalism for them. Mind you, they wil eat kobold too. Still, each to his own.'")
          </talk>
        </object>
        <object name="general_sun_queen">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <nowshow type="stringlist">
            <value>general_incident</value>
          </nowshow>
          <alias>Why do you follow the Sun Queen?</alias>
          <talk type="script">
            Print ("'Why do you follow the Sun Queen's orders?'")
            Print ("'She pays my wages.'")
            Print ("'You're just another mercenary, like her kobolds?'")
            Print ("'I wouldn't work for a leader I didn't respect. Some years ago there was an... incident. It pretty much ruined my career. The Sun Queen was willing to give me a new chance, to wipe out old mistakes. She's ruthless to be sure, but she's a good ruler nevertheless.'")
          </talk>
        </object>
        <object name="general_incident">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>What sort of incident?</alias>
          <talk type="script">
            Print ("'What sort of incident?'")
            Print ("'The sort that I would never reveal to the likes of you.'")
          </talk>
        </object>
        <object name="general_real_name">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>What is the real name of the Sun Queen</alias>
          <talk type="script">
            Print ("'What's the Sun Queen's real name?'")
            Print ("'I don't know.'")
          </talk>
        </object>
        <object name="weapon_falchion">
          <inherit name="editor_object" />
          <inherit name="weapon" />
          <alias>Falchion</alias>
          <desc>A long, thin-bladed sword, useful against unarmoured foes.</desc>
          <attackbonus type="int">1</attackbonus>
          <damagedicenumber type="int">3</damagedicenumber>
          <price type="int">24</price>
          <damagedicesides type="int">5</damagedicesides>
          <damagebonus type="int">1</damagebonus>
        </object>
      </object>
      <object name="bodyguard">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <alias>Bodyguard</alias>
        <desc>The Queen's bodyguard is a half-orc.</desc>
        <image>halforc_m</image>
        <picture>halforc_m.png</picture>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <look type="script">
          picture ("half_orc.png")
          msg ("The Queen's bodyguard is a half-orc.")
        </look>
        <object name="bodyguard_name">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>What is your name?</alias>
          <nowshow type="stringlist">
            <value>bodyguard_sun_queen</value>
            <value>bodyguard_ruler</value>
            <value>bodyguard_prophecy</value>
          </nowshow>
          <talk type="script">
            Print ("You have never been this close to a half-orc before. 'What's you name?' you ask him.")
            Print ("'Ugh.'")
            bodyguard.alias = "Ugh"
          </talk>
        </object>
        <object name="bodyguard_sun_queen">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>What is your view of the Sun Queen?</alias>
          <talk type="script">
            Print ("'What d'you think of the Sun Queen?' you ask Ugh.")
            Print ("'Ugh.'")
          </talk>
        </object>
        <object name="bodyguard_ruler">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Who should be ruler?</alias>
          <talk type="script">
            Print ("'Who do you think should be ruler?' you ask Ugh.")
            Print ("'Ugh.'")
          </talk>
        </object>
        <object name="bodyguard_prophecy">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>The prophecy says I will win</alias>
          <talk type="script">
            Print ("'The prophecy says I will defeat the Sun Queen,' you point out to Ugh.")
            Print ("'Ugh.'")
          </talk>
        </object>
      </object>
      <object name="minstrel">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <alias>Minstrel</alias>
        <image>minstrel</image>
        <desc>The minstrel is a youngish woman in a red skirt and halter, wearing a bandana. She is holding a lute.</desc>
        <picture>minstrel.png</picture>
        <object name="lute">
          <inherit name="editor_object" />
          <inherit name="merchandise" />
          <alias>Lute</alias>
          <look>When you planned to get a shed load of loot, this was not what you had in mind.</look>
          <price type="int">72</price>
        </object>
      </object>
    </object>
    <object name="audience_chamber">
      <inherit name="editor_room" />
      <alias>Audience chamber</alias>
      <revealed type="boolean">false</revealed>
      <enviro type="object">e_inner_citadel</enviro>
      <description type="script">
        if (this.revealed) {
          Print ("This is a large room, with a high ceiling. Two columns of bare pillars run down each side, and from the walls hang ancient tapestries. The door to the east leads to the throne room, and back to the west is the gallery.")
        }
        else {
          Print ("This is a large room, with a high ceiling, ornately painted. Two columns of pillars, intricately carved, and inlaid with gilt, run down each side, and from the walls hang magnificent tapestries. The door to the east leads to the throne room, and back to the west is the gallery.")
        }
      </description>
      <truesight type="script">
        player.truesight_worked = true
        Print ("The whole room goes kind of hazy, then clears. All the rich furnishings have disappeared, the walls look shabby, the tapestries are threadbare.")
        this.revealed = true
        do (sun_queen_illusion, "show")
        do (illusionist_illusion, "show")
      </truesight>
      <exit alias="east" to="throne_room">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="west" to="gallery_east">
        <inherit name="westdirection" />
      </exit>
      <object name="ac_pillars">
        <inherit name="editor_object" />
        <alias>Pillars</alias>
        <scenery />
        <alt type="stringlist">
          <value>pillar</value>
        </alt>
        <displayverbs type="stringlist">
          <value>Look at</value>
        </displayverbs>
        <look type="script">
          if (audience_chamber.revealed) {
            Print ("The pillars are made of cylindrical blocks of grey stone.")
          }
          else {
            Print ("The pillars are made of cylindrical blocks of obsidian, the surfaces intricately carved in geometric patterns, set off with gold leaf.")
          }
        </look>
      </object>
      <object name="ac_tapestries">
        <inherit name="editor_object" />
        <alias>Tapestries</alias>
        <scenery />
        <alt type="stringlist">
          <value>tapestry</value>
        </alt>
        <displayverbs type="stringlist">
          <value>Look at</value>
        </displayverbs>
        <look type="script">
          if (audience_chamber.revealed) {
            Print ("The tapestries are so faded it is hard to make out what they depict.")
          }
          else {
            Print ("There are ten tapestries around the room, five on each of the long walls. Each is finely wrought in colourful thread, and all depict great battles involving wizards, armies and terrible beasts.")
          }
        </look>
      </object>
      <object name="ac_ceiling">
        <inherit name="editor_object" />
        <alias>ceiling</alias>
        <scenery />
        <alt type="stringlist" />
        <displayverbs type="stringlist">
          <value>Look at</value>
        </displayverbs>
        <lookedat type="boolean">false</lookedat>
        <look type="script">
          if (audience_chamber.revealed) {
            Print ("The ceiling features a number of large wooden beams.")
          }
          else if (player.status = "Lore") {
            if (illusionist.lookedat) {
              Print ("The ceiling is fancifully painted with various gods from the Dubelan pantheon, floating on clouds. Kalini, the goddess of love, looks strangely like the wizard.")
            }
            else {
              Print ("The ceiling is fancifully painted with various gods from the Dubelan pantheon, floating on clouds.")
            }
            this.lookedat = true
          }
          else {
            if (illusionist.lookedat) {
              Print ("The ceiling is fancifully painted with various gods, floating on clouds. One of the goddesses looks strangely like the wizard.")
            }
            else {
              Print ("The ceiling is fancifully painted with various gods, floating on clouds.")
            }
            this.lookedat = true
          }
        </look>
      </object>
      <object name="illusionist">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <revealed type="boolean">false</revealed>
        <lookedat type="boolean">false</lookedat>
        <attackasgroup />
        <level type="int">4</level>
        <hitpoints type="int">16</hitpoints>
        <defence type="int">1</defence>
        <nonweapon />
        <damagedicesides type="int">8</damagedicesides>
        <attackdesc><![CDATA[% casts <i>RainbowEruption</i> at you]]></attackdesc>
        <alias>Wiaz</alias>
        <attackbonus type="int">2</attackbonus>
        <revealeddesc>The wizard is dressed in red robes. She has long, brown hair, streaked with grey, and a pretty face.{if ac_ceiling.lookedat: She looks strangely like the goddess in the ceiling mural.}</revealeddesc>
        <desc>The wizard is dressed in red robes, lined in silver. She has long, brown hair, and a radiant face.{if ac_ceiling.lookedat: She looks strangely like the goddess in the ceiling mural.}</desc>
        <image>fire_mage.png</image>
        <picture>fire_mage.png</picture>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <truesight type="script">
          player.truesight_worked = true
          this.revealed = true
        </truesight>
        <attackplayer type="script">
          Print ("The wizard casts an arcane spell, and conjures up a " + illusion.alias + " from the netherworld.")
          illusion.parent = this.parent
          illusion.visible = true
          this.attackplayer = null
        </attackplayer>
        <descscript type="script">
          this.lookedat = true
        </descscript>
        <object name="illusionist_illusion">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>What is with the illusions?</alias>
          <talk type="script">
            Print ("'All the finery in here; it's just an illusion.'")
            Print ("'A rather fine one, I would venture to say.'")
            if (illusionist.lookat and ceiling.lookedat) {
              Print ("'You handiwork?' She smiled and nods. That accounts for why the goddess looks so much like her!")
            }
            else {
              Print ("'You handiwork?' She smiled and nods.")
            }
          </talk>
        </object>
        <object name="illusion">
          <inherit name="editor_object" />
          <inherit name="monster" />
          <attackdesc>% bites at you</attackdesc>
          <level type="int">0</level>
          <hitpoints type="int">30</hitpoints>
          <defence type="int">2</defence>
          <attackbonus type="int">4</attackbonus>
          <damagedicenumber type="int">3</damagedicenumber>
          <damagedicesides type="int">8</damagedicesides>
          <nonweapon />
          <attackonsight />
          <attackasgroup />
          <movetype>Free</movetype>
          <visible type="boolean">false</visible>
          <alias>Skittering Horror</alias>
          <image>skittering_horror</image>
          <usedefaultprefix type="boolean">false</usedefaultprefix>
          <desc>The skitterng horror resembled a hge spider, but inside of legs, it walked on blades of chitin.</desc>
          <picture>skittering_horror.png</picture>
          <truesight type="script">
            player.truesight_worked = true
            Print ("The " + this.alias + " dissolves away.")
            this.parent = nowhere
          </truesight>
          <look type="script">
            picture ("fire_elemental.png")
            msg ("A nasty monster.")
          </look>
        </object>
      </object>
    </object>
    <object name="gallery_west">
      <inherit name="editor_room" />
      <alias>gallery, west</alias>
      <enviro type="object">e_inner_citadel</enviro>
      <exit alias="east" to="gallery_east">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="north" to="stairs_junction">
        <inherit name="northdirection" />
      </exit>
    </object>
    <object name="gallery_east">
      <inherit name="editor_room" />
      <alias>Gallery, east</alias>
      <enviro type="object">e_inner_citadel</enviro>
      <exit alias="east" to="audience_chamber">
        <inherit name="eastdirection" />
        <locked />
        <scenery type="boolean">false</scenery>
      </exit>
      <exit alias="west" to="gallery_west">
        <inherit name="westdirection" />
      </exit>
    </object>
    <object name="kitchens">
      <inherit name="editor_room" />
      <alias>Citadel Kitchens</alias>
      <enviro type="object">e_citadel</enviro>
      <exit alias="west" to="lower_gallery">
        <inherit name="westdirection" />
      </exit>
      <object name="cook">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <alias>Cook</alias>
        <picture>cook.png</picture>
        <desc>Let us be generous and say that his girth is a tribute to his culinary skills.</desc>
      </object>
    </object>
    <object name="stairs_junction">
      <inherit name="editor_room" />
      <description>This is a small chamber that connects the gallery to the south to a spiral staircase, running both up and down.</description>
      <alias>Stairs junction</alias>
      <enviro type="object">e_citadel</enviro>
      <exit alias="south" to="gallery_west">
        <inherit name="southdirection" />
      </exit>
      <exit alias="down" to="lower_gallery">
        <inherit name="downdirection" />
      </exit>
      <exit alias="up" to="observatory">
        <inherit name="updirection" />
      </exit>
    </object>
    <object name="observatory">
      <inherit name="editor_room" />
      <alias>Observatory</alias>
      <enviro type="object">e_citadel</enviro>
      <object name="astrologer">
        <inherit name="editor_object" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <alias>Astrologer</alias>
        <image>scholar</image>
        <desc>The astrologer is perhaps fifty years old, with long, straggly hair that is streaked with grey, and a beard to match. He is wearing rather old-looking robes. You cannot help noticing that is right eye is larger than his left; quite a bit larger.</desc>
        <picture>scholar.png</picture>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <descscript type="script">
          do (astro_odd_eyes, "show")
        </descscript>
        <object name="astro_sun_queen">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Do you support the Sun Queen?</alias>
          <nowshow type="stringlist">
            <value>astro_citadel</value>
          </nowshow>
          <talk type="script">
            Print ("'Do you support the Sun Queen?' you ask the astrologer.")
            Print ("'The who?'")
            Print ("'The Sun Queen. She captured the Citadel - the one we are currently standing in.'")
            Print ("'I don't really follow the petty politics of the land, young man.'")
            if (player.female) {
              Print ("'I happen to be a woman, thank you very much!'")
              Print ("He looks at you chest very carefully. 'Why so you are! I don't follow... that sort of thing much either.'")
            }
          </talk>
        </object>
        <object name="astro_astrology">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Can you predict the future from the stars?</alias>
          <talk type="script">
            Print ("'So can you predict the future from the stars?'")
            Print ("'What are you talking about?'")
            Print ("'You know, if you were born when such-and-such a stars was rising, you'll grow up to be a great miller. that sort of thing.'")
            Print ("'Why should the declination of a star when one is born have any bearing at all on ones professional aptitude?'")
          </talk>
        </object>
        <object name="astro_odd_eyes">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>You eyes are different sizes</alias>
          <talk type="script">
            Print ("'I, er, can't help noticing your eyes; one seems bigger than the other.'")
            Print ("'What? Oh, yes, that. I found it beneficial to get one enhanced so I could see the heavens more clearly.'")
            Print ("'Just one of them?'")
            Print ("'These things do cost money, and I only use my right eye to look though the telescope.'")
          </talk>
        </object>
        <object name="astro_citadel">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>How long have you been here?</alias>
          <nowshow type="stringlist">
            <value>astro_food</value>
          </nowshow>
          <talk type="script">
            Print ("How long have you been in the Citadel?'")
            Print ("'What citadel?'")
            Print ("'This one, the one we're in!'")
            Print ("The astrologer peers of of the window. 'Oh, my, I had quite forgotten. Of course the Citadel, yes...'")
            Print ("'So how long have you been here,' you repeat, not optimistic of a meaningful reply.")
            Print ("'Well, many years. I've tracked Dados on its orbit about the sun, and that is approximately twenty six point three nine years. And its original ascension was forty three point degress and fourteen minutes, and it is now one hundred and fifty seven degrees and fortyfour minutes, so...' He thinks for a moment. 'Thirty fours years and nine months!'")
          </talk>
        </object>
        <object name="astro_food">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>What do you eat?</alias>
          <talk type="script">
            Print ("'What do you do for food?'")
            Print ("'The staff bring me meals. It's not something I really concern myself with.'")
          </talk>
        </object>
      </object>
      <exit alias="down" to="stairs_junction">
        <inherit name="downdirection" />
      </exit>
    </object>
    <object name="lower_gallery">
      <inherit name="editor_room" />
      <alias>Lower gallery</alias>
      <enviro type="object">e_citadel</enviro>
      <exit alias="up" to="stairs_junction">
        <inherit name="updirection" />
      </exit>
      <exit alias="east" to="kitchens">
        <inherit name="eastdirection" />
      </exit>
      <exit alias="down" to="citadel_cellars">
        <inherit name="downdirection" />
      </exit>
    </object>
    <object name="dungeon">
      <inherit name="editor_room" />
      <alias>Citadel dungeon</alias>
      <listen>It is pretty qwuiet down here.</listen>
      <smell>There is a bad smell of faeces and urine.</smell>
      <enviro type="object">e_citadel</enviro>
      <description type="script">
        Print ("The dungeons are dark, damp and malodorous; the very deepest part of the Citadel. The floor is covered in straw. The stone walls have numerousiron stubs set into them, from which chains hang.")
        if (prince_mandrin.parent = this) {
          if (prince_mandrin.freed) {
            Print ("Prince Mandrin is here, keen to be away.")
          }
          else {
            Print ("A single prisoner is held in the chains. This must be the Prince, you realise.")
          }
        }
      </description>
      <firstenter type="script">
        Print ("'Please don't hurt me,' begs Prince Mandrin. 'Wait you're not... Please, say you've come to rescue me!'")
      </firstenter>
      <object name="prince_mandrin">
        <inherit name="editor_object" />
        <inherit name="namedmale" />
        <inherit name="monster" />
        <inherit name="talkingchar" />
        <alias>Prince Mandrin</alias>
        <freed type="boolean">false</freed>
        <desc>Prince Mandrin looks to be around eighteen. He is a large man, to put it mildly; a little taller than yourself, but broad too, not to say fat. he has dark hair, and has not been shaved in at least a week. He is dressed in fine clothes; matching blue waistcoat and trousers with gold twist. However, they look rather dirty and crumpled. There is a haunted look to his eyes.</desc>
        <image>court3</image>
        <picture>court3.png</picture>
        <displayverbs type="stringlist">
          <value>Look at</value>
          <value>Speak to</value>
        </displayverbs>
        <look type="script">
          Print ("Prince Mandrin looks to be around eighteen. He is a large man, to put it mildly; a little taller than yourself, but broad too, not to say fat. he has dark hair, and has not been shaved in at least a week. He is dressed in fine clothes; matching blue waistcoat and trousers with gold twist. However, they look rather dirty and crumpled. There is a haunted look to his eyes.")
        </look>
        <object name="prince_sun_queen">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Who is the Sun Queen anyway?</alias>
          <talk type="script">
            Print ("'Who is the Sun Queen?' you ask the prince.")
            Print ("'An evil usurper who seeks to displace my from my rightful throne!'")
            Print ("'I knew that bit. Where is she from?'")
            Print ("'How should I know?'")
          </talk>
        </object>
        <object name="prince_army">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>What happened to your army?</alias>
          <talk type="script"><![CDATA[
            Print ("'I hear you lost your army.'")
            s = "'The Evil Sun Queen summoned up a tempest, sending a <i>torrent</i> of water against them as they traversed the river. I myself was fortunate to survive,"
            if (prince_mandrin.parent = dungeon) {
              Print (s + " but was to taken to that wretched prison.'")
            }
            else {
              Print (s + " but now find myself in this wretched prison.'")
            }
          ]]></talk>
        </object>
        <object name="prince_social_policies">
          <inherit name="editor_object" />
          <inherit name="startingtopic" />
          <alias>Tell me about your social policies</alias>
          <talk type="script">
            Print ("'What are your social policies?' you ask Prince Mandrin.")
            Print ("'My what?'")
            Print ("'Your social policies. Where do you stand on issues like poverty and education?'")
            Print ("'I can assure you I am well educated!. And once we are returned to the palace, I can assure you you will be rewarded, if that is what you are alluding to.'")
            Print ("'Not really, no.'")
          </talk>
        </object>
        <object name="prince_grandfather_mandrin">
          <inherit name="editor_object" />
          <inherit name="topic" />
          <alias>Tell me about your grandfather Mandrin</alias>
          <talk type="script"><![CDATA[
            Print ("Tell me. how did grandfather Mandrin get the throne?'")
            Print ("'<i>Great</i> grandfather Mandrin, after whom I am named, was a magnificient swordsman and military genius. With the blessing of the gods, he wrestled the throne from the corrupt King Julos, establishing Per-Haligolia as a nation of which its citizens could be proud.")
          ]]></talk>
        </object>
      </object>
    </object>
    <object name="private_chambers">
      <inherit name="editor_room" />
      <alias>Queen's Private Chambers</alias>
      <enviro type="object">e_citadel</enviro>
      <exit alias="south" to="throne_room">
        <inherit name="southdirection" />
      </exit>
    </object>
  </object>
  <command name="cheat">
    <pattern>cheat</pattern>
    <script>
      gem.parent = player
      spell_truesight.parent = player
    </script>
  </command>
  <object name="nowhere">
    <inherit name="editor_room" />
    <alias>Nowhere</alias>
    <description>Null</description>
    <object name="wyvern">
      <inherit name="editor_object" />
      <alias>Wyvern</alias>
      <look>The wyvern circles overhead, keeping a careful watch. Its size is hard to judge, but must be comparable to a horse; its scales are black, except the belly, where they are bright white.</look>
      <attack>The wyvern is too high up to attack.</attack>
    </object>
    <object name="map">
      <inherit name="editor_object" />
    </object>
    <object name="plan">
      <inherit name="editor_object" />
    </object>
    <object name="hero_male">
      <inherit name="editor_object" />
      <inherit name="namedmale" />
      <inherit name="monster" />
      <inherit name="talkingchar" />
      <alias>Talgaar</alias>
      <attack>You are pretty sure you will lose agains this guy.</attack>
      <picture>hero.png</picture>
      <look type="script">
      </look>
      <descscript type="script">
        Print ("An impressive figure of a man, Talgaar is somewhat taller than yourself and noticably better built. His " + player.haircolour + " hair is held in a ponytail, and his " + player.eyecolour + " eyes hold you in their gaze.")
        Print ("He is dressed in plate armour, set off with bronze flourishes, and has a great sword slung acoss his back.")
      </descscript>
      <object name="hm_what_doing">
        <inherit name="editor_object" />
        <inherit name="topic" />
        <alias>What are you doing here?</alias>
        <talk type="script">
          Print ("'What are you doing here?' you ask the great warrior.")
          if (prince_madrin.parent = player.parent) {
            Print ("'I am on a quest to defeat the fiery Queen of the Sun.'")
            Print ("'I'm jolly glad to hear it!' say the Prince. 'The rotter has usurped me from my own throne. I can assureyou you will be well rewarded if... when you are successful. Well, off you go then!'")
          }
          else if (player.ending = "prince") {
            Print ("'I am on a quest to defeat the fiery Queen of the Sun.'")
            Print ("'Ah, okay.' Probably better to let him discover for himself that she is already dead, and you beat him to it.")
          }
          else {
            Print ("'I am on a quest to defeat the fiery Prince Mandrin.")
            Print ("'Prince Mandrin? If what way is he fiery? Compared to the Sun Queen, say?'")
            Print ("'He is infamous for his fiery temper and his delight in burning his enemies alive.'")
            Print ("'Ah, I see. Well, as the Sun Queen's new " + player.offered + " I can tell you the Prince is safely in her dungeons.'")
          }
        </talk>
      </object>
    </object>
    <object name="hero_female">
      <inherit name="editor_object" />
      <inherit name="namedfemale" />
      <inherit name="monster" />
      <inherit name="talkingchar" />
      <alias>Talgalia</alias>
      <attack>You are pretty sure you will lose agains this guy.</attack>
      <picture>female_hero.png</picture>
      <descscript type="script">
        Print ("Tall and slender, Talgalia is floating cross-legged some way above the ground, at about your waist height. Her " + player.haircolour + " hair is held in a ponytail, and her " + player.eyecolour + " eyes hold you in amused contempt.")
        Print ("She is dressed in robes of white and gold, her feet bare, entirely surrounded by a magical aura.")
      </descscript>
    </object>
    <object name="spell_clean">
      <inherit name="editor_object" />
      <inherit name="nonattackspell" />
      <alias>Clean</alias>
      <level type="int">3</level>
      <desc>The spell will instantly clean you.</desc>
      <spelleffect type="script">
        if (player.parent.enviro = e_sewer) {
          Print ("Instantly you are clean, and then a moment later you stink of raw sewage again. The spell is not powerful enough to overcome the much in the sewer for any longer than that.")
        }
        else if (player.sewer) {
          Print ("Instantly the lingering stench of the sewer is gone.")
          player.sewer = false
        }
        else {
          Print ("Instantly you are clean.")
        }
      </spelleffect>
    </object>
    <object name="spell_blue">
      <inherit name="editor_object" />
      <inherit name="lastingspell" />
      <alias>Azure</alias>
      <status>Blue skin</status>
      <description>Your skin turns a pale blue colour.</description>
      <desc>The first spell you learnt, this causes your skin to turn a pale blue colour.</desc>
      <terminate type="script">
        P ("Your skin returns to its normal colour.")
      </terminate>
    </object>
    <object name="spell_cancel">
      <inherit name="editor_object" />
      <inherit name="nonattackspell" />
      <alias>Cancel</alias>
      <description type="string"></description>
      <desc>This spell will cancel any on-going spell you have active.</desc>
    </object>
    <object name="spell_green">
      <inherit name="editor_object" />
      <inherit name="lastingspell" />
      <alias>Verdigris</alias>
      <status>Green skin</status>
      <description>Your skin turns a pale green colour.</description>
      <desc>The first spell you learnt, this causes your skin to turn a pale green colour.</desc>
      <terminate type="script">
        P ("Your skin returns to its normal colour.")
      </terminate>
    </object>
    <object name="spell_orange">
      <inherit name="editor_object" />
      <inherit name="lastingspell" />
      <alias>Tangerine</alias>
      <status>Orange skin</status>
      <description>Your skin turns a bright orange colour.</description>
      <desc>The first spell you learnt, this causes your skin to turn a bright orange colour.</desc>
      <terminate type="script">
        P ("Your skin returns to its normal colour.")
      </terminate>
    </object>
    <object name="magpie">
      <inherit name="editor_object" />
      <inherit name="monster" />
      <inherit name="talkingchar" />
      <alias>Magpie</alias>
      <following type="boolean">false</following>
      <animal />
      <scenery type="boolean">false</scenery>
      <displayverbs type="stringlist">
        <value>Look at</value>
        <value>Speak to</value>
      </displayverbs>
      <notindescription />
      <image>magpie</image>
      <desc>The black and white bird is staring at you.</desc>
      <picture>magpie.png</picture>
      <attack type="script">
        Print ("You are about to strike the stupid magpie, but it cocks it head and looks at you in a strange way. Perhaps not, you decide.")
      </attack>
      <object name="magpie_why_follow">
        <inherit name="editor_object" />
        <inherit name="startingtopic" />
        <alias>Why are you following me?</alias>
        <nowshow type="stringlist">
          <value>magpie_dark</value>
        </nowshow>
        <talk type="script">
          Print ("You look at the magpie carefully. 'Why are you following me?'")
          Print ("'Nothing better to do.'")
          Print ("'Serious? Nothing better to do than risk your neck following me?'")
          Print ("The magpie looks skywards for a moment. 'Okay, it's like this. All my life I've being doing magpie things. Eating carrion, chasing pretty magpie girls...'")
          Print ("'Stealing shiny stuff?'")
          s = "'What? No! That's humans, not magpies, mate. So there I am, minding my own business, when suddenly it goes dark. Like blanket over the head dark, not nighttime dark. When I come round, I'm stood by some "
          if (player.female) {
            s = s + "bint lying in the road, and a strange desire to follow her whereever she goes."
          }
          else {
            s = s + "geezer lying in the road, and a strange desire to follow him whereever he goes."
          }
          s = s + " So here I am, following you whereever you go. It's been an eye-opener, I can tell you. Talking as well. Never knew humans could do that.'"
          Print (s)
        </talk>
      </object>
      <object name="magpie_sage">
        <inherit name="editor_object" />
        <inherit name="topic" />
        <alias>What is the sage like?</alias>
        <talk type="script"><![CDATA[
          Print ("'What's the sage like?' you ask the magpie.")
          Print ("'Stupid old fool, if you ask me, shutting himself up in a tower in the ass-end of nowhere.'")
          Print ("'Don't people come to visit him? Ask him for his wisdom?'")
          Print ("'Yeah, I have seen humans goinmg in there a fair bit. They must be even more stupid than him. In fairness he was bright enough to stay in his tower and send <i>us</i> out to defeat the Sun Queen.'")
        ]]></talk>
      </object>
      <object name="magpie_dark">
        <inherit name="editor_object" />
        <inherit name="topic" />
        <alias>Tell me about it going dark</alias>
        <talk type="script">
          Print ("'Tell me about it going dark.'")
          Print ("'It went dark.'")
          Print ("'For how long? Could you feel yourself being moved? could you hear anything?'")
          Print ("'Nothing. I saw nothing, I felt nothing, I heard nothing, okay?'")
        </talk>
      </object>
      <object name="magpie_teleport">
        <inherit name="editor_object" />
        <inherit name="topic" />
        <alias>How come you teleport when I do?</alias>
        <talk type="script">
          Print ("'How come you teleport when I do?'")
          Print ("'What am I; the fontof all knowledge? How shoud I know? All I know is you do that funny business, and suddenly we're somewhere else. Unnatural if you ask me.'")
          Print ("'And a talking magpie isn't?'")
          Print ("'What's unnatural is you understanding me when I talk.'")
        </talk>
      </object>
      <object name="magpie_returning">
        <inherit name="editor_object" />
        <inherit name="topic" />
        <alias>Could you pick up the Stone of Returning?</alias>
        <talk type="script">
          Print ("'Could you pick up the Stone of Returning?'")
          Print ("'What? So I carry that whereever you want to go? Sorry, friend, too heavy for me to fly with. You'll have to walk.'")
        </talk>
      </object>
    </object>
  </object>
  <command name="testgame">
    <pattern>testgame</pattern>
    <script>
      lst = AllObjects()
      msg ("Found: " + ListCount(lst))
      rooms = 0
      monsters = 0
      spells = 0
      npcs = 0
      items = 0
      zones = 0
      foreach (o, lst) {
        if (not HasString(o, "alias") and not StartsWith(o.name, "e_") and not o.scenery and not GetBoolean(o, "zone") and not EndsWith(o.name, "_struct")) {
          msg (o.name + " has no alias")
        }
        if (DoesInherit(o, "editor_object") and not HasAttribute(o, "look") and not StartsWith(o.name, "e_") and not DoesInherit(o, "topic")) {
          msg (o.name + " object has no description")
        }
        if ((DoesInherit(o, "male") or DoesInherit(o, "female")) and not DoesInherit(o, "monster")) {
          msg (o.name + " character is not a monster")
        }
        if (DoesInherit(o, "monster")  and not HasString(o, "picture")) {
          msg (o.name + " monster has no image")
        }
        if (DoesInherit(o, "monster") and not HasString(o, "desc") and not HasAttribute(o, "descscript")) {
          msg (o.name + " monster has no description")
        }
        if (DoesInherit(o, "editor_room") and not GetBoolean(o, "zone")) {
          if (not HasAttribute(o, "description")) {
            msg (o.name + " room has no description")
          }
          else if (o.description = "") {
            msg (o.name + " room has blank description")
          }
        }
        if (ListCount(ScopeExitsForRoom(o)) = 0) {
          if (GetBoolean(o, "zone")) {
            zones = zones + 1
          }
          else if (DoesInherit(o, "talkingchar")) {
            npcs = npcs + 1
          }
          else if (DoesInherit(o, "monster")) {
            monsters = monsters + 1
          }
          else if (DoesInherit(o, "spell")) {
            spells = spells + 1
          }
          else {
            items = items + 1
          }
        }
        else {
          rooms = rooms + 1
          if (not HasAttribute(o, "enviro")) {
            msg (o.name + " has no environment set")
          }
        }
      }
      msg ("Zones: " + zones)
      msg ("Rooms: " + rooms)
      msg ("Items: " + items)
      msg ("NPCs: " + npcs)
      msg ("Spells: " + spells)
      msg ("Monsters: " + monsters)
    </script>
  </command>
  <command name="wash">
    <pattern>wash</pattern>
    <script>
      if (not player.sewer) {
        msg ("You don't need to wash anything right now.")
      }
      else if (StreamHere()) {
        player.sewer = false
        Print ("You give yourself - and your clothes - a good wash in the stream. Finally the stench of sewers is gone.")
      }
      else if (player.parent = market_square) {
        player.sewer = false
        horse_trough.sewer = true
        Print ("You give yourself - and your clothes - a good wash in the horse trough. Too bad for any horses who want to drink from it, but at last the stench of sewers is gone.")
      }
      else if (player.parent.enviro = e_forest_river) {
        player.sewer = false
        Print ("You give yourself - and your clothes - a good wash in the river. It is not exactly clean water, but at last the stench of sewers is gone.")
      }
      else {
        Print ("You would like to give yourself - and your clothes - a good wash, but there is no where here to do it.")
      }
    </script>
  </command>
  <verb>
    <property>lift</property>
    <pattern>lift;shift</pattern>
    <defaultexpression>"You can't lift;shift " + object.article + "."</defaultexpression>
  </verb>
  <function name="EnviroFlavour"><![CDATA[
    if (not player.worldcursed or not GetBoolean(player.parent.enviro, "onlywhennotcursed")) {
      if (HasAttribute(player.parent.enviro, "flavour")) {
        n = GetRandomInt(0, 20)
        if (n < ListCount(player.parent.enviro.flavour)) {
          Print (StringListItem(player.parent.enviro.flavour, n))
          if (HasAttribute(player.parent.enviro, "flavournames") and HasAttribute(player.parent.enviro, "flavourdescs")) {
            if (n < ListCount(player.parent.enviro.flavournames) and n < ListCount(player.parent.enviro.flavournames)) {
              if (not StringListItem(player.parent.enviro.flavournames, n) = "" and not StringListItem(player.parent.enviro.flavournames, n) = "") {
                enviro_object.parent = player.parent
                enviro_object.alt = Split(StringListItem(player.parent.enviro.flavournames, n), "|")
                enviro_object.look = StringListItem(player.parent.enviro.flavourdescs, n)
              }
            }
          }
        }
      }
    }
  ]]></function>
  <function name="Generate" parameters="monster, location, itemlist, name">
    obj = Clone (monster)
    obj.parent = location
    if (not itemlist = null) {
      if (TypeOf (itemlist) = "object") {
        o2 = Clone (itemlist)
        o2.parent = obj
      }
      else {
        foreach (o, itemlist) {
        }
        o2 = Clone (o)
        o2.parent = obj
      }
    }
    if (not name = null) {
      obj.alias = name
    }
  </function>
  <function name="GetPrice" parameters="price" type="string">
    return ("" + price + " gp")
  </function>
  <function name="MonsterPresent" parameters="alias" type="boolean">
    foreach (o, GetDirectChildren(player.parent)) {
      if (o.alias = alias) {
        return (true)
      }
    }
    return (false)
  </function>
  <function name="CurseTheWorld">
    player.worldcursed = true
    Generate (bugbear, forest_cairn, null, null)
    Generate (spectre.parent, forest_grave, null, null)
    Generate (shambling_mound.parent, forest_high_bridge_north, null, null)
    Generate (spider.parent, road_edge_forest, null, "Skulking spider")
    Generate (spider.parent, road_edge_forest, null, "Nasty spider")
    Generate (spider.parent, road_edge_forest, null, "Hideous spider")
    if (not druid.dead) {
      druid.parent = nighttime
    }
    if (not fox.dead) {
      fox.parent = nighttime
    }
    if (not centaur.dead) {
      centaur.parent = nighttime
      centaur_corpse.parent = forest_cairn
    }
    do (goat_red_sky, "show")
    do (sage_red_sky, "show")
  </function>
  <function name="StreamHere" type="boolean">
    stream = false
    foreach (o, GetDirectChildren(player.parent)) {
      if (StartsWith(o.name, "stream")) {
        stream = true
      }
    }
    return (stream)
  </function>
  <function name="MagpieFollows">
    magpie.parent = player.parent
    if (HasString(player.parent, "magpie")) {
      Print (player.parent.magpie)
    }
    else if (HasScript(player.parent, "magpie")) {
      do (player.parent, "magpie")
    }
    else if (HasScript(player.parent.enviro, "magpie")) {
      do (player.parent.enviro, "magpie")
    }
    else if (HasString(player.parent.enviro, "magpie")) {
      Print (player.parent.enviro.magpie)
    }
    else {
      Print ("The magpie follows along.")
    }
  </function>
  <function name="OnEnterRoom" parameters="oldRoom"><![CDATA[
    game.displayroomdescriptiononstart = false
    enviro_object.parent = environment
    if (IsDefined("oldRoom")) {
      if (oldRoom <> null) {
        if (HasScript(oldRoom, "onexit")) {
          do (oldRoom, "onexit")
        }
      }
    }
    on ready {
      if ((not GetBoolean(game.pov.parent, "visited")) and HasScript(game.pov.parent, "beforefirstenter")) {
        do (game.pov.parent, "beforefirstenter")
      }
      on ready {
        if (HasScript(game.pov.parent, "beforeenter")) {
          do (game.pov.parent, "beforeenter")
        }
        on ready {
          if (game.gridmap) {
            Grid_CalculateMapCoordinates (game.pov.parent, game.pov)
            Grid_DrawPlayerInRoom (game.pov.parent)
          }
          if (IsDefined("oldRoom")) {
            if (oldRoom <> null and game.changeroom_newline and not game.command_newline) {
              msg ("")
            }
          }
          st = DisplayName(game.pov.parent)
          request (UpdateLocation, "- " + st + " -")
          Title (st, 14)
          roomFrameExists = false
          if (HasString(game.pov.parent, "picture")) {
            if (LengthOf(game.pov.parent.picture) > 0) {
              roomFrameExists = true
              SetFramePicture (game.pov.parent.picture)
            }
          }
          if (game.clearframe and not roomFrameExists) {
            ClearFramePicture
          }
          if (game.showdescriptiononenter) {
            ShowRoomDescription
          }
          if (magpie.following) {
            MagpieFollows
          }
          if (HasScript( game, "roomenter")) {
            do (game, "roomenter")
          }
          on ready {
            if ((not GetBoolean(game.pov.parent, "visited")) and HasScript(game.pov.parent, "firstenter")) {
              do (game.pov.parent, "firstenter")
            }
            on ready {
              if (HasScript(game.pov.parent, "enter")) {
                do (game.pov.parent, "enter")
              }
            }
            set (game.pov.parent, "visited", true)
          }
        }
      }
    }
  ]]></function>
  <function name="HandleDialogue" parameters="answer">
    // msg (answer)
    l = Split(answer, "|")
    game.pov.strength = 0
    game.pov.agility = 0
    game.pov.intelligence = 5
    game.pov.stamina = 0
    game.pov.money = 5
    game.pov.alias = StringListItem(l, 0)
    game.pov.nature = StringListItem(l, 3)
    game.pov.female = StringListItem(l, 4) = "girl"
    switch (LCase(StringListItem(l, 5))) {
      case ("getting into trouble") {
        game.pov.stamina = 2
        game.pov.strength = 2
        game.pov.agility = 1
        game.pov.intelligence = 4
      }
      case ("with your nose in a book") {
        game.pov.intelligence = 9
      }
      case ("stealing things") {
        game.pov.agility = 3
        game.pov.stamina = 1
      }
      case ("getting into fights") {
        game.pov.strength = 3
        game.pov.stamina = 2
        game.pov.intelligence = 4
      }
      case ("arguing with the local priest") {
        game.pov.intelligence = 7
        game.pov.stamina = 2
      }
    }
    switch (LCase(StringListItem(l, 1))) {
      case ("a tiny village") {
        game.pov.strength = game.pov.strength + 1
      }
      case ("a provential town") {
        game.pov.agility = game.pov.agility + 1
      }
      case ("the slums") {
        game.pov.stamina = game.pov.stamina + 1
      }
      case ("the merchant's quarter") {
        game.pov.intelligence = game.pov.intelligence + 1
      }
    }
    game.pov.specialisation = LCase(StringListItem(l, 6))
    game.pov.haircolour = LCase(StringListItem(l, 7))
    game.pov.eyecolour = LCase(StringListItem(l, 8))
    player.startspell = GetObject("spell_" + LCase(StringListItem(l, 9)))
    game.pov.shalazin_female = (StringListItem(l, 10) = "false")
    game.startup = false
    game.pov.hitpoints = CalcFullHits()
    // request (Hide, "Command")
    JS.eval ("$('#txtCommand').css('display', 'none');")
    JS.eval ("$('#txtCommandDiv').css('display', 'block');")
    UpdateArmour
    UpdateStatus
    player.parent = road_approaching_town
  </function>
  <function name="EndTheGame" parameters="status"><![CDATA[
    s = "$('#gamePanesFinished').html('<div style=\"width:300px;border:thin solid black;padding:8px;background-color:tan;color:maroon;margin-left:50px;\"><h2>Game Over</h2><p>This game has finished"
    if (status = 0) {
      s = s + " and you are dead!"
    }
    else if (status = 1) {
      s = s + " and you just gave up!"
    }
    else {
      s = s + " and you have completed it!"
    }
    s = s + "</p><img src=\""
    if (status = 0) {
      s = s + GetFileURL("gravestone.png")
    }
    else if (status = 1) {
      s = s + GetFileURL("walkaway.png")
    }
    else {
      s = s + GetFileURL("celebrate.png")
    }
    s = s + "\" /></div>');"
    JS.eval (s)
    finish
  ]]></function>
  <walkthrough name="test">
    <steps type="simplestringlist">
      z
      north
      northeast
      north
      north
      northeast
      east
      northeast
      speak to Druid
      event:ShowMenuResponse;Can you teach me some spells?
      speak to Druid
      event:ShowMenuResponse;Help me defeat the Sun Queen
      learn truesight
      north
      northeast
      north
      west
      west
      southwest
      west
      north
      west
      north
      cast Truesight
      north
    </steps>
  </walkthrough>
  <walkthrough name="killsage">
    <steps type="simplestringlist"><![CDATA[
      north
      north
      cheat
      northeast
      west
      speak to Sage
      event:ShowMenuResponse;I have the moonstone!
      learn Returning
      cast Returning
      west
      speak to Sage
      event:ShowMenuResponse;How does the <i>Returning</i> spell work?
      east
      get stone
      west
      throw stone
      learn Truesight
      cast Truesight
      take Stone of returning
      cast Returning
      throw Stone of returning
      cast Returning
    ]]></steps>
  </walkthrough>
  <walkthrough name="play">
    <steps type="simplestringlist">
      z
      north
      northeast
      west
      speak to Sage
      event:ShowMenuResponse;Why tell me?
      speak to Sage
      event:ShowMenuResponse;About the prophecy...
      speak to Sage
      event:ShowMenuResponse;Can you give me anything?
      learn Lore
      learn Cancel
      cast Lore
      east
      north
      north
      northeast
      east
      northeast
      speak to Druid
      event:ShowMenuResponse;Can you teach me some spells?
      speak to Druid
      event:ShowMenuResponse;Help me defeat the Sun Queen
      learn Truesight
      learn Animal Tongues
      speak to Fox
      cast Animal Tongues
      speak to Fox
      event:ShowMenuResponse;What do you think of the druid?
      north
      northeast
      north
      west
      west
      southwest
      west
      north
      east
      southwest
      west
      south
      west
      west
      x head
      northwest
      speak to Centaur
      event:ShowMenuResponse;What is the cairn for?
      speak to Centaur
      event:ShowMenuResponse;What battle?
      speak to Centaur
      event:ShowMenuResponse;Who was the frost lord?
      speak to Centaur
      event:ShowMenuResponse;How do I get in the citadel?
      speak to Centaur
      event:ShowMenuResponse;Would a spell help?
      speak to Centaur
      event:ShowMenuResponse;How do you know about the secret passage?
      speak to Centaur
      southeast
      south
      west
      northwest
      northeast
      southwest
      southeast
      east
      north
      northwest
      southeast
      east
      north
      northwest
      north
      cast Truesight
      north
      east
      up
    </steps>
  </walkthrough>
  <javascript src="InvPane2.js" />
</asl>